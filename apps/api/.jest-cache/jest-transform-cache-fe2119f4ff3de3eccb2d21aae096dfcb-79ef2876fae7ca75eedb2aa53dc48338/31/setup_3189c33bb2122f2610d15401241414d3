ec74d84fda6dfce94b99b7cd41dd2f24
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.testConfig = exports.MockFactory = exports.expectAsync = exports.getMemoryUsage = exports.measurePerformance = exports.createTestRedis = exports.createTestDatabase = exports.restoreDate = exports.mockDate = exports.waitFor = exports.createMockMetrics = exports.createMockCampaign = exports.createMockUser = void 0;
const globals_1 = require("@jest/globals");
// Mock external services by default
globals_1.jest.mock('ioredis', () => {
    return globals_1.jest.fn().mockImplementation(() => ({
        get: globals_1.jest.fn(),
        set: globals_1.jest.fn(),
        setex: globals_1.jest.fn(),
        del: globals_1.jest.fn(),
        keys: globals_1.jest.fn(),
        pipeline: globals_1.jest.fn(),
        ping: globals_1.jest.fn().mockResolvedValue('PONG'),
        info: globals_1.jest.fn(),
        dbsize: globals_1.jest.fn(),
        flushdb: globals_1.jest.fn(),
        exists: globals_1.jest.fn(),
        ttl: globals_1.jest.fn(),
        expire: globals_1.jest.fn(),
        incr: globals_1.jest.fn(),
        decr: globals_1.jest.fn(),
        hget: globals_1.jest.fn(),
        hset: globals_1.jest.fn(),
        hdel: globals_1.jest.fn(),
        hgetall: globals_1.jest.fn(),
        zadd: globals_1.jest.fn(),
        zrange: globals_1.jest.fn(),
        zrem: globals_1.jest.fn(),
        zcard: globals_1.jest.fn(),
        disconnect: globals_1.jest.fn(),
    }));
});
// Mock Bull queue
globals_1.jest.mock('bull', () => {
    return globals_1.jest.fn().mockImplementation(() => ({
        add: globals_1.jest.fn(),
        process: globals_1.jest.fn(),
        on: globals_1.jest.fn(),
        getJobs: globals_1.jest.fn(),
        clean: globals_1.jest.fn(),
        getJobCounts: globals_1.jest.fn(),
        pause: globals_1.jest.fn(),
        resume: globals_1.jest.fn(),
        close: globals_1.jest.fn(),
    }));
});
// Mock Winston logger
globals_1.jest.mock('winston', () => ({
    createLogger: globals_1.jest.fn(() => ({
        info: globals_1.jest.fn(),
        error: globals_1.jest.fn(),
        warn: globals_1.jest.fn(),
        debug: globals_1.jest.fn(),
        log: globals_1.jest.fn(),
    })),
    format: {
        combine: globals_1.jest.fn(),
        timestamp: globals_1.jest.fn(),
        errors: globals_1.jest.fn(),
        json: globals_1.jest.fn(),
        colorize: globals_1.jest.fn(),
        simple: globals_1.jest.fn(),
        printf: globals_1.jest.fn(),
    },
    transports: {
        Console: globals_1.jest.fn(),
        File: globals_1.jest.fn(),
    },
}));
// Global test setup
beforeAll(async () => {
    // Set test environment variables
    process.env.NODE_ENV = 'test';
    process.env.DATABASE_URL = process.env.TEST_DATABASE_URL || 'postgresql://test:test@localhost:5432/utmify_test';
    process.env.REDIS_URL = process.env.TEST_REDIS_URL || 'redis://localhost:6379/1';
    process.env.JWT_SECRET = 'test-jwt-secret';
    process.env.LOG_LEVEL = 'error'; // Reduce log noise during tests
    // Set timezone for consistent date testing
    process.env.TZ = 'UTC';
});
// Global test teardown
afterAll(async () => {
    // Clean up any global resources
    await new Promise(resolve => setTimeout(resolve, 100));
});
// Mock console methods to reduce noise during tests
const originalConsole = { ...console };
beforeEach(() => {
    // Mock console methods but allow them in debug mode
    if (process.env.DEBUG !== 'true') {
        globals_1.jest.spyOn(console, 'log').mockImplementation(() => { });
        globals_1.jest.spyOn(console, 'info').mockImplementation(() => { });
        globals_1.jest.spyOn(console, 'warn').mockImplementation(() => { });
        globals_1.jest.spyOn(console, 'debug').mockImplementation(() => { });
    }
});
afterEach(() => {
    // Restore console methods
    if (process.env.DEBUG !== 'true') {
        globals_1.jest.restoreAllMocks();
    }
});
// Global error handler for unhandled promises
process.on('unhandledRejection', (reason, promise) => {
    console.error('Unhandled Rejection at:', promise, 'reason:', reason);
});
process.on('uncaughtException', (error) => {
    console.error('Uncaught Exception:', error);
});
// Extend Jest matchers
expect.extend({
    toBeValidUUID(received) {
        const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
        const pass = uuidRegex.test(received);
        if (pass) {
            return {
                message: () => `expected ${received} not to be a valid UUID`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be a valid UUID`,
                pass: false,
            };
        }
    },
    toBeValidDate(received) {
        const pass = received instanceof Date && !isNaN(received.getTime());
        if (pass) {
            return {
                message: () => `expected ${received} not to be a valid Date`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be a valid Date`,
                pass: false,
            };
        }
    },
    toBeWithinRange(received, floor, ceiling) {
        const pass = received >= floor && received <= ceiling;
        if (pass) {
            return {
                message: () => `expected ${received} not to be within range ${floor} - ${ceiling}`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be within range ${floor} - ${ceiling}`,
                pass: false,
            };
        }
    },
});
// Test utilities
const createMockUser = () => ({
    id: '123e4567-e89b-12d3-a456-426614174000',
    organizationId: '123e4567-e89b-12d3-a456-426614174001',
    email: 'test@example.com',
    name: 'Test User',
});
exports.createMockUser = createMockUser;
const createMockCampaign = () => ({
    id: '123e4567-e89b-12d3-a456-426614174002',
    name: 'Test Campaign',
    organizationId: '123e4567-e89b-12d3-a456-426614174001',
    status: 'ACTIVE',
    createdAt: new Date(),
    updatedAt: new Date(),
});
exports.createMockCampaign = createMockCampaign;
const createMockMetrics = () => ({
    revenue: 5000,
    roas: 250,
    roi: 150,
    adSpend: 2000,
    cpc: 4,
    cpm: 200,
    cac: 40,
    impressions: 10000,
    clicks: 500,
    conversions: 50,
    ctr: 5,
    conversionRate: 10,
    ltv: 250,
    arpu: 100,
    margin: 60,
    profit: 3000,
});
exports.createMockMetrics = createMockMetrics;
const waitFor = (ms) => new Promise(resolve => setTimeout(resolve, ms));
exports.waitFor = waitFor;
const mockDate = (date) => {
    const mockDate = new Date(date);
    globals_1.jest.spyOn(global, 'Date').mockImplementation(() => mockDate);
    return mockDate;
};
exports.mockDate = mockDate;
const restoreDate = () => {
    globals_1.jest.restoreAllMocks();
};
exports.restoreDate = restoreDate;
// Database test utilities
const createTestDatabase = async () => {
    // This would be implemented based on your database setup
    // For now, we'll just return a mock
    return {
        cleanup: async () => { },
        seed: async () => { },
    };
};
exports.createTestDatabase = createTestDatabase;
// Redis test utilities
const createTestRedis = async () => {
    // This would be implemented based on your Redis setup
    return {
        cleanup: async () => { },
        flush: async () => { },
    };
};
exports.createTestRedis = createTestRedis;
// Performance testing utilities
const measurePerformance = async (fn) => {
    const start = process.hrtime.bigint();
    const result = await fn();
    const end = process.hrtime.bigint();
    const duration = Number(end - start) / 1000000; // Convert to milliseconds
    return {
        result,
        duration,
    };
};
exports.measurePerformance = measurePerformance;
// Memory usage utilities
const getMemoryUsage = () => {
    const usage = process.memoryUsage();
    return {
        rss: Math.round(usage.rss / 1024 / 1024 * 100) / 100, // MB
        heapTotal: Math.round(usage.heapTotal / 1024 / 1024 * 100) / 100, // MB
        heapUsed: Math.round(usage.heapUsed / 1024 / 1024 * 100) / 100, // MB
        external: Math.round(usage.external / 1024 / 1024 * 100) / 100, // MB
    };
};
exports.getMemoryUsage = getMemoryUsage;
// Async test utilities
const expectAsync = async (promise) => {
    try {
        const result = await promise;
        return expect(result);
    }
    catch (error) {
        return expect(error);
    }
};
exports.expectAsync = expectAsync;
// Mock factory for creating consistent test data
class MockFactory {
    static createMetricsFilters(overrides = {}) {
        return {
            organizationId: '123e4567-e89b-12d3-a456-426614174001',
            startDate: new Date('2024-01-01'),
            endDate: new Date('2024-01-31'),
            ...overrides,
        };
    }
    static createKPIMetrics(overrides = {}) {
        return {
            ...(0, exports.createMockMetrics)(),
            ...overrides,
        };
    }
    static createDashboardMetrics(overrides = {}) {
        const baseMetrics = (0, exports.createMockMetrics)();
        return {
            summary: baseMetrics,
            trends: [
                { period: '2024-01-01', metrics: baseMetrics },
                { period: '2024-01-02', metrics: baseMetrics },
            ],
            topCampaigns: [
                {
                    campaignId: '123e4567-e89b-12d3-a456-426614174002',
                    campaignName: 'Test Campaign',
                    metrics: baseMetrics,
                },
            ],
            alerts: [],
            ...overrides,
        };
    }
}
exports.MockFactory = MockFactory;
// Export test configuration
exports.testConfig = {
    timeout: 30000,
    retries: 3,
    parallel: true,
    coverage: true,
    verbose: process.env.DEBUG === 'true',
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxFbnpvIE1hcmNlbG9cXERlc2t0b3BcXFByb2pldG9zIEVtcHJlc2FcXFNhYXMgVXRtaWZ5XFx1dG1pZnktY2xvbmVcXGFwcHNcXGFwaVxcc3JjXFx0ZXN0c1xcc2V0dXAudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMkNBQXFDO0FBaUhyQyxvQ0FBb0M7QUFDcEMsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO0lBQ3hCLE9BQU8sY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDekMsR0FBRyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZCxHQUFHLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNkLEtBQUssRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2hCLEdBQUcsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2QsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixRQUFRLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNuQixJQUFJLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQztRQUN6QyxJQUFJLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLE1BQU0sRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLE9BQU8sRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE1BQU0sRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLEdBQUcsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2QsTUFBTSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakIsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixJQUFJLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLElBQUksRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFF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IiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcRW56byBNYXJjZWxvXFxEZXNrdG9wXFxQcm9qZXRvcyBFbXByZXNhXFxTYWFzIFV0bWlmeVxcdXRtaWZ5LWNsb25lXFxhcHBzXFxhcGlcXHNyY1xcdGVzdHNcXHNldHVwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcblxuLy8gR2xvYmFsIHRlc3Qgc2V0dXBcbmJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gIC8vIFNldCB0ZXN0IGVudmlyb25tZW50IHZhcmlhYmxlc1xuICBwcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcbiAgcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMID0gcHJvY2Vzcy5lbnYuVEVTVF9EQVRBQkFTRV9VUkwgfHwgJ3Bvc3RncmVzcWw6Ly90ZXN0OnRlc3RAbG9jYWxob3N0OjU0MzIvdXRtaWZ5X3Rlc3QnO1xuICBwcm9jZXNzLmVudi5SRURJU19VUkwgPSBwcm9jZXNzLmVudi5URVNUX1JFRElTX1VSTCB8fCAncmVkaXM6Ly9sb2NhbGhvc3Q6NjM3OS8xJztcbiAgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCA9ICd0ZXN0LWp3dC1zZWNyZXQnO1xuICBwcm9jZXNzLmVudi5MT0dfTEVWRUwgPSAnZXJyb3InOyAvLyBSZWR1Y2UgbG9nIG5vaXNlIGR1cmluZyB0ZXN0c1xuICBcbiAgLy8gU2V0IHRpbWV6b25lIGZvciBjb25zaXN0ZW50IGRhdGUgdGVzdGluZ1xuICBwcm9jZXNzLmVudi5UWiA9ICdVVEMnO1xufSk7XG5cbi8vIEdsb2JhbCB0ZXN0IHRlYXJkb3duXG5hZnRlckFsbChhc3luYyAoKSA9PiB7XG4gIC8vIENsZWFuIHVwIGFueSBnbG9iYWwgcmVzb3VyY2VzXG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbn0pO1xuXG4vLyBNb2NrIGNvbnNvbGUgbWV0aG9kcyB0byByZWR1Y2Ugbm9pc2UgZHVyaW5nIHRlc3RzXG5jb25zdCBvcmlnaW5hbENvbnNvbGUgPSB7IC4uLmNvbnNvbGUgfTtcblxuYmVmb3JlRWFjaCgoKSA9PiB7XG4gIC8vIE1vY2sgY29uc29sZSBtZXRob2RzIGJ1dCBhbGxvdyB0aGVtIGluIGRlYnVnIG1vZGVcbiAgaWYgKHByb2Nlc3MuZW52LkRFQlVHICE9PSAndHJ1ZScpIHtcbiAgICBqZXN0LnNweU9uKGNvbnNvbGUsICdsb2cnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICAgIGplc3Quc3B5T24oY29uc29sZSwgJ2luZm8nKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICAgIGplc3Quc3B5T24oY29uc29sZSwgJ3dhcm4nKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICAgIGplc3Quc3B5T24oY29uc29sZSwgJ2RlYnVnJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcbiAgfVxufSk7XG5cbmFmdGVyRWFjaCgoKSA9PiB7XG4gIC8vIFJlc3RvcmUgY29uc29sZSBtZXRob2RzXG4gIGlmIChwcm9jZXNzLmVudi5ERUJVRyAhPT0gJ3RydWUnKSB7XG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgfVxufSk7XG5cbi8vIEdsb2JhbCBlcnJvciBoYW5kbGVyIGZvciB1bmhhbmRsZWQgcHJvbWlzZXNcbnByb2Nlc3Mub24oJ3VuaGFuZGxlZFJlamVjdGlvbicsIChyZWFzb24sIHByb21pc2UpID0+IHtcbiAgY29uc29sZS5lcnJvcignVW5oYW5kbGVkIFJlamVjdGlvbiBhdDonLCBwcm9taXNlLCAncmVhc29uOicsIHJlYXNvbik7XG59KTtcblxucHJvY2Vzcy5vbigndW5jYXVnaHRFeGNlcHRpb24nLCAoZXJyb3IpID0+IHtcbiAgY29uc29sZS5lcnJvcignVW5jYXVnaHQgRXhjZXB0aW9uOicsIGVycm9yKTtcbn0pO1xuXG4vLyBFeHRlbmQgSmVzdCBtYXRjaGVyc1xuZXhwZWN0LmV4dGVuZCh7XG4gIHRvQmVWYWxpZFVVSUQocmVjZWl2ZWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHV1aWRSZWdleCA9IC9eWzAtOWEtZl17OH0tWzAtOWEtZl17NH0tWzEtNV1bMC05YS1mXXszfS1bODlhYl1bMC05YS1mXXszfS1bMC05YS1mXXsxMn0kL2k7XG4gICAgY29uc3QgcGFzcyA9IHV1aWRSZWdleC50ZXN0KHJlY2VpdmVkKTtcbiAgICBcbiAgICBpZiAocGFzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IG5vdCB0byBiZSBhIHZhbGlkIFVVSURgLFxuICAgICAgICBwYXNzOiB0cnVlLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IHRvIGJlIGEgdmFsaWQgVVVJRGAsXG4gICAgICAgIHBhc3M6IGZhbHNlLFxuICAgICAgfTtcbiAgICB9XG4gIH0sXG4gIFxuICB0b0JlVmFsaWREYXRlKHJlY2VpdmVkOiBhbnkpIHtcbiAgICBjb25zdCBwYXNzID0gcmVjZWl2ZWQgaW5zdGFuY2VvZiBEYXRlICYmICFpc05hTihyZWNlaXZlZC5nZXRUaW1lKCkpO1xuICAgIFxuICAgIGlmIChwYXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH0gbm90IHRvIGJlIGEgdmFsaWQgRGF0ZWAsXG4gICAgICAgIHBhc3M6IHRydWUsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH0gdG8gYmUgYSB2YWxpZCBEYXRlYCxcbiAgICAgICAgcGFzczogZmFsc2UsXG4gICAgICB9O1xuICAgIH1cbiAgfSxcbiAgXG4gIHRvQmVXaXRoaW5SYW5nZShyZWNlaXZlZDogbnVtYmVyLCBmbG9vcjogbnVtYmVyLCBjZWlsaW5nOiBudW1iZXIpIHtcbiAgICBjb25zdCBwYXNzID0gcmVjZWl2ZWQgPj0gZmxvb3IgJiYgcmVjZWl2ZWQgPD0gY2VpbGluZztcbiAgICBcbiAgICBpZiAocGFzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IG5vdCB0byBiZSB3aXRoaW4gcmFuZ2UgJHtmbG9vcn0gLSAke2NlaWxpbmd9YCxcbiAgICAgICAgcGFzczogdHJ1ZSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBleHBlY3RlZCAke3JlY2VpdmVkfSB0byBiZSB3aXRoaW4gcmFuZ2UgJHtmbG9vcn0gLSAke2NlaWxpbmd9YCxcbiAgICAgICAgcGFzczogZmFsc2UsXG4gICAgICB9O1xuICAgIH1cbiAgfSxcbn0pO1xuXG4vLyBEZWNsYXJlIGN1c3RvbSBtYXRjaGVycyBmb3IgVHlwZVNjcmlwdFxuZGVjbGFyZSBnbG9iYWwge1xuICBuYW1lc3BhY2UgamVzdCB7XG4gICAgaW50ZXJmYWNlIE1hdGNoZXJzPFI+IHtcbiAgICAgIHRvQmVWYWxpZFVVSUQoKTogUjtcbiAgICAgIHRvQmVWYWxpZERhdGUoKTogUjtcbiAgICAgIHRvQmVXaXRoaW5SYW5nZShmbG9vcjogbnVtYmVyLCBjZWlsaW5nOiBudW1iZXIpOiBSO1xuICAgIH1cbiAgfVxufVxuXG4vLyBNb2NrIGV4dGVybmFsIHNlcnZpY2VzIGJ5IGRlZmF1bHRcbmplc3QubW9jaygnaW9yZWRpcycsICgpID0+IHtcbiAgcmV0dXJuIGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICBnZXQ6IGplc3QuZm4oKSxcbiAgICBzZXQ6IGplc3QuZm4oKSxcbiAgICBzZXRleDogamVzdC5mbigpLFxuICAgIGRlbDogamVzdC5mbigpLFxuICAgIGtleXM6IGplc3QuZm4oKSxcbiAgICBwaXBlbGluZTogamVzdC5mbigpLFxuICAgIHBpbmc6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnUE9ORycpLFxuICAgIGluZm86IGplc3QuZm4oKSxcbiAgICBkYnNpemU6IGplc3QuZm4oKSxcbiAgICBmbHVzaGRiOiBqZXN0LmZuKCksXG4gICAgZXhpc3RzOiBqZXN0LmZuKCksXG4gICAgdHRsOiBqZXN0LmZuKCksXG4gICAgZXhwaXJlOiBqZXN0LmZuKCksXG4gICAgaW5jcjogamVzdC5mbigpLFxuICAgIGRlY3I6IGplc3QuZm4oKSxcbiAgICBoZ2V0OiBqZXN0LmZuKCksXG4gICAgaHNldDogamVzdC5mbigpLFxuICAgIGhkZWw6IGplc3QuZm4oKSxcbiAgICBoZ2V0YWxsOiBqZXN0LmZuKCksXG4gICAgemFkZDogamVzdC5mbigpLFxuICAgIHpyYW5nZTogamVzdC5mbigpLFxuICAgIHpyZW06IGplc3QuZm4oKSxcbiAgICB6Y2FyZDogamVzdC5mbigpLFxuICAgIGRpc2Nvbm5lY3Q6IGplc3QuZm4oKSxcbiAgfSkpO1xufSk7XG5cbi8vIE1vY2sgQnVsbCBxdWV1ZVxuamVzdC5tb2NrKCdidWxsJywgKCkgPT4ge1xuICByZXR1cm4gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgIGFkZDogamVzdC5mbigpLFxuICAgIHByb2Nlc3M6IGplc3QuZm4oKSxcbiAgICBvbjogamVzdC5mbigpLFxuICAgIGdldEpvYnM6IGplc3QuZm4oKSxcbiAgICBjbGVhbjogamVzdC5mbigpLFxuICAgIGdldEpvYkNvdW50czogamVzdC5mbigpLFxuICAgIHBhdXNlOiBqZXN0LmZuKCksXG4gICAgcmVzdW1lOiBqZXN0LmZuKCksXG4gICAgY2xvc2U6IGplc3QuZm4oKSxcbiAgfSkpO1xufSk7XG5cbi8vIE1vY2sgV2luc3RvbiBsb2dnZXJcbmplc3QubW9jaygnd2luc3RvbicsICgpID0+ICh7XG4gIGNyZWF0ZUxvZ2dlcjogamVzdC5mbigoKSA9PiAoe1xuICAgIGluZm86IGplc3QuZm4oKSxcbiAgICBlcnJvcjogamVzdC5mbigpLFxuICAgIHdhcm46IGplc3QuZm4oKSxcbiAgICBkZWJ1ZzogamVzdC5mbigpLFxuICAgIGxvZzogamVzdC5mbigpLFxuICB9KSksXG4gIGZvcm1hdDoge1xuICAgIGNvbWJpbmU6IGplc3QuZm4oKSxcbiAgICB0aW1lc3RhbXA6IGplc3QuZm4oKSxcbiAgICBlcnJvcnM6IGplc3QuZm4oKSxcbiAgICBqc29uOiBqZXN0LmZuKCksXG4gICAgY29sb3JpemU6IGplc3QuZm4oKSxcbiAgICBzaW1wbGU6IGplc3QuZm4oKSxcbiAgICBwcmludGY6IGplc3QuZm4oKSxcbiAgfSxcbiAgdHJhbnNwb3J0czoge1xuICAgIENvbnNvbGU6IGplc3QuZm4oKSxcbiAgICBGaWxlOiBqZXN0LmZuKCksXG4gIH0sXG59KSk7XG5cbi8vIFRlc3QgdXRpbGl0aWVzXG5leHBvcnQgY29uc3QgY3JlYXRlTW9ja1VzZXIgPSAoKSA9PiAoe1xuICBpZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsXG4gIG9yZ2FuaXphdGlvbklkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAxJyxcbiAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgbmFtZTogJ1Rlc3QgVXNlcicsXG59KTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZU1vY2tDYW1wYWlnbiA9ICgpID0+ICh7XG4gIGlkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAyJyxcbiAgbmFtZTogJ1Rlc3QgQ2FtcGFpZ24nLFxuICBvcmdhbml6YXRpb25JZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMScsXG4gIHN0YXR1czogJ0FDVElWRScsXG4gIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxufSk7XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVNb2NrTWV0cmljcyA9ICgpID0+ICh7XG4gIHJldmVudWU6IDUwMDAsXG4gIHJvYXM6IDI1MCxcbiAgcm9pOiAxNTAsXG4gIGFkU3BlbmQ6IDIwMDAsXG4gIGNwYzogNCxcbiAgY3BtOiAyMDAsXG4gIGNhYzogNDAsXG4gIGltcHJlc3Npb25zOiAxMDAwMCxcbiAgY2xpY2tzOiA1MDAsXG4gIGNvbnZlcnNpb25zOiA1MCxcbiAgY3RyOiA1LFxuICBjb252ZXJzaW9uUmF0ZTogMTAsXG4gIGx0djogMjUwLFxuICBhcnB1OiAxMDAsXG4gIG1hcmdpbjogNjAsXG4gIHByb2ZpdDogMzAwMCxcbn0pO1xuXG5leHBvcnQgY29uc3Qgd2FpdEZvciA9IChtczogbnVtYmVyKSA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcblxuZXhwb3J0IGNvbnN0IG1vY2tEYXRlID0gKGRhdGU6IHN0cmluZyB8IERhdGUpID0+IHtcbiAgY29uc3QgbW9ja0RhdGUgPSBuZXcgRGF0ZShkYXRlKTtcbiAgamVzdC5zcHlPbihnbG9iYWwsICdEYXRlJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IG1vY2tEYXRlIGFzIGFueSk7XG4gIHJldHVybiBtb2NrRGF0ZTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXN0b3JlRGF0ZSA9ICgpID0+IHtcbiAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbn07XG5cbi8vIERhdGFiYXNlIHRlc3QgdXRpbGl0aWVzXG5leHBvcnQgY29uc3QgY3JlYXRlVGVzdERhdGFiYXNlID0gYXN5bmMgKCkgPT4ge1xuICAvLyBUaGlzIHdvdWxkIGJlIGltcGxlbWVudGVkIGJhc2VkIG9uIHlvdXIgZGF0YWJhc2Ugc2V0dXBcbiAgLy8gRm9yIG5vdywgd2UnbGwganVzdCByZXR1cm4gYSBtb2NrXG4gIHJldHVybiB7XG4gICAgY2xlYW51cDogYXN5bmMgKCkgPT4ge30sXG4gICAgc2VlZDogYXN5bmMgKCkgPT4ge30sXG4gIH07XG59O1xuXG4vLyBSZWRpcyB0ZXN0IHV0aWxpdGllc1xuZXhwb3J0IGNvbnN0IGNyZWF0ZVRlc3RSZWRpcyA9IGFzeW5jICgpID0+IHtcbiAgLy8gVGhpcyB3b3VsZCBiZSBpbXBsZW1lbnRlZCBiYXNlZCBvbiB5b3VyIFJlZGlzIHNldHVwXG4gIHJldHVybiB7XG4gICAgY2xlYW51cDogYXN5bmMgKCkgPT4ge30sXG4gICAgZmx1c2g6IGFzeW5jICgpID0+IHt9LFxuICB9O1xufTtcblxuLy8gUGVyZm9ybWFuY2UgdGVzdGluZyB1dGlsaXRpZXNcbmV4cG9ydCBjb25zdCBtZWFzdXJlUGVyZm9ybWFuY2UgPSBhc3luYyAoZm46ICgpID0+IFByb21pc2U8YW55PikgPT4ge1xuICBjb25zdCBzdGFydCA9IHByb2Nlc3MuaHJ0aW1lLmJpZ2ludCgpO1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCBmbigpO1xuICBjb25zdCBlbmQgPSBwcm9jZXNzLmhydGltZS5iaWdpbnQoKTtcbiAgY29uc3QgZHVyYXRpb24gPSBOdW1iZXIoZW5kIC0gc3RhcnQpIC8gMTAwMDAwMDsgLy8gQ29udmVydCB0byBtaWxsaXNlY29uZHNcbiAgXG4gIHJldHVybiB7XG4gICAgcmVzdWx0LFxuICAgIGR1cmF0aW9uLFxuICB9O1xufTtcblxuLy8gTWVtb3J5IHVzYWdlIHV0aWxpdGllc1xuZXhwb3J0IGNvbnN0IGdldE1lbW9yeVVzYWdlID0gKCkgPT4ge1xuICBjb25zdCB1c2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcbiAgcmV0dXJuIHtcbiAgICByc3M6IE1hdGgucm91bmQodXNhZ2UucnNzIC8gMTAyNCAvIDEwMjQgKiAxMDApIC8gMTAwLCAvLyBNQlxuICAgIGhlYXBUb3RhbDogTWF0aC5yb3VuZCh1c2FnZS5oZWFwVG90YWwgLyAxMDI0IC8gMTAyNCAqIDEwMCkgLyAxMDAsIC8vIE1CXG4gICAgaGVhcFVzZWQ6IE1hdGgucm91bmQodXNhZ2UuaGVhcFVzZWQgLyAxMDI0IC8gMTAyNCAqIDEwMCkgLyAxMDAsIC8vIE1CXG4gICAgZXh0ZXJuYWw6IE1hdGgucm91bmQodXNhZ2UuZXh0ZXJuYWwgLyAxMDI0IC8gMTAyNCAqIDEwMCkgLyAxMDAsIC8vIE1CXG4gIH07XG59O1xuXG4vLyBBc3luYyB0ZXN0IHV0aWxpdGllc1xuZXhwb3J0IGNvbnN0IGV4cGVjdEFzeW5jID0gYXN5bmMgKHByb21pc2U6IFByb21pc2U8YW55PikgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByb21pc2U7XG4gICAgcmV0dXJuIGV4cGVjdChyZXN1bHQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBleHBlY3QoZXJyb3IpO1xuICB9XG59O1xuXG4vLyBNb2NrIGZhY3RvcnkgZm9yIGNyZWF0aW5nIGNvbnNpc3RlbnQgdGVzdCBkYXRhXG5leHBvcnQgY2xhc3MgTW9ja0ZhY3Rvcnkge1xuICBzdGF0aWMgY3JlYXRlTWV0cmljc0ZpbHRlcnMob3ZlcnJpZGVzOiBhbnkgPSB7fSkge1xuICAgIHJldHVybiB7XG4gICAgICBvcmdhbml6YXRpb25JZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMScsXG4gICAgICBzdGFydERhdGU6IG5ldyBEYXRlKCcyMDI0LTAxLTAxJyksXG4gICAgICBlbmREYXRlOiBuZXcgRGF0ZSgnMjAyNC0wMS0zMScpLFxuICAgICAgLi4ub3ZlcnJpZGVzLFxuICAgIH07XG4gIH1cbiAgXG4gIHN0YXRpYyBjcmVhdGVLUElNZXRyaWNzKG92ZXJyaWRlczogYW55ID0ge30pIHtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uY3JlYXRlTW9ja01ldHJpY3MoKSxcbiAgICAgIC4uLm92ZXJyaWRlcyxcbiAgICB9O1xuICB9XG4gIFxuICBzdGF0aWMgY3JlYXRlRGFzaGJvYXJkTWV0cmljcyhvdmVycmlkZXM6IGFueSA9IHt9KSB7XG4gICAgY29uc3QgYmFzZU1ldHJpY3MgPSBjcmVhdGVNb2NrTWV0cmljcygpO1xuICAgIHJldHVybiB7XG4gICAgICBzdW1tYXJ5OiBiYXNlTWV0cmljcyxcbiAgICAgIHRyZW5kczogW1xuICAgICAgICB7IHBlcmlvZDogJzIwMjQtMDEtMDEnLCBtZXRyaWNzOiBiYXNlTWV0cmljcyB9LFxuICAgICAgICB7IHBlcmlvZDogJzIwMjQtMDEtMDInLCBtZXRyaWNzOiBiYXNlTWV0cmljcyB9LFxuICAgICAgXSxcbiAgICAgIHRvcENhbXBhaWduczogW1xuICAgICAgICB7XG4gICAgICAgICAgY2FtcGFpZ25JZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMicsXG4gICAgICAgICAgY2FtcGFpZ25OYW1lOiAnVGVzdCBDYW1wYWlnbicsXG4gICAgICAgICAgbWV0cmljczogYmFzZU1ldHJpY3MsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgYWxlcnRzOiBbXSxcbiAgICAgIC4uLm92ZXJyaWRlcyxcbiAgICB9O1xuICB9XG59XG5cbi8vIEV4cG9ydCB0ZXN0IGNvbmZpZ3VyYXRpb25cbmV4cG9ydCBjb25zdCB0ZXN0Q29uZmlnID0ge1xuICB0aW1lb3V0OiAzMDAwMCxcbiAgcmV0cmllczogMyxcbiAgcGFyYWxsZWw6IHRydWUsXG4gIGNvdmVyYWdlOiB0cnVlLFxuICB2ZXJib3NlOiBwcm9jZXNzLmVudi5ERUJVRyA9PT0gJ3RydWUnLFxufTsiXSwidmVyc2lvbiI6M30=
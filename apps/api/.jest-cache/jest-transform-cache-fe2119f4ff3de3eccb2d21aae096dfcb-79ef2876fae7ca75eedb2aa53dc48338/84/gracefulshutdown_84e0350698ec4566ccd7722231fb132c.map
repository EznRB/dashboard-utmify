{"version":3,"names":["logger_1","cov_1l5qv4lahb","s","require","gracefulShutdown","app","f","signals","forEach","signal","process","on","logger","info","close","exit","error","code","fatal","reason","promise","stack","Error","b","message","String","console","name","exports"],"sources":["C:\\Users\\Enzo Marcelo\\Desktop\\Projetos Empresa\\Saas Utmify\\utmify-clone\\apps\\api\\src\\utils\\graceful-shutdown.ts"],"sourcesContent":["import type { FastifyInstance } from 'fastify'\nimport { logger } from './logger'\n\n// Graceful shutdown handler\nexport const gracefulShutdown = (app: FastifyInstance) => {\n  const signals = ['SIGTERM', 'SIGINT', 'SIGUSR2'] as const\n  \n  signals.forEach((signal) => {\n    process.on(signal, async () => {\n      logger.info(`Received ${signal}, starting graceful shutdown...`)\n      \n      try {\n        // Close Fastify server\n        await app.close()\n        logger.info('✅ Server closed successfully')\n        \n        // Exit process\n        process.exit(0)\n      } catch (error) {\n        logger.error(error, '❌ Error during graceful shutdown')\n        process.exit(1)\n      }\n    })\n  })\n  \n  // Handle process termination\n  process.on('exit', (code) => {\n    logger.info(`Process exiting with code: ${code}`)\n  })\n  \n  // Handle uncaught exceptions\n  process.on('uncaughtException', (error) => {\n    logger.fatal(error, 'Uncaught Exception - shutting down')\n    process.exit(1)\n  })\n  \n  // Handle unhandled promise rejections - TEMPORARILY NOT EXITING FOR DEBUGGING\n  process.on('unhandledRejection', (reason, promise) => {\n    logger.fatal({\n      reason,\n      promise,\n      stack: reason instanceof Error ? reason.stack : 'No stack trace available',\n      message: reason instanceof Error ? reason.message : String(reason)\n    }, 'Unhandled Rejection - NOT EXITING FOR DEBUGGING')\n    console.error('\\n=== UNHANDLED REJECTION DETAILS ===')\n    console.error('Reason:', reason)\n    console.error('Promise:', promise)\n    if (reason instanceof Error) {\n      console.error('Error Name:', reason.name)\n      console.error('Error Message:', reason.message)\n      console.error('Stack Trace:', reason.stack)\n    }\n    console.error('=== END UNHANDLED REJECTION DETAILS ===\\n')\n    // Temporarily commented out to debug: process.exit(1)\n  })\n  \n  logger.info('✅ Graceful shutdown handlers registered')\n}"],"mappings":"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","ignoreList":[]}
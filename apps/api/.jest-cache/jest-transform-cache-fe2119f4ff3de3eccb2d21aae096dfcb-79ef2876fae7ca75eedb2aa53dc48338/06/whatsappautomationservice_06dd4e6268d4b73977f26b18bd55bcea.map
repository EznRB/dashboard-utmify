{"version":3,"names":["cov_nyukq8s92","actualCoverage","WhatsAppAutomationService","prisma","whatsappQueue","whatsappService","templateService","constructor","f","s","createAutomation","configId","createDto","whatsAppAutomation","create","data","name","triggerType","conditions","actions","isActive","b","getAutomations","activeOnly","where","findMany","orderBy","createdAt","updateAutomation","automationId","updateData","update","id","deleteAutomation","delete","triggerAutomation","organizationId","trigger","config","whatsAppConfig","findUnique","userId","logger","warn","automations","type","automation","evaluateConditions","executeAutomation","error","triggerData","log","action","executeSendMessageAction","executeSendTemplateAction","executeDelayAction","runCount","increment","lastRun","Date","recipients","resolveRecipients","message","processMessageTemplate","recipient","add","to","body","templateParams","processTemplateParams","templateName","delayMs","delay","Promise","resolve","setTimeout","rules","operator","results","map","rule","field","ruleOp","value","fieldValue","getNestedValue","Number","String","toLowerCase","includes","undefined","every","r","some","recipientConfig","Array","isArray","startsWith","endsWith","slice","filter","Boolean","template","processTemplate","processed","Object","entries","forEach","key","obj","path","split","reduce","current","handleDailyReports","configs","include","user","findFirst","yesterday","setDate","getDate","setHours","reportData","generateDailyReportData","phoneNumbers","phoneNumber","date","sales","conversions","spent","roi","leads","toLocaleDateString","createDefaultAutomations","defaultAutomations","campaign_name","source","timestamp","budget","percentage","alert_message","createdAutomations","created","push","length"],"sources":["C:\\Users\\Enzo Marcelo\\Desktop\\Projetos Empresa\\Saas Utmify\\utmify-clone\\apps\\api\\src\\services\\whatsapp-automation.service.ts"],"sourcesContent":["import { Queue } from 'bull';\nimport { PrismaService } from './prisma.service';\nimport { WhatsAppTemplateService } from './whatsapp-template.service';\nimport { WhatsAppAutomation, Prisma } from '@prisma/client';\nimport { logger } from '../utils/logger';\n\nexport interface AutomationTrigger {\n  type: 'CONVERSION' | 'BUDGET_ALERT' | 'DAILY_REPORT' | 'WELCOME' | 'KEYWORD';\n  data: any;\n}\n\nexport interface CreateAutomationDto {\n  name: string;\n  triggerType: string;\n  conditions: Record<string, any>;\n  actions: Record<string, any>;\n  isActive?: boolean;\n}\n\nexport class WhatsAppAutomationService {\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly whatsappQueue: Queue | null,\n    private readonly whatsappService: any | null,\n    private readonly templateService: WhatsAppTemplateService,\n  ) {}\n\n  /**\n   * Create new automation\n   */\n  async createAutomation(\n    configId: string,\n    createDto: CreateAutomationDto,\n  ): Promise<WhatsAppAutomation> {\n    return this.prisma.whatsAppAutomation.create({\n      data: {\n        configId,\n        name: createDto.name,\n        triggerType: createDto.triggerType,\n        conditions: createDto.conditions,\n        actions: createDto.actions,\n        isActive: createDto.isActive ?? true,\n      },\n    });\n  }\n\n  /**\n   * Get automations for config\n   */\n  async getAutomations(\n    configId: string,\n    activeOnly: boolean = false,\n  ): Promise<WhatsAppAutomation[]> {\n    const where: Prisma.WhatsAppAutomationWhereInput = {\n      configId,\n    };\n\n    if (activeOnly) {\n      where.isActive = true;\n    }\n\n    return this.prisma.whatsAppAutomation.findMany({\n      where,\n      orderBy: { createdAt: 'desc' },\n    });\n  }\n\n  /**\n   * Update automation\n   */\n  async updateAutomation(\n    automationId: string,\n    updateData: Partial<CreateAutomationDto>,\n  ): Promise<WhatsAppAutomation> {\n    return this.prisma.whatsAppAutomation.update({\n      where: { id: automationId },\n      data: updateData,\n    });\n  }\n\n  /**\n   * Delete automation\n   */\n  async deleteAutomation(automationId: string): Promise<void> {\n    await this.prisma.whatsAppAutomation.delete({\n      where: { id: automationId },\n    });\n  }\n\n  /**\n   * Trigger automation based on event\n   */\n  async triggerAutomation(\n    organizationId: string,\n    trigger: AutomationTrigger,\n  ): Promise<void> {\n    try {\n      // Get WhatsApp config for organization\n      const config = await this.prisma.whatsAppConfig.findUnique({\n        where: { userId: organizationId },\n      });\n\n      if (!config || !config.isActive) {\n        this.logger.warn(`WhatsApp not configured for organization ${organizationId}`);\n        return;\n      }\n\n      // Get matching automations\n      const automations = await this.prisma.whatsAppAutomation.findMany({\n        where: {\n          configId: config.id,\n          triggerType: trigger.type,\n          isActive: true,\n        },\n      });\n\n      for (const automation of automations) {\n        if (this.evaluateConditions(automation.conditions, trigger.data)) {\n          await this.executeAutomation(automation, trigger.data);\n        }\n      }\n    } catch (error) {\n      this.logger.error(`Error triggering automation:`, error);\n    }\n  }\n\n  /**\n   * Execute automation actions\n   */\n  private async executeAutomation(\n    automation: WhatsAppAutomation,\n    triggerData: any,\n  ): Promise<void> {\n    try {\n      this.logger.log(`Executing automation ${automation.name}`);\n\n      const actions = automation.actions as any;\n\n      for (const action of actions.actions || []) {\n        switch (action.type) {\n          case 'send_message':\n            await this.executeSendMessageAction(automation.configId, action, triggerData);\n            break;\n          case 'send_template':\n            await this.executeSendTemplateAction(automation.configId, action, triggerData);\n            break;\n          case 'delay':\n            await this.executeDelayAction(action);\n            break;\n          default:\n            this.logger.warn(`Unknown action type: ${action.type}`);\n        }\n      }\n\n      // Update automation stats\n      await this.prisma.whatsAppAutomation.update({\n        where: { id: automation.id },\n        data: {\n          runCount: { increment: 1 },\n          lastRun: new Date(),\n        },\n      });\n    } catch (error) {\n      this.logger.error(`Error executing automation ${automation.name}:`, error);\n    }\n  }\n\n  /**\n   * Execute send message action\n   */\n  private async executeSendMessageAction(\n    configId: string,\n    action: any,\n    triggerData: any,\n  ): Promise<void> {\n    const recipients = this.resolveRecipients(action.recipients, triggerData);\n    const message = this.processMessageTemplate(action.message, triggerData);\n\n    for (const recipient of recipients) {\n      await this.whatsappQueue.add('send-message', {\n        organizationId: configId,\n        message: {\n          to: recipient,\n          body: message,\n        },\n      });\n    }\n  }\n\n  /**\n   * Execute send template action\n   */\n  private async executeSendTemplateAction(\n    configId: string,\n    action: any,\n    triggerData: any,\n  ): Promise<void> {\n    const recipients = this.resolveRecipients(action.recipients, triggerData);\n    const templateParams = this.processTemplateParams(action.templateParams || {}, triggerData);\n\n    await this.whatsappQueue.add('send-template', {\n      organizationId: configId,\n      recipients,\n      templateName: action.templateName,\n      templateParams,\n    });\n  }\n\n  /**\n   * Execute delay action\n   */\n  private async executeDelayAction(action: any): Promise<void> {\n    const delayMs = action.delay || 1000;\n    await new Promise(resolve => setTimeout(resolve, delayMs));\n  }\n\n  /**\n   * Evaluate automation conditions\n   */\n  private evaluateConditions(conditions: any, triggerData: any): boolean {\n    if (!conditions || !conditions.rules) {\n      return true; // No conditions means always execute\n    }\n\n    const { rules, operator = 'AND' } = conditions;\n\n    const results = rules.map((rule: any) => {\n      const { field, operator: ruleOp, value } = rule;\n      const fieldValue = this.getNestedValue(triggerData, field);\n\n      switch (ruleOp) {\n        case 'equals':\n          return fieldValue === value;\n        case 'not_equals':\n          return fieldValue !== value;\n        case 'greater_than':\n          return Number(fieldValue) > Number(value);\n        case 'less_than':\n          return Number(fieldValue) < Number(value);\n        case 'greater_equal':\n          return Number(fieldValue) >= Number(value);\n        case 'less_equal':\n          return Number(fieldValue) <= Number(value);\n        case 'contains':\n          return String(fieldValue).toLowerCase().includes(String(value).toLowerCase());\n        case 'not_contains':\n          return !String(fieldValue).toLowerCase().includes(String(value).toLowerCase());\n        case 'exists':\n          return fieldValue !== undefined && fieldValue !== null;\n        case 'not_exists':\n          return fieldValue === undefined || fieldValue === null;\n        default:\n          return false;\n      }\n    });\n\n    return operator === 'AND' ? results.every(r => r) : results.some(r => r);\n  }\n\n  /**\n   * Resolve recipients from action configuration\n   */\n  private resolveRecipients(recipientConfig: any, triggerData: any): string[] {\n    if (Array.isArray(recipientConfig)) {\n      return recipientConfig;\n    }\n\n    if (typeof recipientConfig === 'string') {\n      // Check if it's a field reference\n      if (recipientConfig.startsWith('{{') && recipientConfig.endsWith('}}')) {\n        const field = recipientConfig.slice(2, -2);\n        const value = this.getNestedValue(triggerData, field);\n        return Array.isArray(value) ? value : [value].filter(Boolean);\n      }\n      return [recipientConfig];\n    }\n\n    if (recipientConfig.type === 'field') {\n      const value = this.getNestedValue(triggerData, recipientConfig.field);\n      return Array.isArray(value) ? value : [value].filter(Boolean);\n    }\n\n    return [];\n  }\n\n  /**\n   * Process message template with trigger data\n   */\n  private processMessageTemplate(template: string, triggerData: any): string {\n    return this.templateService.processTemplate(template, triggerData);\n  }\n\n  /**\n   * Process template parameters with trigger data\n   */\n  private processTemplateParams(\n    templateParams: Record<string, any>,\n    triggerData: any,\n  ): Record<string, any> {\n    const processed: Record<string, any> = {};\n\n    Object.entries(templateParams).forEach(([key, value]) => {\n      if (typeof value === 'string' && value.startsWith('{{') && value.endsWith('}}')) {\n        const field = value.slice(2, -2);\n        processed[key] = this.getNestedValue(triggerData, field);\n      } else {\n        processed[key] = value;\n      }\n    });\n\n    return processed;\n  }\n\n  /**\n   * Get nested value from object using dot notation\n   */\n  private getNestedValue(obj: any, path: string): any {\n    return path.split('.').reduce((current, key) => {\n      return current && current[key] !== undefined ? current[key] : undefined;\n    }, obj);\n  }\n\n  /**\n   * Daily report automation (runs at 9 AM)\n   */\n  async handleDailyReports(): Promise<void> {\n    this.logger.log('Starting daily WhatsApp reports');\n\n    try {\n      // Get all active WhatsApp configs\n      const configs = await this.prisma.whatsAppConfig.findMany({\n        where: { isActive: true },\n        include: { user: true },\n      });\n\n      for (const config of configs) {\n        try {\n          // Check if user has daily report automation enabled\n          const automation = await this.prisma.whatsAppAutomation.findFirst({\n            where: {\n              configId: config.id,\n              triggerType: 'DAILY_REPORT',\n              isActive: true,\n            },\n          });\n\n          if (automation) {\n            // Get yesterday's metrics\n            const yesterday = new Date();\n            yesterday.setDate(yesterday.getDate() - 1);\n            yesterday.setHours(0, 0, 0, 0);\n\n            const reportData = await this.generateDailyReportData(config.userId, yesterday);\n\n            await this.whatsappQueue.add('automation-trigger', {\n              organizationId: config.userId,\n              triggerType: 'daily_report',\n              data: {\n                phoneNumbers: [config.phoneNumber].filter(Boolean),\n                reportData,\n              },\n            });\n          }\n        } catch (error) {\n          this.logger.error(`Error processing daily report for config ${config.id}:`, error);\n        }\n      }\n    } catch (error) {\n      this.logger.error('Error in daily reports cron job:', error);\n    }\n  }\n\n  /**\n   * Generate daily report data\n   */\n  private async generateDailyReportData(userId: string, date: Date): Promise<any> {\n    // This would integrate with your existing metrics system\n    // For now, returning mock data structure\n    return {\n      sales: '1,250.00',\n      conversions: 15,\n      spent: '850.00',\n      roi: '147',\n      leads: 42,\n      date: date.toLocaleDateString('pt-BR'),\n    };\n  }\n\n  /**\n   * Create default automations for new config\n   */\n  async createDefaultAutomations(configId: string): Promise<WhatsAppAutomation[]> {\n    const defaultAutomations = [\n      {\n        name: 'Notificação de Conversão',\n        triggerType: 'CONVERSION',\n        conditions: {\n          rules: [\n            {\n              field: 'value',\n              operator: 'greater_than',\n              value: 0,\n            },\n          ],\n          operator: 'AND',\n        },\n        actions: {\n          actions: [\n            {\n              type: 'send_template',\n              templateName: 'conversion_notification',\n              recipients: '{{phoneNumber}}',\n              templateParams: {\n                value: '{{value}}',\n                campaign_name: '{{campaignName}}',\n                source: '{{source}}',\n                timestamp: '{{timestamp}}',\n              },\n            },\n          ],\n        },\n      },\n      {\n        name: 'Alerta de Orçamento (80%)',\n        triggerType: 'BUDGET_ALERT',\n        conditions: {\n          rules: [\n            {\n              field: 'percentage',\n              operator: 'greater_equal',\n              value: 80,\n            },\n          ],\n          operator: 'AND',\n        },\n        actions: {\n          actions: [\n            {\n              type: 'send_template',\n              templateName: 'budget_alert',\n              recipients: '{{phoneNumber}}',\n              templateParams: {\n                campaign_name: '{{campaignName}}',\n                spent: '{{spent}}',\n                budget: '{{budget}}',\n                percentage: '{{percentage}}',\n                alert_message: '{{alertMessage}}',\n              },\n            },\n          ],\n        },\n      },\n      {\n        name: 'Relatório Diário',\n        triggerType: 'DAILY_REPORT',\n        conditions: {},\n        actions: {\n          actions: [\n            {\n              type: 'send_template',\n              templateName: 'daily_report',\n              recipients: { type: 'field', field: 'phoneNumbers' },\n              templateParams: {\n                date: '{{date}}',\n                sales: '{{sales}}',\n                conversions: '{{conversions}}',\n                spent: '{{spent}}',\n                roi: '{{roi}}',\n                leads: '{{leads}}',\n              },\n            },\n          ],\n        },\n      },\n      {\n        name: 'Mensagem de Boas-vindas',\n        triggerType: 'WELCOME',\n        conditions: {},\n        actions: {\n          actions: [\n            {\n              type: 'send_template',\n              templateName: 'welcome_message',\n              recipients: '{{phoneNumber}}',\n              templateParams: {\n                name: '{{name}}',\n              },\n            },\n          ],\n        },\n      },\n    ];\n\n    const createdAutomations: WhatsAppAutomation[] = [];\n\n    for (const automation of defaultAutomations) {\n      try {\n        const created = await this.createAutomation(configId, automation);\n        createdAutomations.push(created);\n      } catch (error) {\n        this.logger.error(`Error creating default automation ${automation.name}:`, error);\n      }\n    }\n\n    this.logger.log(`Created ${createdAutomations.length} default automations for config ${configId}`);\n    return createdAutomations;\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}
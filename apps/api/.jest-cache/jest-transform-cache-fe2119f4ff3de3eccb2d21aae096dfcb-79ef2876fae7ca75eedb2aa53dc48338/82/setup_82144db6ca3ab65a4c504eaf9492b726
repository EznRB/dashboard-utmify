09ff89a6dd798b2010055e19cc75b379
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.testConfig = exports.MockFactory = exports.expectAsync = exports.getMemoryUsage = exports.measurePerformance = exports.createTestRedis = exports.createTestDatabase = exports.restoreDate = exports.mockDate = exports.waitFor = exports.createMockMetrics = exports.createMockCampaign = exports.createMockUser = void 0;
const globals_1 = require("@jest/globals");
// Mock external services by default
globals_1.jest.mock('ioredis', () => {
    return globals_1.jest.fn().mockImplementation(() => ({
        get: globals_1.jest.fn(),
        set: globals_1.jest.fn(),
        setex: globals_1.jest.fn(),
        del: globals_1.jest.fn(),
        keys: globals_1.jest.fn(),
        pipeline: globals_1.jest.fn(),
        ping: globals_1.jest.fn().mockResolvedValue('PONG'),
        info: globals_1.jest.fn(),
        dbsize: globals_1.jest.fn(),
        flushdb: globals_1.jest.fn(),
        exists: globals_1.jest.fn(),
        ttl: globals_1.jest.fn(),
        expire: globals_1.jest.fn(),
        incr: globals_1.jest.fn(),
        decr: globals_1.jest.fn(),
        hget: globals_1.jest.fn(),
        hset: globals_1.jest.fn(),
        hdel: globals_1.jest.fn(),
        hgetall: globals_1.jest.fn(),
        zadd: globals_1.jest.fn(),
        zrange: globals_1.jest.fn(),
        zrem: globals_1.jest.fn(),
        zcard: globals_1.jest.fn(),
        disconnect: globals_1.jest.fn(),
    }));
});
// Mock Bull queue
globals_1.jest.mock('bull', () => {
    return globals_1.jest.fn().mockImplementation(() => ({
        add: globals_1.jest.fn(),
        process: globals_1.jest.fn(),
        on: globals_1.jest.fn(),
        getJobs: globals_1.jest.fn(),
        clean: globals_1.jest.fn(),
        getJobCounts: globals_1.jest.fn(),
        pause: globals_1.jest.fn(),
        resume: globals_1.jest.fn(),
        close: globals_1.jest.fn(),
    }));
});
// Global test setup
beforeAll(async () => {
    // Set test environment variables
    process.env.NODE_ENV = 'test';
    process.env.DATABASE_URL = process.env.TEST_DATABASE_URL || 'postgresql://test:test@localhost:5432/utmify_test';
    process.env.REDIS_URL = process.env.TEST_REDIS_URL || 'redis://localhost:6379/1';
    process.env.JWT_SECRET = 'test-jwt-secret';
    process.env.LOG_LEVEL = 'error'; // Reduce log noise during tests
    // Set timezone for consistent date testing
    process.env.TZ = 'UTC';
});
// Global test teardown
afterAll(async () => {
    // Clean up any global resources
    await new Promise(resolve => setTimeout(resolve, 100));
});
// Mock console methods to reduce noise during tests
const originalConsole = { ...console };
beforeEach(() => {
    // Mock console methods but allow them in debug mode
    if (process.env.DEBUG !== 'true') {
        globals_1.jest.spyOn(console, 'log').mockImplementation(() => { });
        globals_1.jest.spyOn(console, 'info').mockImplementation(() => { });
        globals_1.jest.spyOn(console, 'warn').mockImplementation(() => { });
        globals_1.jest.spyOn(console, 'debug').mockImplementation(() => { });
    }
});
afterEach(() => {
    // Restore console methods
    if (process.env.DEBUG !== 'true') {
        globals_1.jest.restoreAllMocks();
    }
});
// Global error handler for unhandled promises
process.on('unhandledRejection', (reason, promise) => {
    console.error('Unhandled Rejection at:', promise, 'reason:', reason);
});
process.on('uncaughtException', (error) => {
    console.error('Uncaught Exception:', error);
});
// Extend Jest matchers
expect.extend({
    toBeValidUUID(received) {
        const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
        const pass = uuidRegex.test(received);
        if (pass) {
            return {
                message: () => `expected ${received} not to be a valid UUID`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be a valid UUID`,
                pass: false,
            };
        }
    },
    toBeValidDate(received) {
        const pass = received instanceof Date && !isNaN(received.getTime());
        if (pass) {
            return {
                message: () => `expected ${received} not to be a valid Date`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be a valid Date`,
                pass: false,
            };
        }
    },
    toBeWithinRange(received, floor, ceiling) {
        const pass = received >= floor && received <= ceiling;
        if (pass) {
            return {
                message: () => `expected ${received} not to be within range ${floor} - ${ceiling}`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be within range ${floor} - ${ceiling}`,
                pass: false,
            };
        }
    },
});
// Mock console for logging
global.console = {
    ...console,
    log: globals_1.jest.fn(),
    error: globals_1.jest.fn(),
    warn: globals_1.jest.fn(),
    info: globals_1.jest.fn(),
    debug: globals_1.jest.fn(),
};
// Test utilities
const createMockUser = () => ({
    id: '123e4567-e89b-12d3-a456-426614174000',
    organizationId: '123e4567-e89b-12d3-a456-426614174001',
    email: 'test@example.com',
    name: 'Test User',
});
exports.createMockUser = createMockUser;
const createMockCampaign = () => ({
    id: '123e4567-e89b-12d3-a456-426614174002',
    name: 'Test Campaign',
    organizationId: '123e4567-e89b-12d3-a456-426614174001',
    status: 'ACTIVE',
    createdAt: new Date(),
    updatedAt: new Date(),
});
exports.createMockCampaign = createMockCampaign;
const createMockMetrics = () => ({
    revenue: 5000,
    roas: 250,
    roi: 150,
    adSpend: 2000,
    cpc: 4,
    cpm: 200,
    cac: 40,
    impressions: 10000,
    clicks: 500,
    conversions: 50,
    ctr: 5,
    conversionRate: 10,
    ltv: 250,
    arpu: 100,
    margin: 60,
    profit: 3000,
});
exports.createMockMetrics = createMockMetrics;
const waitFor = (ms) => new Promise(resolve => setTimeout(resolve, ms));
exports.waitFor = waitFor;
const mockDate = (date) => {
    const mockDate = new Date(date);
    globals_1.jest.spyOn(global, 'Date').mockImplementation(() => mockDate);
    return mockDate;
};
exports.mockDate = mockDate;
const restoreDate = () => {
    globals_1.jest.restoreAllMocks();
};
exports.restoreDate = restoreDate;
// Database test utilities
const createTestDatabase = async () => {
    // This would be implemented based on your database setup
    // For now, we'll just return a mock
    return {
        cleanup: async () => { },
        seed: async () => { },
    };
};
exports.createTestDatabase = createTestDatabase;
// Redis test utilities
const createTestRedis = async () => {
    // This would be implemented based on your Redis setup
    return {
        cleanup: async () => { },
        flush: async () => { },
    };
};
exports.createTestRedis = createTestRedis;
// Performance testing utilities
const measurePerformance = async (fn) => {
    const start = process.hrtime.bigint();
    const result = await fn();
    const end = process.hrtime.bigint();
    const duration = Number(end - start) / 1000000; // Convert to milliseconds
    return {
        result,
        duration,
    };
};
exports.measurePerformance = measurePerformance;
// Memory usage utilities
const getMemoryUsage = () => {
    const usage = process.memoryUsage();
    return {
        rss: Math.round(usage.rss / 1024 / 1024 * 100) / 100, // MB
        heapTotal: Math.round(usage.heapTotal / 1024 / 1024 * 100) / 100, // MB
        heapUsed: Math.round(usage.heapUsed / 1024 / 1024 * 100) / 100, // MB
        external: Math.round(usage.external / 1024 / 1024 * 100) / 100, // MB
    };
};
exports.getMemoryUsage = getMemoryUsage;
// Async test utilities
const expectAsync = async (promise) => {
    try {
        const result = await promise;
        return expect(result);
    }
    catch (error) {
        return expect(error);
    }
};
exports.expectAsync = expectAsync;
// Mock factory for creating consistent test data
class MockFactory {
    static createMetricsFilters(overrides = {}) {
        return {
            organizationId: '123e4567-e89b-12d3-a456-426614174001',
            startDate: new Date('2024-01-01'),
            endDate: new Date('2024-01-31'),
            ...overrides,
        };
    }
    static createKPIMetrics(overrides = {}) {
        return {
            ...(0, exports.createMockMetrics)(),
            ...overrides,
        };
    }
    static createDashboardMetrics(overrides = {}) {
        const baseMetrics = (0, exports.createMockMetrics)();
        return {
            summary: baseMetrics,
            trends: [
                { period: '2024-01-01', metrics: baseMetrics },
                { period: '2024-01-02', metrics: baseMetrics },
            ],
            topCampaigns: [
                {
                    campaignId: '123e4567-e89b-12d3-a456-426614174002',
                    campaignName: 'Test Campaign',
                    metrics: baseMetrics,
                },
            ],
            alerts: [],
            ...overrides,
        };
    }
}
exports.MockFactory = MockFactory;
// Export test configuration
exports.testConfig = {
    timeout: 30000,
    retries: 3,
    parallel: true,
    coverage: true,
    verbose: process.env.DEBUG === 'true',
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxFbnpvIE1hcmNlbG9cXERlc2t0b3BcXFByb2pldG9zIEVtcHJlc2FcXFNhYXMgVXRtaWZ5XFx1dG1pZnktY2xvbmVcXGFwcHNcXGFwaVxcc3JjXFx0ZXN0c1xcc2V0dXAudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMkNBQXFDO0FBaUhyQyxvQ0FBb0M7QUFDcEMsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO0lBQ3hCLE9BQU8sY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDekMsR0FBRyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZCxHQUFHLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNkLEtBQUssRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2hCLEdBQUcsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2QsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixRQUFRLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNuQixJQUFJLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQztRQUN6QyxJQUFJLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLE1BQU0sRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLE9BQU8sRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE1BQU0sRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLEdBQUcsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2QsTUFBTSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakIsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixJQUFJLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLElBQUksRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFF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LEVBQUUsWUFBWSxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUU7Z0JBQzlDLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFO2FBQy9DO1lBQ0QsWUFBWSxFQUFFO2dCQUNaO29CQUNFLFVBQVUsRUFBRSxzQ0FBc0M7b0JBQ2xELFlBQVksRUFBRSxlQUFlO29CQUM3QixPQUFPLEVBQUUsV0FBVztpQkFDckI7YUFDRjtZQUNELE1BQU0sRUFBRSxFQUFFO1lBQ1YsR0FBRyxTQUFTO1NBQ2IsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQXBDRCxrQ0FvQ0M7QUFFRCw0QkFBNEI7QUFDZixRQUFBLFVBQVUsR0FBRztJQUN4QixPQUFPLEVBQUUsS0FBSztJQUNkLE9BQU8sRUFBRSxDQUFDO0lBQ1YsUUFBUSxFQUFFLElBQUk7SUFDZCxRQUFRLEVBQUUsSUFBSTtJQUNkLE9BQU8sRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssS0FBSyxNQUFNO0NBQ3RDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxFbnpvIE1hcmNlbG9cXERlc2t0b3BcXFByb2pldG9zIEVtcHJlc2FcXFNhYXMgVXRtaWZ5XFx1dG1pZnktY2xvbmVcXGFwcHNcXGFwaVxcc3JjXFx0ZXN0c1xcc2V0dXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgamVzdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuXG4vLyBHbG9iYWwgdGVzdCBzZXR1cFxuYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgLy8gU2V0IHRlc3QgZW52aXJvbm1lbnQgdmFyaWFibGVzXG4gIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Rlc3QnO1xuICBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwgPSBwcm9jZXNzLmVudi5URVNUX0RBVEFCQVNFX1VSTCB8fCAncG9zdGdyZXNxbDovL3Rlc3Q6dGVzdEBsb2NhbGhvc3Q6NTQzMi91dG1pZnlfdGVzdCc7XG4gIHByb2Nlc3MuZW52LlJFRElTX1VSTCA9IHByb2Nlc3MuZW52LlRFU1RfUkVESVNfVVJMIHx8ICdyZWRpczovL2xvY2FsaG9zdDo2Mzc5LzEnO1xuICBwcm9jZXNzLmVudi5KV1RfU0VDUkVUID0gJ3Rlc3Qtand0LXNlY3JldCc7XG4gIHByb2Nlc3MuZW52LkxPR19MRVZFTCA9ICdlcnJvcic7IC8vIFJlZHVjZSBsb2cgbm9pc2UgZHVyaW5nIHRlc3RzXG4gIFxuICAvLyBTZXQgdGltZXpvbmUgZm9yIGNvbnNpc3RlbnQgZGF0ZSB0ZXN0aW5nXG4gIHByb2Nlc3MuZW52LlRaID0gJ1VUQyc7XG59KTtcblxuLy8gR2xvYmFsIHRlc3QgdGVhcmRvd25cbmFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgLy8gQ2xlYW4gdXAgYW55IGdsb2JhbCByZXNvdXJjZXNcbiAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpO1xufSk7XG5cbi8vIE1vY2sgY29uc29sZSBtZXRob2RzIHRvIHJlZHVjZSBub2lzZSBkdXJpbmcgdGVzdHNcbmNvbnN0IG9yaWdpbmFsQ29uc29sZSA9IHsgLi4uY29uc29sZSB9O1xuXG5iZWZvcmVFYWNoKCgpID0+IHtcbiAgLy8gTW9jayBjb25zb2xlIG1ldGhvZHMgYnV0IGFsbG93IHRoZW0gaW4gZGVidWcgbW9kZVxuICBpZiAocHJvY2Vzcy5lbnYuREVCVUcgIT09ICd0cnVlJykge1xuICAgIGplc3Quc3B5T24oY29uc29sZSwgJ2xvZycpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gICAgamVzdC5zcHlPbihjb25zb2xlLCAnaW5mbycpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gICAgamVzdC5zcHlPbihjb25zb2xlLCAnd2FybicpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gICAgamVzdC5zcHlPbihjb25zb2xlLCAnZGVidWcnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICB9XG59KTtcblxuYWZ0ZXJFYWNoKCgpID0+IHtcbiAgLy8gUmVzdG9yZSBjb25zb2xlIG1ldGhvZHNcbiAgaWYgKHByb2Nlc3MuZW52LkRFQlVHICE9PSAndHJ1ZScpIHtcbiAgICBqZXN0LnJlc3RvcmVBbGxNb2NrcygpO1xuICB9XG59KTtcblxuLy8gR2xvYmFsIGVycm9yIGhhbmRsZXIgZm9yIHVuaGFuZGxlZCBwcm9taXNlc1xucHJvY2Vzcy5vbigndW5oYW5kbGVkUmVqZWN0aW9uJywgKHJlYXNvbiwgcHJvbWlzZSkgPT4ge1xuICBjb25zb2xlLmVycm9yKCdVbmhhbmRsZWQgUmVqZWN0aW9uIGF0OicsIHByb21pc2UsICdyZWFzb246JywgcmVhc29uKTtcbn0pO1xuXG5wcm9jZXNzLm9uKCd1bmNhdWdodEV4Y2VwdGlvbicsIChlcnJvcikgPT4ge1xuICBjb25zb2xlLmVycm9yKCdVbmNhdWdodCBFeGNlcHRpb246JywgZXJyb3IpO1xufSk7XG5cbi8vIEV4dGVuZCBKZXN0IG1hdGNoZXJzXG5leHBlY3QuZXh0ZW5kKHtcbiAgdG9CZVZhbGlkVVVJRChyZWNlaXZlZDogc3RyaW5nKSB7XG4gICAgY29uc3QgdXVpZFJlZ2V4ID0gL15bMC05YS1mXXs4fS1bMC05YS1mXXs0fS1bMS01XVswLTlhLWZdezN9LVs4OWFiXVswLTlhLWZdezN9LVswLTlhLWZdezEyfSQvaTtcbiAgICBjb25zdCBwYXNzID0gdXVpZFJlZ2V4LnRlc3QocmVjZWl2ZWQpO1xuICAgIFxuICAgIGlmIChwYXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH0gbm90IHRvIGJlIGEgdmFsaWQgVVVJRGAsXG4gICAgICAgIHBhc3M6IHRydWUsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH0gdG8gYmUgYSB2YWxpZCBVVUlEYCxcbiAgICAgICAgcGFzczogZmFsc2UsXG4gICAgICB9O1xuICAgIH1cbiAgfSxcbiAgXG4gIHRvQmVWYWxpZERhdGUocmVjZWl2ZWQ6IGFueSkge1xuICAgIGNvbnN0IHBhc3MgPSByZWNlaXZlZCBpbnN0YW5jZW9mIERhdGUgJiYgIWlzTmFOKHJlY2VpdmVkLmdldFRpbWUoKSk7XG4gICAgXG4gICAgaWYgKHBhc3MpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBleHBlY3RlZCAke3JlY2VpdmVkfSBub3QgdG8gYmUgYSB2YWxpZCBEYXRlYCxcbiAgICAgICAgcGFzczogdHJ1ZSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBleHBlY3RlZCAke3JlY2VpdmVkfSB0byBiZSBhIHZhbGlkIERhdGVgLFxuICAgICAgICBwYXNzOiBmYWxzZSxcbiAgICAgIH07XG4gICAgfVxuICB9LFxuICBcbiAgdG9CZVdpdGhpblJhbmdlKHJlY2VpdmVkOiBudW1iZXIsIGZsb29yOiBudW1iZXIsIGNlaWxpbmc6IG51bWJlcikge1xuICAgIGNvbnN0IHBhc3MgPSByZWNlaXZlZCA+PSBmbG9vciAmJiByZWNlaXZlZCA8PSBjZWlsaW5nO1xuICAgIFxuICAgIGlmIChwYXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH0gbm90IHRvIGJlIHdpdGhpbiByYW5nZSAke2Zsb29yfSAtICR7Y2VpbGluZ31gLFxuICAgICAgICBwYXNzOiB0cnVlLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IHRvIGJlIHdpdGhpbiByYW5nZSAke2Zsb29yfSAtICR7Y2VpbGluZ31gLFxuICAgICAgICBwYXNzOiBmYWxzZSxcbiAgICAgIH07XG4gICAgfVxuICB9LFxufSk7XG5cbi8vIERlY2xhcmUgY3VzdG9tIG1hdGNoZXJzIGZvciBUeXBlU2NyaXB0XG5kZWNsYXJlIGdsb2JhbCB7XG4gIG5hbWVzcGFjZSBqZXN0IHtcbiAgICBpbnRlcmZhY2UgTWF0Y2hlcnM8Uj4ge1xuICAgICAgdG9CZVZhbGlkVVVJRCgpOiBSO1xuICAgICAgdG9CZVZhbGlkRGF0ZSgpOiBSO1xuICAgICAgdG9CZVdpdGhpblJhbmdlKGZsb29yOiBudW1iZXIsIGNlaWxpbmc6IG51bWJlcik6IFI7XG4gICAgfVxuICB9XG59XG5cbi8vIE1vY2sgZXh0ZXJuYWwgc2VydmljZXMgYnkgZGVmYXVsdFxuamVzdC5tb2NrKCdpb3JlZGlzJywgKCkgPT4ge1xuICByZXR1cm4gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgIGdldDogamVzdC5mbigpLFxuICAgIHNldDogamVzdC5mbigpLFxuICAgIHNldGV4OiBqZXN0LmZuKCksXG4gICAgZGVsOiBqZXN0LmZuKCksXG4gICAga2V5czogamVzdC5mbigpLFxuICAgIHBpcGVsaW5lOiBqZXN0LmZuKCksXG4gICAgcGluZzogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCdQT05HJyksXG4gICAgaW5mbzogamVzdC5mbigpLFxuICAgIGRic2l6ZTogamVzdC5mbigpLFxuICAgIGZsdXNoZGI6IGplc3QuZm4oKSxcbiAgICBleGlzdHM6IGplc3QuZm4oKSxcbiAgICB0dGw6IGplc3QuZm4oKSxcbiAgICBleHBpcmU6IGplc3QuZm4oKSxcbiAgICBpbmNyOiBqZXN0LmZuKCksXG4gICAgZGVjcjogamVzdC5mbigpLFxuICAgIGhnZXQ6IGplc3QuZm4oKSxcbiAgICBoc2V0OiBqZXN0LmZuKCksXG4gICAgaGRlbDogamVzdC5mbigpLFxuICAgIGhnZXRhbGw6IGplc3QuZm4oKSxcbiAgICB6YWRkOiBqZXN0LmZuKCksXG4gICAgenJhbmdlOiBqZXN0LmZuKCksXG4gICAgenJlbTogamVzdC5mbigpLFxuICAgIHpjYXJkOiBqZXN0LmZuKCksXG4gICAgZGlzY29ubmVjdDogamVzdC5mbigpLFxuICB9KSk7XG59KTtcblxuLy8gTW9jayBCdWxsIHF1ZXVlXG5qZXN0Lm1vY2soJ2J1bGwnLCAoKSA9PiB7XG4gIHJldHVybiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgYWRkOiBqZXN0LmZuKCksXG4gICAgcHJvY2VzczogamVzdC5mbigpLFxuICAgIG9uOiBqZXN0LmZuKCksXG4gICAgZ2V0Sm9iczogamVzdC5mbigpLFxuICAgIGNsZWFuOiBqZXN0LmZuKCksXG4gICAgZ2V0Sm9iQ291bnRzOiBqZXN0LmZuKCksXG4gICAgcGF1c2U6IGplc3QuZm4oKSxcbiAgICByZXN1bWU6IGplc3QuZm4oKSxcbiAgICBjbG9zZTogamVzdC5mbigpLFxuICB9KSk7XG59KTtcblxuLy8gTW9jayBjb25zb2xlIGZvciBsb2dnaW5nXG5nbG9iYWwuY29uc29sZSA9IHtcbiAgLi4uY29uc29sZSxcbiAgbG9nOiBqZXN0LmZuKCksXG4gIGVycm9yOiBqZXN0LmZuKCksXG4gIHdhcm46IGplc3QuZm4oKSxcbiAgaW5mbzogamVzdC5mbigpLFxuICBkZWJ1ZzogamVzdC5mbigpLFxufTtcblxuLy8gVGVzdCB1dGlsaXRpZXNcbmV4cG9ydCBjb25zdCBjcmVhdGVNb2NrVXNlciA9ICgpID0+ICh7XG4gIGlkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJyxcbiAgb3JnYW5pemF0aW9uSWQ6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDEnLFxuICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICBuYW1lOiAnVGVzdCBVc2VyJyxcbn0pO1xuXG5leHBvcnQgY29uc3QgY3JlYXRlTW9ja0NhbXBhaWduID0gKCkgPT4gKHtcbiAgaWQ6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDInLFxuICBuYW1lOiAnVGVzdCBDYW1wYWlnbicsXG4gIG9yZ2FuaXphdGlvbklkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAxJyxcbiAgc3RhdHVzOiAnQUNUSVZFJyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG59KTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZU1vY2tNZXRyaWNzID0gKCkgPT4gKHtcbiAgcmV2ZW51ZTogNTAwMCxcbiAgcm9hczogMjUwLFxuICByb2k6IDE1MCxcbiAgYWRTcGVuZDogMjAwMCxcbiAgY3BjOiA0LFxuICBjcG06IDIwMCxcbiAgY2FjOiA0MCxcbiAgaW1wcmVzc2lvbnM6IDEwMDAwLFxuICBjbGlja3M6IDUwMCxcbiAgY29udmVyc2lvbnM6IDUwLFxuICBjdHI6IDUsXG4gIGNvbnZlcnNpb25SYXRlOiAxMCxcbiAgbHR2OiAyNTAsXG4gIGFycHU6IDEwMCxcbiAgbWFyZ2luOiA2MCxcbiAgcHJvZml0OiAzMDAwLFxufSk7XG5cbmV4cG9ydCBjb25zdCB3YWl0Rm9yID0gKG1zOiBudW1iZXIpID0+IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuXG5leHBvcnQgY29uc3QgbW9ja0RhdGUgPSAoZGF0ZTogc3RyaW5nIHwgRGF0ZSkgPT4ge1xuICBjb25zdCBtb2NrRGF0ZSA9IG5ldyBEYXRlKGRhdGUpO1xuICBqZXN0LnNweU9uKGdsb2JhbCwgJ0RhdGUnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gbW9ja0RhdGUgYXMgYW55KTtcbiAgcmV0dXJuIG1vY2tEYXRlO1xufTtcblxuZXhwb3J0IGNvbnN0IHJlc3RvcmVEYXRlID0gKCkgPT4ge1xuICBqZXN0LnJlc3RvcmVBbGxNb2NrcygpO1xufTtcblxuLy8gRGF0YWJhc2UgdGVzdCB1dGlsaXRpZXNcbmV4cG9ydCBjb25zdCBjcmVhdGVUZXN0RGF0YWJhc2UgPSBhc3luYyAoKSA9PiB7XG4gIC8vIFRoaXMgd291bGQgYmUgaW1wbGVtZW50ZWQgYmFzZWQgb24geW91ciBkYXRhYmFzZSBzZXR1cFxuICAvLyBGb3Igbm93LCB3ZSdsbCBqdXN0IHJldHVybiBhIG1vY2tcbiAgcmV0dXJuIHtcbiAgICBjbGVhbnVwOiBhc3luYyAoKSA9PiB7fSxcbiAgICBzZWVkOiBhc3luYyAoKSA9PiB7fSxcbiAgfTtcbn07XG5cbi8vIFJlZGlzIHRlc3QgdXRpbGl0aWVzXG5leHBvcnQgY29uc3QgY3JlYXRlVGVzdFJlZGlzID0gYXN5bmMgKCkgPT4ge1xuICAvLyBUaGlzIHdvdWxkIGJlIGltcGxlbWVudGVkIGJhc2VkIG9uIHlvdXIgUmVkaXMgc2V0dXBcbiAgcmV0dXJuIHtcbiAgICBjbGVhbnVwOiBhc3luYyAoKSA9PiB7fSxcbiAgICBmbHVzaDogYXN5bmMgKCkgPT4ge30sXG4gIH07XG59O1xuXG4vLyBQZXJmb3JtYW5jZSB0ZXN0aW5nIHV0aWxpdGllc1xuZXhwb3J0IGNvbnN0IG1lYXN1cmVQZXJmb3JtYW5jZSA9IGFzeW5jIChmbjogKCkgPT4gUHJvbWlzZTxhbnk+KSA9PiB7XG4gIGNvbnN0IHN0YXJ0ID0gcHJvY2Vzcy5ocnRpbWUuYmlnaW50KCk7XG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGZuKCk7XG4gIGNvbnN0IGVuZCA9IHByb2Nlc3MuaHJ0aW1lLmJpZ2ludCgpO1xuICBjb25zdCBkdXJhdGlvbiA9IE51bWJlcihlbmQgLSBzdGFydCkgLyAxMDAwMDAwOyAvLyBDb252ZXJ0IHRvIG1pbGxpc2Vjb25kc1xuICBcbiAgcmV0dXJuIHtcbiAgICByZXN1bHQsXG4gICAgZHVyYXRpb24sXG4gIH07XG59O1xuXG4vLyBNZW1vcnkgdXNhZ2UgdXRpbGl0aWVzXG5leHBvcnQgY29uc3QgZ2V0TWVtb3J5VXNhZ2UgPSAoKSA9PiB7XG4gIGNvbnN0IHVzYWdlID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpO1xuICByZXR1cm4ge1xuICAgIHJzczogTWF0aC5yb3VuZCh1c2FnZS5yc3MgLyAxMDI0IC8gMTAyNCAqIDEwMCkgLyAxMDAsIC8vIE1CXG4gICAgaGVhcFRvdGFsOiBNYXRoLnJvdW5kKHVzYWdlLmhlYXBUb3RhbCAvIDEwMjQgLyAxMDI0ICogMTAwKSAvIDEwMCwgLy8gTUJcbiAgICBoZWFwVXNlZDogTWF0aC5yb3VuZCh1c2FnZS5oZWFwVXNlZCAvIDEwMjQgLyAxMDI0ICogMTAwKSAvIDEwMCwgLy8gTUJcbiAgICBleHRlcm5hbDogTWF0aC5yb3VuZCh1c2FnZS5leHRlcm5hbCAvIDEwMjQgLyAxMDI0ICogMTAwKSAvIDEwMCwgLy8gTUJcbiAgfTtcbn07XG5cbi8vIEFzeW5jIHRlc3QgdXRpbGl0aWVzXG5leHBvcnQgY29uc3QgZXhwZWN0QXN5bmMgPSBhc3luYyAocHJvbWlzZTogUHJvbWlzZTxhbnk+KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvbWlzZTtcbiAgICByZXR1cm4gZXhwZWN0KHJlc3VsdCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIGV4cGVjdChlcnJvcik7XG4gIH1cbn07XG5cbi8vIE1vY2sgZmFjdG9yeSBmb3IgY3JlYXRpbmcgY29uc2lzdGVudCB0ZXN0IGRhdGFcbmV4cG9ydCBjbGFzcyBNb2NrRmFjdG9yeSB7XG4gIHN0YXRpYyBjcmVhdGVNZXRyaWNzRmlsdGVycyhvdmVycmlkZXM6IGFueSA9IHt9KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG9yZ2FuaXphdGlvbklkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAxJyxcbiAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICAgIGVuZERhdGU6IG5ldyBEYXRlKCcyMDI0LTAxLTMxJyksXG4gICAgICAuLi5vdmVycmlkZXMsXG4gICAgfTtcbiAgfVxuICBcbiAgc3RhdGljIGNyZWF0ZUtQSU1ldHJpY3Mob3ZlcnJpZGVzOiBhbnkgPSB7fSkge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5jcmVhdGVNb2NrTWV0cmljcygpLFxuICAgICAgLi4ub3ZlcnJpZGVzLFxuICAgIH07XG4gIH1cbiAgXG4gIHN0YXRpYyBjcmVhdGVEYXNoYm9hcmRNZXRyaWNzKG92ZXJyaWRlczogYW55ID0ge30pIHtcbiAgICBjb25zdCBiYXNlTWV0cmljcyA9IGNyZWF0ZU1vY2tNZXRyaWNzKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1bW1hcnk6IGJhc2VNZXRyaWNzLFxuICAgICAgdHJlbmRzOiBbXG4gICAgICAgIHsgcGVyaW9kOiAnMjAyNC0wMS0wMScsIG1ldHJpY3M6IGJhc2VNZXRyaWNzIH0sXG4gICAgICAgIHsgcGVyaW9kOiAnMjAyNC0wMS0wMicsIG1ldHJpY3M6IGJhc2VNZXRyaWNzIH0sXG4gICAgICBdLFxuICAgICAgdG9wQ2FtcGFpZ25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBjYW1wYWlnbklkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAyJyxcbiAgICAgICAgICBjYW1wYWlnbk5hbWU6ICdUZXN0IENhbXBhaWduJyxcbiAgICAgICAgICBtZXRyaWNzOiBiYXNlTWV0cmljcyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBhbGVydHM6IFtdLFxuICAgICAgLi4ub3ZlcnJpZGVzLFxuICAgIH07XG4gIH1cbn1cblxuLy8gRXhwb3J0IHRlc3QgY29uZmlndXJhdGlvblxuZXhwb3J0IGNvbnN0IHRlc3RDb25maWcgPSB7XG4gIHRpbWVvdXQ6IDMwMDAwLFxuICByZXRyaWVzOiAzLFxuICBwYXJhbGxlbDogdHJ1ZSxcbiAgY292ZXJhZ2U6IHRydWUsXG4gIHZlcmJvc2U6IHByb2Nlc3MuZW52LkRFQlVHID09PSAndHJ1ZScsXG59OyJdLCJ2ZXJzaW9uIjozfQ==
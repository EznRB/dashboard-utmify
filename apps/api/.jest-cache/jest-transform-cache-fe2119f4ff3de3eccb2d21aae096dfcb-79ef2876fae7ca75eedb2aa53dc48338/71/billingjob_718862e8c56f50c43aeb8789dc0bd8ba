10e75a7123fd24bb98efae45ae35cb98
/* istanbul ignore next */
function cov_dwccubu1a() {
  var path = "C:\\Users\\Enzo Marcelo\\Desktop\\Projetos Empresa\\Saas Utmify\\utmify-clone\\apps\\api\\src\\jobs\\billing.job.ts";
  var hash = "023fdd1eefc0a3ddc6ea3a7b076fd5b28fc5c551";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "C:\\Users\\Enzo Marcelo\\Desktop\\Projetos Empresa\\Saas Utmify\\utmify-clone\\apps\\api\\src\\jobs\\billing.job.ts",
    statementMap: {
      "0": {
        start: {
          line: 9,
          column: 8
        },
        end: {
          line: 9,
          column: 67
        }
      },
      "1": {
        start: {
          line: 10,
          column: 8
        },
        end: {
          line: 10,
          column: 42
        }
      },
      "2": {
        start: {
          line: 13,
          column: 52
        },
        end: {
          line: 13,
          column: 60
        }
      },
      "3": {
        start: {
          line: 14,
          column: 8
        },
        end: {
          line: 18,
          column: 11
        }
      },
      "4": {
        start: {
          line: 19,
          column: 8
        },
        end: {
          line: 43,
          column: 9
        }
      },
      "5": {
        start: {
          line: 20,
          column: 12
        },
        end: {
          line: 37,
          column: 13
        }
      },
      "6": {
        start: {
          line: 22,
          column: 20
        },
        end: {
          line: 22,
          column: 55
        }
      },
      "7": {
        start: {
          line: 23,
          column: 20
        },
        end: {
          line: 23,
          column: 26
        }
      },
      "8": {
        start: {
          line: 25,
          column: 20
        },
        end: {
          line: 30,
          column: 21
        }
      },
      "9": {
        start: {
          line: 26,
          column: 24
        },
        end: {
          line: 26,
          column: 71
        }
      },
      "10": {
        start: {
          line: 29,
          column: 24
        },
        end: {
          line: 29,
          column: 62
        }
      },
      "11": {
        start: {
          line: 31,
          column: 20
        },
        end: {
          line: 31,
          column: 26
        }
      },
      "12": {
        start: {
          line: 33,
          column: 20
        },
        end: {
          line: 33,
          column: 56
        }
      },
      "13": {
        start: {
          line: 34,
          column: 20
        },
        end: {
          line: 34,
          column: 26
        }
      },
      "14": {
        start: {
          line: 36,
          column: 20
        },
        end: {
          line: 36,
          column: 73
        }
      },
      "15": {
        start: {
          line: 38,
          column: 12
        },
        end: {
          line: 38,
          column: 77
        }
      },
      "16": {
        start: {
          line: 41,
          column: 12
        },
        end: {
          line: 41,
          column: 82
        }
      },
      "17": {
        start: {
          line: 42,
          column: 12
        },
        end: {
          line: 42,
          column: 24
        }
      },
      "18": {
        start: {
          line: 49,
          column: 8
        },
        end: {
          line: 49,
          column: 53
        }
      },
      "19": {
        start: {
          line: 50,
          column: 8
        },
        end: {
          line: 50,
          column: 66
        }
      },
      "20": {
        start: {
          line: 52,
          column: 30
        },
        end: {
          line: 61,
          column: 10
        }
      },
      "21": {
        start: {
          line: 62,
          column: 8
        },
        end: {
          line: 87,
          column: 9
        }
      },
      "22": {
        start: {
          line: 63,
          column: 12
        },
        end: {
          line: 86,
          column: 13
        }
      },
      "23": {
        start: {
          line: 65,
          column: 31
        },
        end: {
          line: 65,
          column: 79
        }
      },
      "24": {
        start: {
          line: 66,
          column: 43
        },
        end: {
          line: 66,
          column: 113
        }
      },
      "25": {
        start: {
          line: 68,
          column: 16
        },
        end: {
          line: 82,
          column: 17
        }
      },
      "26": {
        start: {
          line: 69,
          column: 20
        },
        end: {
          line: 76,
          column: 23
        }
      },
      "27": {
        start: {
          line: 77,
          column: 20
        },
        end: {
          line: 81,
          column: 23
        }
      },
      "28": {
        start: {
          line: 85,
          column: 16
        },
        end: {
          line: 85,
          column: 88
        }
      },
      "29": {
        start: {
          line: 93,
          column: 8
        },
        end: {
          line: 93,
          column: 68
        }
      },
      "30": {
        start: {
          line: 94,
          column: 8
        },
        end: {
          line: 94,
          column: 68
        }
      },
      "31": {
        start: {
          line: 100,
          column: 8
        },
        end: {
          line: 100,
          column: 69
        }
      },
      "32": {
        start: {
          line: 101,
          column: 31
        },
        end: {
          line: 113,
          column: 10
        }
      },
      "33": {
        start: {
          line: 114,
          column: 8
        },
        end: {
          line: 123,
          column: 9
        }
      },
      "34": {
        start: {
          line: 115,
          column: 12
        },
        end: {
          line: 122,
          column: 13
        }
      },
      "35": {
        start: {
          line: 116,
          column: 16
        },
        end: {
          line: 116,
          column: 77
        }
      },
      "36": {
        start: {
          line: 118,
          column: 16
        },
        end: {
          line: 118,
          column: 72
        }
      },
      "37": {
        start: {
          line: 118,
          column: 45
        },
        end: {
          line: 118,
          column: 70
        }
      },
      "38": {
        start: {
          line: 121,
          column: 16
        },
        end: {
          line: 121,
          column: 91
        }
      },
      "39": {
        start: {
          line: 124,
          column: 8
        },
        end: {
          line: 124,
          column: 86
        }
      },
      "40": {
        start: {
          line: 130,
          column: 8
        },
        end: {
          line: 130,
          column: 56
        }
      },
      "41": {
        start: {
          line: 131,
          column: 27
        },
        end: {
          line: 131,
          column: 37
        }
      },
      "42": {
        start: {
          line: 132,
          column: 8
        },
        end: {
          line: 132,
          column: 56
        }
      },
      "43": {
        start: {
          line: 133,
          column: 23
        },
        end: {
          line: 139,
          column: 10
        }
      },
      "44": {
        start: {
          line: 140,
          column: 8
        },
        end: {
          line: 142,
          column: 11
        }
      },
      "45": {
        start: {
          line: 148,
          column: 8
        },
        end: {
          line: 148,
          column: 68
        }
      },
      "46": {
        start: {
          line: 149,
          column: 36
        },
        end: {
          line: 156,
          column: 10
        }
      },
      "47": {
        start: {
          line: 157,
          column: 23
        },
        end: {
          line: 157,
          column: 71
        }
      },
      "48": {
        start: {
          line: 158,
          column: 26
        },
        end: {
          line: 158,
          column: 27
        }
      },
      "49": {
        start: {
          line: 159,
          column: 25
        },
        end: {
          line: 159,
          column: 26
        }
      },
      "50": {
        start: {
          line: 160,
          column: 8
        },
        end: {
          line: 191,
          column: 9
        }
      },
      "51": {
        start: {
          line: 161,
          column: 12
        },
        end: {
          line: 190,
          column: 13
        }
      },
      "52": {
        start: {
          line: 162,
          column: 43
        },
        end: {
          line: 162,
          column: 113
        }
      },
      "53": {
        start: {
          line: 163,
          column: 37
        },
        end: {
          line: 163,
          column: 84
        }
      },
      "54": {
        start: {
          line: 164,
          column: 16
        },
        end: {
          line: 183,
          column: 17
        }
      },
      "55": {
        start: {
          line: 165,
          column: 20
        },
        end: {
          line: 176,
          column: 23
        }
      },
      "56": {
        start: {
          line: 177,
          column: 20
        },
        end: {
          line: 177,
          column: 34
        }
      },
      "57": {
        start: {
          line: 178,
          column: 20
        },
        end: {
          line: 182,
          column: 23
        }
      },
      "58": {
        start: {
          line: 185,
          column: 16
        },
        end: {
          line: 185,
          column: 71
        }
      },
      "59": {
        start: {
          line: 185,
          column: 45
        },
        end: {
          line: 185,
          column: 69
        }
      },
      "60": {
        start: {
          line: 188,
          column: 16
        },
        end: {
          line: 188,
          column: 29
        }
      },
      "61": {
        start: {
          line: 189,
          column: 16
        },
        end: {
          line: 189,
          column: 86
        }
      },
      "62": {
        start: {
          line: 192,
          column: 8
        },
        end: {
          line: 196,
          column: 11
        }
      },
      "63": {
        start: {
          line: 202,
          column: 8
        },
        end: {
          line: 202,
          column: 51
        }
      },
      "64": {
        start: {
          line: 203,
          column: 30
        },
        end: {
          line: 225,
          column: 10
        }
      },
      "65": {
        start: {
          line: 226,
          column: 8
        },
        end: {
          line: 239,
          column: 9
        }
      },
      "66": {
        start: {
          line: 227,
          column: 12
        },
        end: {
          line: 238,
          column: 13
        }
      },
      "67": {
        start: {
          line: 228,
          column: 37
        },
        end: {
          line: 228,
          column: 114
        }
      },
      "68": {
        start: {
          line: 229,
          column: 38
        },
        end: {
          line: 229,
          column: 116
        }
      },
      "69": {
        start: {
          line: 231,
          column: 16
        },
        end: {
          line: 234,
          column: 19
        }
      },
      "70": {
        start: {
          line: 237,
          column: 16
        },
        end: {
          line: 237,
          column: 93
        }
      },
      "71": {
        start: {
          line: 242,
          column: 26
        },
        end: {
          line: 250,
          column: 9
        }
      },
      "72": {
        start: {
          line: 251,
          column: 8
        },
        end: {
          line: 251,
          column: 72
        }
      },
      "73": {
        start: {
          line: 256,
          column: 22
        },
        end: {
          line: 256,
          column: 47
        }
      },
      "74": {
        start: {
          line: 257,
          column: 4
        },
        end: {
          line: 257,
          column: 33
        }
      },
      "75": {
        start: {
          line: 261,
          column: 22
        },
        end: {
          line: 261,
          column: 47
        }
      },
      "76": {
        start: {
          line: 262,
          column: 4
        },
        end: {
          line: 262,
          column: 44
        }
      },
      "77": {
        start: {
          line: 265,
          column: 22
        },
        end: {
          line: 265,
          column: 47
        }
      },
      "78": {
        start: {
          line: 266,
          column: 4
        },
        end: {
          line: 266,
          column: 47
        }
      },
      "79": {
        start: {
          line: 269,
          column: 22
        },
        end: {
          line: 269,
          column: 47
        }
      },
      "80": {
        start: {
          line: 270,
          column: 4
        },
        end: {
          line: 270,
          column: 47
        }
      },
      "81": {
        start: {
          line: 273,
          column: 22
        },
        end: {
          line: 273,
          column: 47
        }
      },
      "82": {
        start: {
          line: 274,
          column: 4
        },
        end: {
          line: 274,
          column: 43
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 8,
            column: 4
          },
          end: {
            line: 8,
            column: 5
          }
        },
        loc: {
          start: {
            line: 8,
            column: 18
          },
          end: {
            line: 11,
            column: 5
          }
        },
        line: 8
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 12,
            column: 4
          },
          end: {
            line: 12,
            column: 5
          }
        },
        loc: {
          start: {
            line: 12,
            column: 23
          },
          end: {
            line: 44,
            column: 5
          }
        },
        line: 12
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 48,
            column: 4
          },
          end: {
            line: 48,
            column: 5
          }
        },
        loc: {
          start: {
            line: 48,
            column: 34
          },
          end: {
            line: 88,
            column: 5
          }
        },
        line: 48
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 92,
            column: 4
          },
          end: {
            line: 92,
            column: 5
          }
        },
        loc: {
          start: {
            line: 92,
            column: 46
          },
          end: {
            line: 95,
            column: 5
          }
        },
        line: 92
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 99,
            column: 4
          },
          end: {
            line: 99,
            column: 5
          }
        },
        loc: {
          start: {
            line: 99,
            column: 37
          },
          end: {
            line: 125,
            column: 5
          }
        },
        line: 99
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 118,
            column: 34
          },
          end: {
            line: 118,
            column: 35
          }
        },
        loc: {
          start: {
            line: 118,
            column: 45
          },
          end: {
            line: 118,
            column: 70
          }
        },
        line: 118
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 129,
            column: 4
          },
          end: {
            line: 129,
            column: 5
          }
        },
        loc: {
          start: {
            line: 129,
            column: 35
          },
          end: {
            line: 143,
            column: 5
          }
        },
        line: 129
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 147,
            column: 4
          },
          end: {
            line: 147,
            column: 5
          }
        },
        loc: {
          start: {
            line: 147,
            column: 37
          },
          end: {
            line: 197,
            column: 5
          }
        },
        line: 147
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 185,
            column: 34
          },
          end: {
            line: 185,
            column: 35
          }
        },
        loc: {
          start: {
            line: 185,
            column: 45
          },
          end: {
            line: 185,
            column: 69
          }
        },
        line: 185
      },
      "9": {
        name: "(anonymous_9)",
        decl: {
          start: {
            line: 201,
            column: 4
          },
          end: {
            line: 201,
            column: 5
          }
        },
        loc: {
          start: {
            line: 201,
            column: 33
          },
          end: {
            line: 240,
            column: 5
          }
        },
        line: 201
      },
      "10": {
        name: "(anonymous_10)",
        decl: {
          start: {
            line: 241,
            column: 4
          },
          end: {
            line: 241,
            column: 5
          }
        },
        loc: {
          start: {
            line: 241,
            column: 34
          },
          end: {
            line: 252,
            column: 5
          }
        },
        line: 241
      },
      "11": {
        name: "processBillingJob",
        decl: {
          start: {
            line: 255,
            column: 22
          },
          end: {
            line: 255,
            column: 39
          }
        },
        loc: {
          start: {
            line: 255,
            column: 45
          },
          end: {
            line: 258,
            column: 1
          }
        },
        line: 255
      },
      "12": {
        name: "processExpiringTrialsCron",
        decl: {
          start: {
            line: 260,
            column: 22
          },
          end: {
            line: 260,
            column: 47
          }
        },
        loc: {
          start: {
            line: 260,
            column: 50
          },
          end: {
            line: 263,
            column: 1
          }
        },
        line: 260
      },
      "13": {
        name: "processDunningCron",
        decl: {
          start: {
            line: 264,
            column: 22
          },
          end: {
            line: 264,
            column: 40
          }
        },
        loc: {
          start: {
            line: 264,
            column: 43
          },
          end: {
            line: 267,
            column: 1
          }
        },
        line: 264
      },
      "14": {
        name: "syncSubscriptionsCron",
        decl: {
          start: {
            line: 268,
            column: 22
          },
          end: {
            line: 268,
            column: 43
          }
        },
        loc: {
          start: {
            line: 268,
            column: 46
          },
          end: {
            line: 271,
            column: 1
          }
        },
        line: 268
      },
      "15": {
        name: "generateUsageReportsCron",
        decl: {
          start: {
            line: 272,
            column: 22
          },
          end: {
            line: 272,
            column: 46
          }
        },
        loc: {
          start: {
            line: 272,
            column: 49
          },
          end: {
            line: 275,
            column: 1
          }
        },
        line: 272
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 20,
            column: 12
          },
          end: {
            line: 37,
            column: 13
          }
        },
        type: "switch",
        locations: [{
          start: {
            line: 21,
            column: 16
          },
          end: {
            line: 23,
            column: 26
          }
        }, {
          start: {
            line: 24,
            column: 16
          },
          end: {
            line: 31,
            column: 26
          }
        }, {
          start: {
            line: 32,
            column: 16
          },
          end: {
            line: 34,
            column: 26
          }
        }, {
          start: {
            line: 35,
            column: 16
          },
          end: {
            line: 36,
            column: 73
          }
        }],
        line: 20
      },
      "1": {
        loc: {
          start: {
            line: 25,
            column: 20
          },
          end: {
            line: 30,
            column: 21
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 25,
            column: 20
          },
          end: {
            line: 30,
            column: 21
          }
        }, {
          start: {
            line: 28,
            column: 25
          },
          end: {
            line: 30,
            column: 21
          }
        }],
        line: 25
      },
      "2": {
        loc: {
          start: {
            line: 68,
            column: 16
          },
          end: {
            line: 82,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 68,
            column: 16
          },
          end: {
            line: 82,
            column: 17
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 68
      },
      "3": {
        loc: {
          start: {
            line: 164,
            column: 16
          },
          end: {
            line: 183,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 164,
            column: 16
          },
          end: {
            line: 183,
            column: 17
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 164
      },
      "4": {
        loc: {
          start: {
            line: 172,
            column: 40
          },
          end: {
            line: 174,
            column: 38
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 173,
            column: 34
          },
          end: {
            line: 173,
            column: 81
          }
        }, {
          start: {
            line: 174,
            column: 34
          },
          end: {
            line: 174,
            column: 38
          }
        }],
        line: 172
      },
      "5": {
        loc: {
          start: {
            line: 251,
            column: 15
          },
          end: {
            line: 251,
            column: 71
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 251,
            column: 15
          },
          end: {
            line: 251,
            column: 38
          }
        }, {
          start: {
            line: 251,
            column: 42
          },
          end: {
            line: 251,
            column: 71
          }
        }],
        line: 251
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0,
      "63": 0,
      "64": 0,
      "65": 0,
      "66": 0,
      "67": 0,
      "68": 0,
      "69": 0,
      "70": 0,
      "71": 0,
      "72": 0,
      "73": 0,
      "74": 0,
      "75": 0,
      "76": 0,
      "77": 0,
      "78": 0,
      "79": 0,
      "80": 0,
      "81": 0,
      "82": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0
    },
    b: {
      "0": [0, 0, 0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0]
    },
    inputSourceMap: {
      file: "C:\\Users\\Enzo Marcelo\\Desktop\\Projetos Empresa\\Saas Utmify\\utmify-clone\\apps\\api\\src\\jobs\\billing.job.ts",
      mappings: "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",
      names: [],
      sources: ["C:\\Users\\Enzo Marcelo\\Desktop\\Projetos Empresa\\Saas Utmify\\utmify-clone\\apps\\api\\src\\jobs\\billing.job.ts"],
      sourcesContent: ["import { Job } from 'bull';\nimport { BillingAdvancedService } from '../services/billing-advanced.service';\nimport { PrismaService } from '../database/prisma.service';\nimport { logger } from '../utils/logger';\nimport { SubscriptionStatus, InvoiceStatus } from '@prisma/client';\n\nexport interface BillingJobData {\n  type: 'process_expiring_trials' | 'process_dunning' | 'cleanup_usage_records';\n  organizationId?: string;\n  invoiceId?: string;\n}\n\nexport class BillingJobProcessor {\n  private billingAdvancedService: BillingAdvancedService;\n  private prisma: PrismaService;\n\n  constructor() {\n    this.billingAdvancedService = new BillingAdvancedService();\n    this.prisma = new PrismaService();\n  }\n\n  async process(job: Job<BillingJobData>): Promise<void> {\n    const { type, organizationId, invoiceId } = job.data;\n\n    logger.info(`Processing billing job: ${type}`, {\n      jobId: job.id,\n      organizationId,\n      invoiceId,\n    });\n\n    try {\n      switch (type) {\n        case 'process_expiring_trials':\n          await this.processExpiringTrials();\n          break;\n\n        case 'process_dunning':\n          if (invoiceId) {\n            await this.processDunningForInvoice(invoiceId);\n          } else {\n            await this.processAllFailedInvoices();\n          }\n          break;\n\n        case 'cleanup_usage_records':\n          await this.cleanupOldUsageRecords();\n          break;\n\n        default:\n          throw new Error(`Unknown billing job type: ${type}`);\n      }\n\n      logger.info(`Billing job completed: ${type}`, { jobId: job.id });\n    } catch (error) {\n      logger.error(`Billing job failed: ${type}`, error, { jobId: job.id });\n      throw error;\n    }\n  }\n\n  /**\n   * Process expiring trials\n   */\n  private async processExpiringTrials(): Promise<void> {\n    logger.info('Processing expiring trials...');\n    \n    await this.billingAdvancedService.processExpiringTrials();\n    \n    // Also check for trials that have already expired but subscription is still trialing\n    const expiredTrials = await this.prisma.subscription.findMany({\n      where: {\n        status: SubscriptionStatus.TRIALING,\n        trialEnd: {\n          lt: new Date(),\n        },\n        deletedAt: null,\n      },\n      include: { organization: true },\n    });\n\n    for (const subscription of expiredTrials) {\n      try {\n        // Check Stripe subscription status\n        const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);\n        const stripeSubscription = await stripe.subscriptions.retrieve(\n          subscription.stripeSubscriptionId\n        );\n\n        // Update local status to match Stripe\n        if (stripeSubscription.status !== 'trialing') {\n          await this.prisma.subscription.update({\n            where: { id: subscription.id },\n            data: {\n              status: this.mapStripeStatus(stripeSubscription.status),\n              currentPeriodStart: new Date(stripeSubscription.current_period_start * 1000),\n              currentPeriodEnd: new Date(stripeSubscription.current_period_end * 1000),\n            },\n          });\n\n          logger.info(`Updated expired trial subscription status`, {\n            subscriptionId: subscription.id,\n            oldStatus: 'TRIALING',\n            newStatus: stripeSubscription.status,\n          });\n        }\n      } catch (error) {\n        logger.error(`Error updating expired trial ${subscription.id}:`, error);\n      }\n    }\n  }\n\n  /**\n   * Process dunning for a specific invoice\n   */\n  private async processDunningForInvoice(invoiceId: string): Promise<void> {\n    logger.info(`Processing dunning for invoice: ${invoiceId}`);\n    \n    await this.billingAdvancedService.processDunning(invoiceId);\n  }\n\n  /**\n   * Process dunning for all failed invoices\n   */\n  private async processAllFailedInvoices(): Promise<void> {\n    logger.info('Processing dunning for all failed invoices...');\n    \n    const failedInvoices = await this.prisma.invoice.findMany({\n      where: {\n        status: InvoiceStatus.FAILED,\n        createdAt: {\n          gte: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000), // Last 30 days\n        },\n      },\n      include: {\n        subscription: {\n          include: { organization: true },\n        },\n      },\n    });\n\n    for (const invoice of failedInvoices) {\n      try {\n        await this.billingAdvancedService.processDunning(invoice.id);\n        \n        // Add delay between processing to avoid rate limits\n        await new Promise(resolve => setTimeout(resolve, 1000));\n      } catch (error) {\n        logger.error(`Error processing dunning for invoice ${invoice.id}:`, error);\n      }\n    }\n\n    logger.info(`Processed dunning for ${failedInvoices.length} failed invoices`);\n  }\n\n  /**\n   * Cleanup old usage records (older than 12 months)\n   */\n  private async cleanupOldUsageRecords(): Promise<void> {\n    logger.info('Cleaning up old usage records...');\n    \n    const cutoffDate = new Date();\n    cutoffDate.setMonth(cutoffDate.getMonth() - 12);\n\n    const result = await this.prisma.usageRecord.deleteMany({\n      where: {\n        timestamp: {\n          lt: cutoffDate,\n        },\n      },\n    });\n\n    logger.info(`Cleaned up ${result.count} old usage records`, {\n      cutoffDate,\n    });\n  }\n\n  /**\n   * Sync subscription statuses with Stripe\n   */\n  async syncSubscriptionStatuses(): Promise<void> {\n    logger.info('Syncing subscription statuses with Stripe...');\n    \n    const activeSubscriptions = await this.prisma.subscription.findMany({\n      where: {\n        status: {\n          in: [SubscriptionStatus.ACTIVE, SubscriptionStatus.TRIALING, SubscriptionStatus.PAST_DUE],\n        },\n        deletedAt: null,\n      },\n    });\n\n    const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);\n    let syncedCount = 0;\n    let errorCount = 0;\n\n    for (const subscription of activeSubscriptions) {\n      try {\n        const stripeSubscription = await stripe.subscriptions.retrieve(\n          subscription.stripeSubscriptionId\n        );\n\n        const mappedStatus = this.mapStripeStatus(stripeSubscription.status);\n        \n        if (mappedStatus !== subscription.status) {\n          await this.prisma.subscription.update({\n            where: { id: subscription.id },\n            data: {\n              status: mappedStatus,\n              currentPeriodStart: new Date(stripeSubscription.current_period_start * 1000),\n              currentPeriodEnd: new Date(stripeSubscription.current_period_end * 1000),\n              cancelAtPeriodEnd: stripeSubscription.cancel_at_period_end,\n              canceledAt: stripeSubscription.canceled_at \n                ? new Date(stripeSubscription.canceled_at * 1000) \n                : null,\n            },\n          });\n\n          syncedCount++;\n          logger.info(`Synced subscription status`, {\n            subscriptionId: subscription.id,\n            oldStatus: subscription.status,\n            newStatus: mappedStatus,\n          });\n        }\n\n        // Add delay to avoid rate limits\n        await new Promise(resolve => setTimeout(resolve, 100));\n      } catch (error) {\n        errorCount++;\n        logger.error(`Error syncing subscription ${subscription.id}:`, error);\n      }\n    }\n\n    logger.info(`Subscription sync completed`, {\n      total: activeSubscriptions.length,\n      synced: syncedCount,\n      errors: errorCount,\n    });\n  }\n\n  /**\n   * Generate usage reports for organizations\n   */\n  async generateUsageReports(): Promise<void> {\n    logger.info('Generating usage reports...');\n    \n    const organizations = await this.prisma.organization.findMany({\n      where: {\n        isActive: true,\n        subscription: {\n          some: {\n            status: {\n              in: [SubscriptionStatus.ACTIVE, SubscriptionStatus.TRIALING],\n            },\n            deletedAt: null,\n          },\n        },\n      },\n      include: {\n        subscription: {\n          where: {\n            status: {\n              in: [SubscriptionStatus.ACTIVE, SubscriptionStatus.TRIALING],\n            },\n            deletedAt: null,\n          },\n        },\n      },\n    });\n\n    for (const organization of organizations) {\n      try {\n        const currentUsage = await this.billingAdvancedService.getUsageMetrics(\n          organization.id,\n          'current'\n        );\n        \n        const previousUsage = await this.billingAdvancedService.getUsageMetrics(\n          organization.id,\n          'previous'\n        );\n\n        // TODO: Send usage report email or store in database\n        logger.info(`Usage report generated for organization ${organization.id}`, {\n          current: currentUsage.metrics,\n          previous: previousUsage.metrics,\n        });\n      } catch (error) {\n        logger.error(`Error generating usage report for ${organization.id}:`, error);\n      }\n    }\n  }\n\n  private mapStripeStatus(stripeStatus: string): SubscriptionStatus {\n    const statusMap: Record<string, SubscriptionStatus> = {\n      active: SubscriptionStatus.ACTIVE,\n      canceled: SubscriptionStatus.CANCELED,\n      incomplete: SubscriptionStatus.INCOMPLETE,\n      incomplete_expired: SubscriptionStatus.INCOMPLETE_EXPIRED,\n      past_due: SubscriptionStatus.PAST_DUE,\n      trialing: SubscriptionStatus.TRIALING,\n      unpaid: SubscriptionStatus.UNPAID,\n    };\n\n    return statusMap[stripeStatus] || SubscriptionStatus.INCOMPLETE;\n  }\n}\n\n// Export job processor function for Bull queue\nexport async function processBillingJob(job: Job<BillingJobData>): Promise<void> {\n  const processor = new BillingJobProcessor();\n  await processor.process(job);\n}\n\n// Export cron job functions\nexport async function processExpiringTrialsCron(): Promise<void> {\n  const processor = new BillingJobProcessor();\n  await processor.processExpiringTrials();\n}\n\nexport async function processDunningCron(): Promise<void> {\n  const processor = new BillingJobProcessor();\n  await processor.processAllFailedInvoices();\n}\n\nexport async function syncSubscriptionsCron(): Promise<void> {\n  const processor = new BillingJobProcessor();\n  await processor.syncSubscriptionStatuses();\n}\n\nexport async function generateUsageReportsCron(): Promise<void> {\n  const processor = new BillingJobProcessor();\n  await processor.generateUsageReports();\n}"],
      version: 3
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "023fdd1eefc0a3ddc6ea3a7b076fd5b28fc5c551"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_dwccubu1a = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_dwccubu1a();
import { BillingAdvancedService } from '../services/billing-advanced.service';
import { PrismaService } from '../database/prisma.service';
import { logger } from '../utils/logger';
import { SubscriptionStatus, InvoiceStatus } from '@prisma/client';
export class BillingJobProcessor {
  billingAdvancedService;
  prisma;
  constructor() {
    /* istanbul ignore next */
    cov_dwccubu1a().f[0]++;
    cov_dwccubu1a().s[0]++;
    this.billingAdvancedService = new BillingAdvancedService();
    /* istanbul ignore next */
    cov_dwccubu1a().s[1]++;
    this.prisma = new PrismaService();
  }
  async process(job) {
    /* istanbul ignore next */
    cov_dwccubu1a().f[1]++;
    const {
      type,
      organizationId,
      invoiceId
    } =
    /* istanbul ignore next */
    (cov_dwccubu1a().s[2]++, job.data);
    /* istanbul ignore next */
    cov_dwccubu1a().s[3]++;
    logger.info(`Processing billing job: ${type}`, {
      jobId: job.id,
      organizationId,
      invoiceId
    });
    /* istanbul ignore next */
    cov_dwccubu1a().s[4]++;
    try {
      /* istanbul ignore next */
      cov_dwccubu1a().s[5]++;
      switch (type) {
        case 'process_expiring_trials':
          /* istanbul ignore next */
          cov_dwccubu1a().b[0][0]++;
          cov_dwccubu1a().s[6]++;
          await this.processExpiringTrials();
          /* istanbul ignore next */
          cov_dwccubu1a().s[7]++;
          break;
        case 'process_dunning':
          /* istanbul ignore next */
          cov_dwccubu1a().b[0][1]++;
          cov_dwccubu1a().s[8]++;
          if (invoiceId) {
            /* istanbul ignore next */
            cov_dwccubu1a().b[1][0]++;
            cov_dwccubu1a().s[9]++;
            await this.processDunningForInvoice(invoiceId);
          } else {
            /* istanbul ignore next */
            cov_dwccubu1a().b[1][1]++;
            cov_dwccubu1a().s[10]++;
            await this.processAllFailedInvoices();
          }
          /* istanbul ignore next */
          cov_dwccubu1a().s[11]++;
          break;
        case 'cleanup_usage_records':
          /* istanbul ignore next */
          cov_dwccubu1a().b[0][2]++;
          cov_dwccubu1a().s[12]++;
          await this.cleanupOldUsageRecords();
          /* istanbul ignore next */
          cov_dwccubu1a().s[13]++;
          break;
        default:
          /* istanbul ignore next */
          cov_dwccubu1a().b[0][3]++;
          cov_dwccubu1a().s[14]++;
          throw new Error(`Unknown billing job type: ${type}`);
      }
      /* istanbul ignore next */
      cov_dwccubu1a().s[15]++;
      logger.info(`Billing job completed: ${type}`, {
        jobId: job.id
      });
    } catch (error) {
      /* istanbul ignore next */
      cov_dwccubu1a().s[16]++;
      logger.error(`Billing job failed: ${type}`, error, {
        jobId: job.id
      });
      /* istanbul ignore next */
      cov_dwccubu1a().s[17]++;
      throw error;
    }
  }
  /**
   * Process expiring trials
   */
  async processExpiringTrials() {
    /* istanbul ignore next */
    cov_dwccubu1a().f[2]++;
    cov_dwccubu1a().s[18]++;
    logger.info('Processing expiring trials...');
    /* istanbul ignore next */
    cov_dwccubu1a().s[19]++;
    await this.billingAdvancedService.processExpiringTrials();
    // Also check for trials that have already expired but subscription is still trialing
    const expiredTrials =
    /* istanbul ignore next */
    (cov_dwccubu1a().s[20]++, await this.prisma.subscription.findMany({
      where: {
        status: SubscriptionStatus.TRIALING,
        trialEnd: {
          lt: new Date()
        },
        deletedAt: null
      },
      include: {
        organization: true
      }
    }));
    /* istanbul ignore next */
    cov_dwccubu1a().s[21]++;
    for (const subscription of expiredTrials) {
      /* istanbul ignore next */
      cov_dwccubu1a().s[22]++;
      try {
        // Check Stripe subscription status
        const stripe =
        /* istanbul ignore next */
        (cov_dwccubu1a().s[23]++, require('stripe')(process.env.STRIPE_SECRET_KEY));
        const stripeSubscription =
        /* istanbul ignore next */
        (cov_dwccubu1a().s[24]++, await stripe.subscriptions.retrieve(subscription.stripeSubscriptionId));
        // Update local status to match Stripe
        /* istanbul ignore next */
        cov_dwccubu1a().s[25]++;
        if (stripeSubscription.status !== 'trialing') {
          /* istanbul ignore next */
          cov_dwccubu1a().b[2][0]++;
          cov_dwccubu1a().s[26]++;
          await this.prisma.subscription.update({
            where: {
              id: subscription.id
            },
            data: {
              status: this.mapStripeStatus(stripeSubscription.status),
              currentPeriodStart: new Date(stripeSubscription.current_period_start * 1000),
              currentPeriodEnd: new Date(stripeSubscription.current_period_end * 1000)
            }
          });
          /* istanbul ignore next */
          cov_dwccubu1a().s[27]++;
          logger.info(`Updated expired trial subscription status`, {
            subscriptionId: subscription.id,
            oldStatus: 'TRIALING',
            newStatus: stripeSubscription.status
          });
        } else
        /* istanbul ignore next */
        {
          cov_dwccubu1a().b[2][1]++;
        }
      } catch (error) {
        /* istanbul ignore next */
        cov_dwccubu1a().s[28]++;
        logger.error(`Error updating expired trial ${subscription.id}:`, error);
      }
    }
  }
  /**
   * Process dunning for a specific invoice
   */
  async processDunningForInvoice(invoiceId) {
    /* istanbul ignore next */
    cov_dwccubu1a().f[3]++;
    cov_dwccubu1a().s[29]++;
    logger.info(`Processing dunning for invoice: ${invoiceId}`);
    /* istanbul ignore next */
    cov_dwccubu1a().s[30]++;
    await this.billingAdvancedService.processDunning(invoiceId);
  }
  /**
   * Process dunning for all failed invoices
   */
  async processAllFailedInvoices() {
    /* istanbul ignore next */
    cov_dwccubu1a().f[4]++;
    cov_dwccubu1a().s[31]++;
    logger.info('Processing dunning for all failed invoices...');
    const failedInvoices =
    /* istanbul ignore next */
    (cov_dwccubu1a().s[32]++, await this.prisma.invoice.findMany({
      where: {
        status: InvoiceStatus.FAILED,
        createdAt: {
          gte: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000) // Last 30 days
        }
      },
      include: {
        subscription: {
          include: {
            organization: true
          }
        }
      }
    }));
    /* istanbul ignore next */
    cov_dwccubu1a().s[33]++;
    for (const invoice of failedInvoices) {
      /* istanbul ignore next */
      cov_dwccubu1a().s[34]++;
      try {
        /* istanbul ignore next */
        cov_dwccubu1a().s[35]++;
        await this.billingAdvancedService.processDunning(invoice.id);
        // Add delay between processing to avoid rate limits
        /* istanbul ignore next */
        cov_dwccubu1a().s[36]++;
        await new Promise(resolve => {
          /* istanbul ignore next */
          cov_dwccubu1a().f[5]++;
          cov_dwccubu1a().s[37]++;
          return setTimeout(resolve, 1000);
        });
      } catch (error) {
        /* istanbul ignore next */
        cov_dwccubu1a().s[38]++;
        logger.error(`Error processing dunning for invoice ${invoice.id}:`, error);
      }
    }
    /* istanbul ignore next */
    cov_dwccubu1a().s[39]++;
    logger.info(`Processed dunning for ${failedInvoices.length} failed invoices`);
  }
  /**
   * Cleanup old usage records (older than 12 months)
   */
  async cleanupOldUsageRecords() {
    /* istanbul ignore next */
    cov_dwccubu1a().f[6]++;
    cov_dwccubu1a().s[40]++;
    logger.info('Cleaning up old usage records...');
    const cutoffDate =
    /* istanbul ignore next */
    (cov_dwccubu1a().s[41]++, new Date());
    /* istanbul ignore next */
    cov_dwccubu1a().s[42]++;
    cutoffDate.setMonth(cutoffDate.getMonth() - 12);
    const result =
    /* istanbul ignore next */
    (cov_dwccubu1a().s[43]++, await this.prisma.usageRecord.deleteMany({
      where: {
        timestamp: {
          lt: cutoffDate
        }
      }
    }));
    /* istanbul ignore next */
    cov_dwccubu1a().s[44]++;
    logger.info(`Cleaned up ${result.count} old usage records`, {
      cutoffDate
    });
  }
  /**
   * Sync subscription statuses with Stripe
   */
  async syncSubscriptionStatuses() {
    /* istanbul ignore next */
    cov_dwccubu1a().f[7]++;
    cov_dwccubu1a().s[45]++;
    logger.info('Syncing subscription statuses with Stripe...');
    const activeSubscriptions =
    /* istanbul ignore next */
    (cov_dwccubu1a().s[46]++, await this.prisma.subscription.findMany({
      where: {
        status: {
          in: [SubscriptionStatus.ACTIVE, SubscriptionStatus.TRIALING, SubscriptionStatus.PAST_DUE]
        },
        deletedAt: null
      }
    }));
    const stripe =
    /* istanbul ignore next */
    (cov_dwccubu1a().s[47]++, require('stripe')(process.env.STRIPE_SECRET_KEY));
    let syncedCount =
    /* istanbul ignore next */
    (cov_dwccubu1a().s[48]++, 0);
    let errorCount =
    /* istanbul ignore next */
    (cov_dwccubu1a().s[49]++, 0);
    /* istanbul ignore next */
    cov_dwccubu1a().s[50]++;
    for (const subscription of activeSubscriptions) {
      /* istanbul ignore next */
      cov_dwccubu1a().s[51]++;
      try {
        const stripeSubscription =
        /* istanbul ignore next */
        (cov_dwccubu1a().s[52]++, await stripe.subscriptions.retrieve(subscription.stripeSubscriptionId));
        const mappedStatus =
        /* istanbul ignore next */
        (cov_dwccubu1a().s[53]++, this.mapStripeStatus(stripeSubscription.status));
        /* istanbul ignore next */
        cov_dwccubu1a().s[54]++;
        if (mappedStatus !== subscription.status) {
          /* istanbul ignore next */
          cov_dwccubu1a().b[3][0]++;
          cov_dwccubu1a().s[55]++;
          await this.prisma.subscription.update({
            where: {
              id: subscription.id
            },
            data: {
              status: mappedStatus,
              currentPeriodStart: new Date(stripeSubscription.current_period_start * 1000),
              currentPeriodEnd: new Date(stripeSubscription.current_period_end * 1000),
              cancelAtPeriodEnd: stripeSubscription.cancel_at_period_end,
              canceledAt: stripeSubscription.canceled_at ?
              /* istanbul ignore next */
              (cov_dwccubu1a().b[4][0]++, new Date(stripeSubscription.canceled_at * 1000)) :
              /* istanbul ignore next */
              (cov_dwccubu1a().b[4][1]++, null)
            }
          });
          /* istanbul ignore next */
          cov_dwccubu1a().s[56]++;
          syncedCount++;
          /* istanbul ignore next */
          cov_dwccubu1a().s[57]++;
          logger.info(`Synced subscription status`, {
            subscriptionId: subscription.id,
            oldStatus: subscription.status,
            newStatus: mappedStatus
          });
        } else
        /* istanbul ignore next */
        {
          cov_dwccubu1a().b[3][1]++;
        }
        // Add delay to avoid rate limits
        cov_dwccubu1a().s[58]++;
        await new Promise(resolve => {
          /* istanbul ignore next */
          cov_dwccubu1a().f[8]++;
          cov_dwccubu1a().s[59]++;
          return setTimeout(resolve, 100);
        });
      } catch (error) {
        /* istanbul ignore next */
        cov_dwccubu1a().s[60]++;
        errorCount++;
        /* istanbul ignore next */
        cov_dwccubu1a().s[61]++;
        logger.error(`Error syncing subscription ${subscription.id}:`, error);
      }
    }
    /* istanbul ignore next */
    cov_dwccubu1a().s[62]++;
    logger.info(`Subscription sync completed`, {
      total: activeSubscriptions.length,
      synced: syncedCount,
      errors: errorCount
    });
  }
  /**
   * Generate usage reports for organizations
   */
  async generateUsageReports() {
    /* istanbul ignore next */
    cov_dwccubu1a().f[9]++;
    cov_dwccubu1a().s[63]++;
    logger.info('Generating usage reports...');
    const organizations =
    /* istanbul ignore next */
    (cov_dwccubu1a().s[64]++, await this.prisma.organization.findMany({
      where: {
        isActive: true,
        subscription: {
          some: {
            status: {
              in: [SubscriptionStatus.ACTIVE, SubscriptionStatus.TRIALING]
            },
            deletedAt: null
          }
        }
      },
      include: {
        subscription: {
          where: {
            status: {
              in: [SubscriptionStatus.ACTIVE, SubscriptionStatus.TRIALING]
            },
            deletedAt: null
          }
        }
      }
    }));
    /* istanbul ignore next */
    cov_dwccubu1a().s[65]++;
    for (const organization of organizations) {
      /* istanbul ignore next */
      cov_dwccubu1a().s[66]++;
      try {
        const currentUsage =
        /* istanbul ignore next */
        (cov_dwccubu1a().s[67]++, await this.billingAdvancedService.getUsageMetrics(organization.id, 'current'));
        const previousUsage =
        /* istanbul ignore next */
        (cov_dwccubu1a().s[68]++, await this.billingAdvancedService.getUsageMetrics(organization.id, 'previous'));
        // TODO: Send usage report email or store in database
        /* istanbul ignore next */
        cov_dwccubu1a().s[69]++;
        logger.info(`Usage report generated for organization ${organization.id}`, {
          current: currentUsage.metrics,
          previous: previousUsage.metrics
        });
      } catch (error) {
        /* istanbul ignore next */
        cov_dwccubu1a().s[70]++;
        logger.error(`Error generating usage report for ${organization.id}:`, error);
      }
    }
  }
  mapStripeStatus(stripeStatus) {
    /* istanbul ignore next */
    cov_dwccubu1a().f[10]++;
    const statusMap =
    /* istanbul ignore next */
    (cov_dwccubu1a().s[71]++, {
      active: SubscriptionStatus.ACTIVE,
      canceled: SubscriptionStatus.CANCELED,
      incomplete: SubscriptionStatus.INCOMPLETE,
      incomplete_expired: SubscriptionStatus.INCOMPLETE_EXPIRED,
      past_due: SubscriptionStatus.PAST_DUE,
      trialing: SubscriptionStatus.TRIALING,
      unpaid: SubscriptionStatus.UNPAID
    });
    /* istanbul ignore next */
    cov_dwccubu1a().s[72]++;
    return /* istanbul ignore next */(cov_dwccubu1a().b[5][0]++, statusMap[stripeStatus]) ||
    /* istanbul ignore next */
    (cov_dwccubu1a().b[5][1]++, SubscriptionStatus.INCOMPLETE);
  }
}
// Export job processor function for Bull queue
export async function processBillingJob(job) {
  /* istanbul ignore next */
  cov_dwccubu1a().f[11]++;
  const processor =
  /* istanbul ignore next */
  (cov_dwccubu1a().s[73]++, new BillingJobProcessor());
  /* istanbul ignore next */
  cov_dwccubu1a().s[74]++;
  await processor.process(job);
}
// Export cron job functions
export async function processExpiringTrialsCron() {
  /* istanbul ignore next */
  cov_dwccubu1a().f[12]++;
  const processor =
  /* istanbul ignore next */
  (cov_dwccubu1a().s[75]++, new BillingJobProcessor());
  /* istanbul ignore next */
  cov_dwccubu1a().s[76]++;
  await processor.processExpiringTrials();
}
export async function processDunningCron() {
  /* istanbul ignore next */
  cov_dwccubu1a().f[13]++;
  const processor =
  /* istanbul ignore next */
  (cov_dwccubu1a().s[77]++, new BillingJobProcessor());
  /* istanbul ignore next */
  cov_dwccubu1a().s[78]++;
  await processor.processAllFailedInvoices();
}
export async function syncSubscriptionsCron() {
  /* istanbul ignore next */
  cov_dwccubu1a().f[14]++;
  const processor =
  /* istanbul ignore next */
  (cov_dwccubu1a().s[79]++, new BillingJobProcessor());
  /* istanbul ignore next */
  cov_dwccubu1a().s[80]++;
  await processor.syncSubscriptionStatuses();
}
export async function generateUsageReportsCron() {
  /* istanbul ignore next */
  cov_dwccubu1a().f[15]++;
  const processor =
  /* istanbul ignore next */
  (cov_dwccubu1a().s[81]++, new BillingJobProcessor());
  /* istanbul ignore next */
  cov_dwccubu1a().s[82]++;
  await processor.generateUsageReports();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfZHdjY3VidTFhIiwiYWN0dWFsQ292ZXJhZ2UiLCJCaWxsaW5nQWR2YW5jZWRTZXJ2aWNlIiwiUHJpc21hU2VydmljZSIsImxvZ2dlciIsIlN1YnNjcmlwdGlvblN0YXR1cyIsIkludm9pY2VTdGF0dXMiLCJCaWxsaW5nSm9iUHJvY2Vzc29yIiwiYmlsbGluZ0FkdmFuY2VkU2VydmljZSIsInByaXNtYSIsImNvbnN0cnVjdG9yIiwiZiIsInMiLCJwcm9jZXNzIiwiam9iIiwidHlwZSIsIm9yZ2FuaXphdGlvbklkIiwiaW52b2ljZUlkIiwiZGF0YSIsImluZm8iLCJqb2JJZCIsImlkIiwiYiIsInByb2Nlc3NFeHBpcmluZ1RyaWFscyIsInByb2Nlc3NEdW5uaW5nRm9ySW52b2ljZSIsInByb2Nlc3NBbGxGYWlsZWRJbnZvaWNlcyIsImNsZWFudXBPbGRVc2FnZVJlY29yZHMiLCJFcnJvciIsImVycm9yIiwiZXhwaXJlZFRyaWFscyIsInN1YnNjcmlwdGlvbiIsImZpbmRNYW55Iiwid2hlcmUiLCJzdGF0dXMiLCJUUklBTElORyIsInRyaWFsRW5kIiwibHQiLCJEYXRlIiwiZGVsZXRlZEF0IiwiaW5jbHVkZSIsIm9yZ2FuaXphdGlvbiIsInN0cmlwZSIsInJlcXVpcmUiLCJlbnYiLCJTVFJJUEVfU0VDUkVUX0tFWSIsInN0cmlwZVN1YnNjcmlwdGlvbiIsInN1YnNjcmlwdGlvbnMiLCJyZXRyaWV2ZSIsInN0cmlwZVN1YnNjcmlwdGlvbklkIiwidXBkYXRlIiwibWFwU3RyaXBlU3RhdHVzIiwiY3VycmVudFBlcmlvZFN0YXJ0IiwiY3VycmVudF9wZXJpb2Rfc3RhcnQiLCJjdXJyZW50UGVyaW9kRW5kIiwiY3VycmVudF9wZXJpb2RfZW5kIiwic3Vic2NyaXB0aW9uSWQiLCJvbGRTdGF0dXMiLCJuZXdTdGF0dXMiLCJwcm9jZXNzRHVubmluZyIsImZhaWxlZEludm9pY2VzIiwiaW52b2ljZSIsIkZBSUxFRCIsImNyZWF0ZWRBdCIsImd0ZSIsIm5vdyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImxlbmd0aCIsImN1dG9mZkRhdGUiLCJzZXRNb250aCIsImdldE1vbnRoIiwicmVzdWx0IiwidXNhZ2VSZWNvcmQiLCJkZWxldGVNYW55IiwidGltZXN0YW1wIiwiY291bnQiLCJzeW5jU3Vic2NyaXB0aW9uU3RhdHVzZXMiLCJhY3RpdmVTdWJzY3JpcHRpb25zIiwiaW4iLCJBQ1RJVkUiLCJQQVNUX0RVRSIsInN5bmNlZENvdW50IiwiZXJyb3JDb3VudCIsIm1hcHBlZFN0YXR1cyIsImNhbmNlbEF0UGVyaW9kRW5kIiwiY2FuY2VsX2F0X3BlcmlvZF9lbmQiLCJjYW5jZWxlZEF0IiwiY2FuY2VsZWRfYXQiLCJ0b3RhbCIsInN5bmNlZCIsImVycm9ycyIsImdlbmVyYXRlVXNhZ2VSZXBvcnRzIiwib3JnYW5pemF0aW9ucyIsImlzQWN0aXZlIiwic29tZSIsImN1cnJlbnRVc2FnZSIsImdldFVzYWdlTWV0cmljcyIsInByZXZpb3VzVXNhZ2UiLCJjdXJyZW50IiwibWV0cmljcyIsInByZXZpb3VzIiwic3RyaXBlU3RhdHVzIiwic3RhdHVzTWFwIiwiYWN0aXZlIiwiY2FuY2VsZWQiLCJDQU5DRUxFRCIsImluY29tcGxldGUiLCJJTkNPTVBMRVRFIiwiaW5jb21wbGV0ZV9leHBpcmVkIiwiSU5DT01QTEVURV9FWFBJUkVEIiwicGFzdF9kdWUiLCJ0cmlhbGluZyIsInVucGFpZCIsIlVOUEFJRCIsInByb2Nlc3NCaWxsaW5nSm9iIiwicHJvY2Vzc29yIiwicHJvY2Vzc0V4cGlyaW5nVHJpYWxzQ3JvbiIsInByb2Nlc3NEdW5uaW5nQ3JvbiIsInN5bmNTdWJzY3JpcHRpb25zQ3JvbiIsImdlbmVyYXRlVXNhZ2VSZXBvcnRzQ3JvbiJdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcRW56byBNYXJjZWxvXFxEZXNrdG9wXFxQcm9qZXRvcyBFbXByZXNhXFxTYWFzIFV0bWlmeVxcdXRtaWZ5LWNsb25lXFxhcHBzXFxhcGlcXHNyY1xcam9ic1xcYmlsbGluZy5qb2IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSm9iIH0gZnJvbSAnYnVsbCc7XG5pbXBvcnQgeyBCaWxsaW5nQWR2YW5jZWRTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYmlsbGluZy1hZHZhbmNlZC5zZXJ2aWNlJztcbmltcG9ydCB7IFByaXNtYVNlcnZpY2UgfSBmcm9tICcuLi9kYXRhYmFzZS9wcmlzbWEuc2VydmljZSc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uU3RhdHVzLCBJbnZvaWNlU3RhdHVzIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEJpbGxpbmdKb2JEYXRhIHtcbiAgdHlwZTogJ3Byb2Nlc3NfZXhwaXJpbmdfdHJpYWxzJyB8ICdwcm9jZXNzX2R1bm5pbmcnIHwgJ2NsZWFudXBfdXNhZ2VfcmVjb3Jkcyc7XG4gIG9yZ2FuaXphdGlvbklkPzogc3RyaW5nO1xuICBpbnZvaWNlSWQ/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBCaWxsaW5nSm9iUHJvY2Vzc29yIHtcbiAgcHJpdmF0ZSBiaWxsaW5nQWR2YW5jZWRTZXJ2aWNlOiBCaWxsaW5nQWR2YW5jZWRTZXJ2aWNlO1xuICBwcml2YXRlIHByaXNtYTogUHJpc21hU2VydmljZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmJpbGxpbmdBZHZhbmNlZFNlcnZpY2UgPSBuZXcgQmlsbGluZ0FkdmFuY2VkU2VydmljZSgpO1xuICAgIHRoaXMucHJpc21hID0gbmV3IFByaXNtYVNlcnZpY2UoKTtcbiAgfVxuXG4gIGFzeW5jIHByb2Nlc3Moam9iOiBKb2I8QmlsbGluZ0pvYkRhdGE+KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgeyB0eXBlLCBvcmdhbml6YXRpb25JZCwgaW52b2ljZUlkIH0gPSBqb2IuZGF0YTtcblxuICAgIGxvZ2dlci5pbmZvKGBQcm9jZXNzaW5nIGJpbGxpbmcgam9iOiAke3R5cGV9YCwge1xuICAgICAgam9iSWQ6IGpvYi5pZCxcbiAgICAgIG9yZ2FuaXphdGlvbklkLFxuICAgICAgaW52b2ljZUlkLFxuICAgIH0pO1xuXG4gICAgdHJ5IHtcbiAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlICdwcm9jZXNzX2V4cGlyaW5nX3RyaWFscyc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5wcm9jZXNzRXhwaXJpbmdUcmlhbHMoKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdwcm9jZXNzX2R1bm5pbmcnOlxuICAgICAgICAgIGlmIChpbnZvaWNlSWQpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucHJvY2Vzc0R1bm5pbmdGb3JJbnZvaWNlKGludm9pY2VJZCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucHJvY2Vzc0FsbEZhaWxlZEludm9pY2VzKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ2NsZWFudXBfdXNhZ2VfcmVjb3Jkcyc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5jbGVhbnVwT2xkVXNhZ2VSZWNvcmRzKCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gYmlsbGluZyBqb2IgdHlwZTogJHt0eXBlfWApO1xuICAgICAgfVxuXG4gICAgICBsb2dnZXIuaW5mbyhgQmlsbGluZyBqb2IgY29tcGxldGVkOiAke3R5cGV9YCwgeyBqb2JJZDogam9iLmlkIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoYEJpbGxpbmcgam9iIGZhaWxlZDogJHt0eXBlfWAsIGVycm9yLCB7IGpvYklkOiBqb2IuaWQgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUHJvY2VzcyBleHBpcmluZyB0cmlhbHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0V4cGlyaW5nVHJpYWxzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGxvZ2dlci5pbmZvKCdQcm9jZXNzaW5nIGV4cGlyaW5nIHRyaWFscy4uLicpO1xuICAgIFxuICAgIGF3YWl0IHRoaXMuYmlsbGluZ0FkdmFuY2VkU2VydmljZS5wcm9jZXNzRXhwaXJpbmdUcmlhbHMoKTtcbiAgICBcbiAgICAvLyBBbHNvIGNoZWNrIGZvciB0cmlhbHMgdGhhdCBoYXZlIGFscmVhZHkgZXhwaXJlZCBidXQgc3Vic2NyaXB0aW9uIGlzIHN0aWxsIHRyaWFsaW5nXG4gICAgY29uc3QgZXhwaXJlZFRyaWFscyA9IGF3YWl0IHRoaXMucHJpc21hLnN1YnNjcmlwdGlvbi5maW5kTWFueSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBzdGF0dXM6IFN1YnNjcmlwdGlvblN0YXR1cy5UUklBTElORyxcbiAgICAgICAgdHJpYWxFbmQ6IHtcbiAgICAgICAgICBsdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgZGVsZXRlZEF0OiBudWxsLFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHsgb3JnYW5pemF0aW9uOiB0cnVlIH0sXG4gICAgfSk7XG5cbiAgICBmb3IgKGNvbnN0IHN1YnNjcmlwdGlvbiBvZiBleHBpcmVkVHJpYWxzKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBDaGVjayBTdHJpcGUgc3Vic2NyaXB0aW9uIHN0YXR1c1xuICAgICAgICBjb25zdCBzdHJpcGUgPSByZXF1aXJlKCdzdHJpcGUnKShwcm9jZXNzLmVudi5TVFJJUEVfU0VDUkVUX0tFWSk7XG4gICAgICAgIGNvbnN0IHN0cmlwZVN1YnNjcmlwdGlvbiA9IGF3YWl0IHN0cmlwZS5zdWJzY3JpcHRpb25zLnJldHJpZXZlKFxuICAgICAgICAgIHN1YnNjcmlwdGlvbi5zdHJpcGVTdWJzY3JpcHRpb25JZFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFVwZGF0ZSBsb2NhbCBzdGF0dXMgdG8gbWF0Y2ggU3RyaXBlXG4gICAgICAgIGlmIChzdHJpcGVTdWJzY3JpcHRpb24uc3RhdHVzICE9PSAndHJpYWxpbmcnKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wcmlzbWEuc3Vic2NyaXB0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogc3Vic2NyaXB0aW9uLmlkIH0sXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHN0YXR1czogdGhpcy5tYXBTdHJpcGVTdGF0dXMoc3RyaXBlU3Vic2NyaXB0aW9uLnN0YXR1cyksXG4gICAgICAgICAgICAgIGN1cnJlbnRQZXJpb2RTdGFydDogbmV3IERhdGUoc3RyaXBlU3Vic2NyaXB0aW9uLmN1cnJlbnRfcGVyaW9kX3N0YXJ0ICogMTAwMCksXG4gICAgICAgICAgICAgIGN1cnJlbnRQZXJpb2RFbmQ6IG5ldyBEYXRlKHN0cmlwZVN1YnNjcmlwdGlvbi5jdXJyZW50X3BlcmlvZF9lbmQgKiAxMDAwKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBsb2dnZXIuaW5mbyhgVXBkYXRlZCBleHBpcmVkIHRyaWFsIHN1YnNjcmlwdGlvbiBzdGF0dXNgLCB7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25JZDogc3Vic2NyaXB0aW9uLmlkLFxuICAgICAgICAgICAgb2xkU3RhdHVzOiAnVFJJQUxJTkcnLFxuICAgICAgICAgICAgbmV3U3RhdHVzOiBzdHJpcGVTdWJzY3JpcHRpb24uc3RhdHVzLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoYEVycm9yIHVwZGF0aW5nIGV4cGlyZWQgdHJpYWwgJHtzdWJzY3JpcHRpb24uaWR9OmAsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUHJvY2VzcyBkdW5uaW5nIGZvciBhIHNwZWNpZmljIGludm9pY2VcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0R1bm5pbmdGb3JJbnZvaWNlKGludm9pY2VJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgbG9nZ2VyLmluZm8oYFByb2Nlc3NpbmcgZHVubmluZyBmb3IgaW52b2ljZTogJHtpbnZvaWNlSWR9YCk7XG4gICAgXG4gICAgYXdhaXQgdGhpcy5iaWxsaW5nQWR2YW5jZWRTZXJ2aWNlLnByb2Nlc3NEdW5uaW5nKGludm9pY2VJZCk7XG4gIH1cblxuICAvKipcbiAgICogUHJvY2VzcyBkdW5uaW5nIGZvciBhbGwgZmFpbGVkIGludm9pY2VzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NBbGxGYWlsZWRJbnZvaWNlcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBsb2dnZXIuaW5mbygnUHJvY2Vzc2luZyBkdW5uaW5nIGZvciBhbGwgZmFpbGVkIGludm9pY2VzLi4uJyk7XG4gICAgXG4gICAgY29uc3QgZmFpbGVkSW52b2ljZXMgPSBhd2FpdCB0aGlzLnByaXNtYS5pbnZvaWNlLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHN0YXR1czogSW52b2ljZVN0YXR1cy5GQUlMRUQsXG4gICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgIGd0ZTogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDMwICogMjQgKiA2MCAqIDYwICogMTAwMCksIC8vIExhc3QgMzAgZGF5c1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgc3Vic2NyaXB0aW9uOiB7XG4gICAgICAgICAgaW5jbHVkZTogeyBvcmdhbml6YXRpb246IHRydWUgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBmb3IgKGNvbnN0IGludm9pY2Ugb2YgZmFpbGVkSW52b2ljZXMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYmlsbGluZ0FkdmFuY2VkU2VydmljZS5wcm9jZXNzRHVubmluZyhpbnZvaWNlLmlkKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBkZWxheSBiZXR3ZWVuIHByb2Nlc3NpbmcgdG8gYXZvaWQgcmF0ZSBsaW1pdHNcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgcHJvY2Vzc2luZyBkdW5uaW5nIGZvciBpbnZvaWNlICR7aW52b2ljZS5pZH06YCwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxvZ2dlci5pbmZvKGBQcm9jZXNzZWQgZHVubmluZyBmb3IgJHtmYWlsZWRJbnZvaWNlcy5sZW5ndGh9IGZhaWxlZCBpbnZvaWNlc2ApO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFudXAgb2xkIHVzYWdlIHJlY29yZHMgKG9sZGVyIHRoYW4gMTIgbW9udGhzKVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjbGVhbnVwT2xkVXNhZ2VSZWNvcmRzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGxvZ2dlci5pbmZvKCdDbGVhbmluZyB1cCBvbGQgdXNhZ2UgcmVjb3Jkcy4uLicpO1xuICAgIFxuICAgIGNvbnN0IGN1dG9mZkRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGN1dG9mZkRhdGUuc2V0TW9udGgoY3V0b2ZmRGF0ZS5nZXRNb250aCgpIC0gMTIpO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wcmlzbWEudXNhZ2VSZWNvcmQuZGVsZXRlTWFueSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICB0aW1lc3RhbXA6IHtcbiAgICAgICAgICBsdDogY3V0b2ZmRGF0ZSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBsb2dnZXIuaW5mbyhgQ2xlYW5lZCB1cCAke3Jlc3VsdC5jb3VudH0gb2xkIHVzYWdlIHJlY29yZHNgLCB7XG4gICAgICBjdXRvZmZEYXRlLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFN5bmMgc3Vic2NyaXB0aW9uIHN0YXR1c2VzIHdpdGggU3RyaXBlXG4gICAqL1xuICBhc3luYyBzeW5jU3Vic2NyaXB0aW9uU3RhdHVzZXMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgbG9nZ2VyLmluZm8oJ1N5bmNpbmcgc3Vic2NyaXB0aW9uIHN0YXR1c2VzIHdpdGggU3RyaXBlLi4uJyk7XG4gICAgXG4gICAgY29uc3QgYWN0aXZlU3Vic2NyaXB0aW9ucyA9IGF3YWl0IHRoaXMucHJpc21hLnN1YnNjcmlwdGlvbi5maW5kTWFueSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBzdGF0dXM6IHtcbiAgICAgICAgICBpbjogW1N1YnNjcmlwdGlvblN0YXR1cy5BQ1RJVkUsIFN1YnNjcmlwdGlvblN0YXR1cy5UUklBTElORywgU3Vic2NyaXB0aW9uU3RhdHVzLlBBU1RfRFVFXSxcbiAgICAgICAgfSxcbiAgICAgICAgZGVsZXRlZEF0OiBudWxsLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHN0cmlwZSA9IHJlcXVpcmUoJ3N0cmlwZScpKHByb2Nlc3MuZW52LlNUUklQRV9TRUNSRVRfS0VZKTtcbiAgICBsZXQgc3luY2VkQ291bnQgPSAwO1xuICAgIGxldCBlcnJvckNvdW50ID0gMDtcblxuICAgIGZvciAoY29uc3Qgc3Vic2NyaXB0aW9uIG9mIGFjdGl2ZVN1YnNjcmlwdGlvbnMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHN0cmlwZVN1YnNjcmlwdGlvbiA9IGF3YWl0IHN0cmlwZS5zdWJzY3JpcHRpb25zLnJldHJpZXZlKFxuICAgICAgICAgIHN1YnNjcmlwdGlvbi5zdHJpcGVTdWJzY3JpcHRpb25JZFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IG1hcHBlZFN0YXR1cyA9IHRoaXMubWFwU3RyaXBlU3RhdHVzKHN0cmlwZVN1YnNjcmlwdGlvbi5zdGF0dXMpO1xuICAgICAgICBcbiAgICAgICAgaWYgKG1hcHBlZFN0YXR1cyAhPT0gc3Vic2NyaXB0aW9uLnN0YXR1cykge1xuICAgICAgICAgIGF3YWl0IHRoaXMucHJpc21hLnN1YnNjcmlwdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IHN1YnNjcmlwdGlvbi5pZCB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBzdGF0dXM6IG1hcHBlZFN0YXR1cyxcbiAgICAgICAgICAgICAgY3VycmVudFBlcmlvZFN0YXJ0OiBuZXcgRGF0ZShzdHJpcGVTdWJzY3JpcHRpb24uY3VycmVudF9wZXJpb2Rfc3RhcnQgKiAxMDAwKSxcbiAgICAgICAgICAgICAgY3VycmVudFBlcmlvZEVuZDogbmV3IERhdGUoc3RyaXBlU3Vic2NyaXB0aW9uLmN1cnJlbnRfcGVyaW9kX2VuZCAqIDEwMDApLFxuICAgICAgICAgICAgICBjYW5jZWxBdFBlcmlvZEVuZDogc3RyaXBlU3Vic2NyaXB0aW9uLmNhbmNlbF9hdF9wZXJpb2RfZW5kLFxuICAgICAgICAgICAgICBjYW5jZWxlZEF0OiBzdHJpcGVTdWJzY3JpcHRpb24uY2FuY2VsZWRfYXQgXG4gICAgICAgICAgICAgICAgPyBuZXcgRGF0ZShzdHJpcGVTdWJzY3JpcHRpb24uY2FuY2VsZWRfYXQgKiAxMDAwKSBcbiAgICAgICAgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgc3luY2VkQ291bnQrKztcbiAgICAgICAgICBsb2dnZXIuaW5mbyhgU3luY2VkIHN1YnNjcmlwdGlvbiBzdGF0dXNgLCB7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25JZDogc3Vic2NyaXB0aW9uLmlkLFxuICAgICAgICAgICAgb2xkU3RhdHVzOiBzdWJzY3JpcHRpb24uc3RhdHVzLFxuICAgICAgICAgICAgbmV3U3RhdHVzOiBtYXBwZWRTdGF0dXMsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgZGVsYXkgdG8gYXZvaWQgcmF0ZSBsaW1pdHNcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgZXJyb3JDb3VudCsrO1xuICAgICAgICBsb2dnZXIuZXJyb3IoYEVycm9yIHN5bmNpbmcgc3Vic2NyaXB0aW9uICR7c3Vic2NyaXB0aW9uLmlkfTpgLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbG9nZ2VyLmluZm8oYFN1YnNjcmlwdGlvbiBzeW5jIGNvbXBsZXRlZGAsIHtcbiAgICAgIHRvdGFsOiBhY3RpdmVTdWJzY3JpcHRpb25zLmxlbmd0aCxcbiAgICAgIHN5bmNlZDogc3luY2VkQ291bnQsXG4gICAgICBlcnJvcnM6IGVycm9yQ291bnQsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgdXNhZ2UgcmVwb3J0cyBmb3Igb3JnYW5pemF0aW9uc1xuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVVc2FnZVJlcG9ydHMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgbG9nZ2VyLmluZm8oJ0dlbmVyYXRpbmcgdXNhZ2UgcmVwb3J0cy4uLicpO1xuICAgIFxuICAgIGNvbnN0IG9yZ2FuaXphdGlvbnMgPSBhd2FpdCB0aGlzLnByaXNtYS5vcmdhbml6YXRpb24uZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIHN1YnNjcmlwdGlvbjoge1xuICAgICAgICAgIHNvbWU6IHtcbiAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICBpbjogW1N1YnNjcmlwdGlvblN0YXR1cy5BQ1RJVkUsIFN1YnNjcmlwdGlvblN0YXR1cy5UUklBTElOR10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVsZXRlZEF0OiBudWxsLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBzdWJzY3JpcHRpb246IHtcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgICAgIGluOiBbU3Vic2NyaXB0aW9uU3RhdHVzLkFDVElWRSwgU3Vic2NyaXB0aW9uU3RhdHVzLlRSSUFMSU5HXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZWxldGVkQXQ6IG51bGwsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBmb3IgKGNvbnN0IG9yZ2FuaXphdGlvbiBvZiBvcmdhbml6YXRpb25zKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjdXJyZW50VXNhZ2UgPSBhd2FpdCB0aGlzLmJpbGxpbmdBZHZhbmNlZFNlcnZpY2UuZ2V0VXNhZ2VNZXRyaWNzKFxuICAgICAgICAgIG9yZ2FuaXphdGlvbi5pZCxcbiAgICAgICAgICAnY3VycmVudCdcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHByZXZpb3VzVXNhZ2UgPSBhd2FpdCB0aGlzLmJpbGxpbmdBZHZhbmNlZFNlcnZpY2UuZ2V0VXNhZ2VNZXRyaWNzKFxuICAgICAgICAgIG9yZ2FuaXphdGlvbi5pZCxcbiAgICAgICAgICAncHJldmlvdXMnXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gVE9ETzogU2VuZCB1c2FnZSByZXBvcnQgZW1haWwgb3Igc3RvcmUgaW4gZGF0YWJhc2VcbiAgICAgICAgbG9nZ2VyLmluZm8oYFVzYWdlIHJlcG9ydCBnZW5lcmF0ZWQgZm9yIG9yZ2FuaXphdGlvbiAke29yZ2FuaXphdGlvbi5pZH1gLCB7XG4gICAgICAgICAgY3VycmVudDogY3VycmVudFVzYWdlLm1ldHJpY3MsXG4gICAgICAgICAgcHJldmlvdXM6IHByZXZpb3VzVXNhZ2UubWV0cmljcyxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgdXNhZ2UgcmVwb3J0IGZvciAke29yZ2FuaXphdGlvbi5pZH06YCwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbWFwU3RyaXBlU3RhdHVzKHN0cmlwZVN0YXR1czogc3RyaW5nKTogU3Vic2NyaXB0aW9uU3RhdHVzIHtcbiAgICBjb25zdCBzdGF0dXNNYXA6IFJlY29yZDxzdHJpbmcsIFN1YnNjcmlwdGlvblN0YXR1cz4gPSB7XG4gICAgICBhY3RpdmU6IFN1YnNjcmlwdGlvblN0YXR1cy5BQ1RJVkUsXG4gICAgICBjYW5jZWxlZDogU3Vic2NyaXB0aW9uU3RhdHVzLkNBTkNFTEVELFxuICAgICAgaW5jb21wbGV0ZTogU3Vic2NyaXB0aW9uU3RhdHVzLklOQ09NUExFVEUsXG4gICAgICBpbmNvbXBsZXRlX2V4cGlyZWQ6IFN1YnNjcmlwdGlvblN0YXR1cy5JTkNPTVBMRVRFX0VYUElSRUQsXG4gICAgICBwYXN0X2R1ZTogU3Vic2NyaXB0aW9uU3RhdHVzLlBBU1RfRFVFLFxuICAgICAgdHJpYWxpbmc6IFN1YnNjcmlwdGlvblN0YXR1cy5UUklBTElORyxcbiAgICAgIHVucGFpZDogU3Vic2NyaXB0aW9uU3RhdHVzLlVOUEFJRCxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHN0YXR1c01hcFtzdHJpcGVTdGF0dXNdIHx8IFN1YnNjcmlwdGlvblN0YXR1cy5JTkNPTVBMRVRFO1xuICB9XG59XG5cbi8vIEV4cG9ydCBqb2IgcHJvY2Vzc29yIGZ1bmN0aW9uIGZvciBCdWxsIHF1ZXVlXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0JpbGxpbmdKb2Ioam9iOiBKb2I8QmlsbGluZ0pvYkRhdGE+KTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHByb2Nlc3NvciA9IG5ldyBCaWxsaW5nSm9iUHJvY2Vzc29yKCk7XG4gIGF3YWl0IHByb2Nlc3Nvci5wcm9jZXNzKGpvYik7XG59XG5cbi8vIEV4cG9ydCBjcm9uIGpvYiBmdW5jdGlvbnNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcm9jZXNzRXhwaXJpbmdUcmlhbHNDcm9uKCk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBwcm9jZXNzb3IgPSBuZXcgQmlsbGluZ0pvYlByb2Nlc3NvcigpO1xuICBhd2FpdCBwcm9jZXNzb3IucHJvY2Vzc0V4cGlyaW5nVHJpYWxzKCk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcm9jZXNzRHVubmluZ0Nyb24oKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHByb2Nlc3NvciA9IG5ldyBCaWxsaW5nSm9iUHJvY2Vzc29yKCk7XG4gIGF3YWl0IHByb2Nlc3Nvci5wcm9jZXNzQWxsRmFpbGVkSW52b2ljZXMoKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN5bmNTdWJzY3JpcHRpb25zQ3JvbigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgcHJvY2Vzc29yID0gbmV3IEJpbGxpbmdKb2JQcm9jZXNzb3IoKTtcbiAgYXdhaXQgcHJvY2Vzc29yLnN5bmNTdWJzY3JpcHRpb25TdGF0dXNlcygpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVVc2FnZVJlcG9ydHNDcm9uKCk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBwcm9jZXNzb3IgPSBuZXcgQmlsbGluZ0pvYlByb2Nlc3NvcigpO1xuICBhd2FpdCBwcm9jZXNzb3IuZ2VuZXJhdGVVc2FnZVJlcG9ydHMoKTtcbn0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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
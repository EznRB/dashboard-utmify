cb839c3ad5c98696d7fcc3964adfdfd9
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Mock Twilio
globals_1.jest.mock('twilio', () => ({
    default: globals_1.jest.fn(() => ({
        messages: {
            create: globals_1.jest.fn()
        }
    }))
}));
const whatsapp_service_1 = require("../services/whatsapp.service");
const twilio_1 = __importDefault(require("twilio"));
// Mock Bull Queue
const mockQueue = {
    add: globals_1.jest.fn(),
    process: globals_1.jest.fn(),
    on: globals_1.jest.fn()
};
(0, globals_1.describe)('WhatsAppService', () => {
    let whatsappService;
    let prismaService;
    let cryptoService;
    let mockTwilioClient;
    (0, globals_1.beforeEach)(() => {
        // Mock PrismaService
        prismaService = {
            whatsAppConfig: {
                findUnique: globals_1.jest.fn(),
                create: globals_1.jest.fn(),
                update: globals_1.jest.fn()
            },
            whatsAppMessage: {
                create: globals_1.jest.fn(),
                findMany: globals_1.jest.fn(),
                count: globals_1.jest.fn(),
                update: globals_1.jest.fn()
            },
            whatsAppMetrics: {
                findFirst: globals_1.jest.fn(),
                create: globals_1.jest.fn(),
                update: globals_1.jest.fn(),
                findMany: globals_1.jest.fn()
            },
            user: {
                findUnique: globals_1.jest.fn()
            }
        };
        // Mock CryptoService
        cryptoService = {
            encrypt: globals_1.jest.fn().mockReturnValue('encrypted_token'),
            decrypt: globals_1.jest.fn().mockReturnValue('decrypted_token')
        };
        // Mock Twilio client
        mockTwilioClient = {
            messages: {
                create: globals_1.jest.fn().mockResolvedValue({
                    sid: 'test_message_sid',
                    status: 'queued'
                })
            }
        };
        globals_1.jest.mocked(twilio_1.default).mockReturnValue(mockTwilioClient);
        whatsappService = new whatsapp_service_1.WhatsAppService(prismaService, mockQueue, cryptoService);
    });
    (0, globals_1.afterEach)(() => {
        globals_1.jest.clearAllMocks();
    });
    (0, globals_1.describe)('getConfig', () => {
        (0, globals_1.it)('should return WhatsApp config for user', async () => {
            const mockConfig = {
                id: 'config-1',
                userId: 'user-1',
                twilioAccountSid: 'test_sid',
                twilioAuthToken: 'encrypted_token',
                twilioPhoneNumber: '+1234567890',
                isActive: true,
                dailyLimit: 1000,
                messagesUsedToday: 50,
                createdAt: new Date(),
                updatedAt: new Date()
            };
            prismaService.whatsAppConfig.findUnique = globals_1.jest.fn().mockResolvedValue(mockConfig);
            cryptoService.decrypt = globals_1.jest.fn().mockReturnValue('decrypted_token');
            const result = await whatsappService.getConfig('user-1');
            (0, globals_1.expect)(result).toEqual({
                ...mockConfig,
                twilioAuthToken: 'decrypted_token'
            });
            (0, globals_1.expect)(prismaService.whatsAppConfig.findUnique).toHaveBeenCalledWith({
                where: { userId: 'user-1' }
            });
        });
        (0, globals_1.it)('should return null if config not found', async () => {
            prismaService.whatsAppConfig.findUnique = globals_1.jest.fn().mockResolvedValue(null);
            const result = await whatsappService.getConfig('user-1');
            (0, globals_1.expect)(result).toBeNull();
        });
    });
    (0, globals_1.describe)('updateConfig', () => {
        (0, globals_1.it)('should create new config if not exists', async () => {
            const configData = {
                twilioAccountSid: 'new_sid',
                twilioAuthToken: 'new_token',
                twilioPhoneNumber: '+1234567890',
                dailyLimit: 1000
            };
            const mockCreatedConfig = {
                id: 'config-1',
                userId: 'user-1',
                ...configData,
                twilioAuthToken: 'encrypted_token',
                isActive: true,
                messagesUsedToday: 0,
                createdAt: new Date(),
                updatedAt: new Date()
            };
            prismaService.whatsAppConfig.findUnique = globals_1.jest.fn().mockResolvedValue(null);
            prismaService.whatsAppConfig.create = globals_1.jest.fn().mockResolvedValue(mockCreatedConfig);
            cryptoService.encrypt = globals_1.jest.fn().mockReturnValue('encrypted_token');
            cryptoService.decrypt = globals_1.jest.fn().mockReturnValue('new_token');
            const result = await whatsappService.updateConfig('user-1', configData);
            (0, globals_1.expect)(cryptoService.encrypt).toHaveBeenCalledWith('new_token');
            (0, globals_1.expect)(prismaService.whatsAppConfig.create).toHaveBeenCalledWith({
                data: {
                    userId: 'user-1',
                    twilioAccountSid: 'new_sid',
                    twilioAuthToken: 'encrypted_token',
                    twilioPhoneNumber: '+1234567890',
                    dailyLimit: 1000,
                    isActive: true
                }
            });
            (0, globals_1.expect)(result.twilioAuthToken).toBe('new_token');
        });
        (0, globals_1.it)('should update existing config', async () => {
            const existingConfig = {
                id: 'config-1',
                userId: 'user-1',
                twilioAccountSid: 'old_sid',
                twilioAuthToken: 'old_encrypted_token',
                twilioPhoneNumber: '+0987654321',
                isActive: true,
                dailyLimit: 500,
                messagesUsedToday: 10,
                createdAt: new Date(),
                updatedAt: new Date()
            };
            const updateData = {
                twilioAccountSid: 'new_sid',
                dailyLimit: 1000
            };
            const updatedConfig = {
                ...existingConfig,
                ...updateData,
                updatedAt: new Date()
            };
            prismaService.whatsAppConfig.findUnique = globals_1.jest.fn().mockResolvedValue(existingConfig);
            prismaService.whatsAppConfig.update = globals_1.jest.fn().mockResolvedValue(updatedConfig);
            cryptoService.decrypt = globals_1.jest.fn().mockReturnValue('decrypted_token');
            const result = await whatsappService.updateConfig('user-1', updateData);
            (0, globals_1.expect)(prismaService.whatsAppConfig.update).toHaveBeenCalledWith({
                where: { userId: 'user-1' },
                data: updateData
            });
            (0, globals_1.expect)(result).toEqual({
                ...updatedConfig,
                twilioAuthToken: 'decrypted_token'
            });
        });
    });
    (0, globals_1.describe)('sendMessage', () => {
        const mockConfig = {
            id: 'config-1',
            userId: 'user-1',
            twilioAccountSid: 'test_sid',
            twilioAuthToken: 'encrypted_token',
            twilioPhoneNumber: '+1234567890',
            isActive: true,
            dailyLimit: 1000,
            messagesUsedToday: 50,
            createdAt: new Date(),
            updatedAt: new Date()
        };
        (0, globals_1.beforeEach)(() => {
            prismaService.whatsAppConfig.findUnique = globals_1.jest.fn().mockResolvedValue(mockConfig);
            cryptoService.decrypt = globals_1.jest.fn().mockReturnValue('decrypted_token');
        });
        (0, globals_1.it)('should send message successfully', async () => {
            const messageData = {
                to: '+1987654321',
                message: 'Hello, World!'
            };
            const mockCreatedMessage = {
                id: 'msg-1',
                userId: 'user-1',
                to: messageData.to,
                from: mockConfig.twilioPhoneNumber,
                body: messageData.message,
                status: 'queued',
                messageType: 'text',
                twilioSid: 'test_message_sid',
                createdAt: new Date(),
                updatedAt: new Date()
            };
            prismaService.whatsAppMessage.create = globals_1.jest.fn().mockResolvedValue(mockCreatedMessage);
            mockQueue.add = globals_1.jest.fn().mockResolvedValue({ id: 'job-1' });
            const result = await whatsappService.sendMessage('user-1', messageData);
            (0, globals_1.expect)(mockQueue.add).toHaveBeenCalledWith('send-message', {
                userId: 'user-1',
                to: messageData.to,
                message: messageData.message
            }, {
                delay: 0,
                attempts: 3,
                backoff: {
                    type: 'exponential',
                    delay: 2000
                }
            });
            (0, globals_1.expect)(result).toEqual(mockCreatedMessage);
        });
        (0, globals_1.it)('should throw error if config not found', async () => {
            prismaService.whatsAppConfig.findUnique = globals_1.jest.fn().mockResolvedValue(null);
            await (0, globals_1.expect)(whatsappService.sendMessage('user-1', {
                to: '+1987654321',
                message: 'Hello'
            })).rejects.toThrow('WhatsApp não configurado');
        });
        (0, globals_1.it)('should throw error if config is inactive', async () => {
            const inactiveConfig = { ...mockConfig, isActive: false };
            prismaService.whatsAppConfig.findUnique = globals_1.jest.fn().mockResolvedValue(inactiveConfig);
            await (0, globals_1.expect)(whatsappService.sendMessage('user-1', {
                to: '+1987654321',
                message: 'Hello'
            })).rejects.toThrow('WhatsApp está desativado');
        });
        (0, globals_1.it)('should throw error if daily limit exceeded', async () => {
            const limitExceededConfig = { ...mockConfig, messagesUsedToday: 1000 };
            prismaService.whatsAppConfig.findUnique = globals_1.jest.fn().mockResolvedValue(limitExceededConfig);
            await (0, globals_1.expect)(whatsappService.sendMessage('user-1', {
                to: '+1987654321',
                message: 'Hello'
            })).rejects.toThrow('Limite diário de mensagens atingido');
        });
    });
    (0, globals_1.describe)('getMessages', () => {
        (0, globals_1.it)('should return paginated messages', async () => {
            const mockMessages = [
                {
                    id: 'msg-1',
                    userId: 'user-1',
                    to: '+1987654321',
                    from: '+1234567890',
                    body: 'Hello',
                    status: 'delivered',
                    messageType: 'text',
                    createdAt: new Date(),
                    updatedAt: new Date()
                },
                {
                    id: 'msg-2',
                    userId: 'user-1',
                    to: '+1987654321',
                    from: '+1234567890',
                    body: 'World',
                    status: 'sent',
                    messageType: 'text',
                    createdAt: new Date(),
                    updatedAt: new Date()
                }
            ];
            prismaService.whatsAppMessage.findMany = globals_1.jest.fn().mockResolvedValue(mockMessages);
            prismaService.whatsAppMessage.count = globals_1.jest.fn().mockResolvedValue(2);
            const result = await whatsappService.getMessages('user-1', 1, 10);
            (0, globals_1.expect)(result).toEqual({
                messages: mockMessages,
                total: 2,
                page: 1,
                limit: 10,
                totalPages: 1
            });
            (0, globals_1.expect)(prismaService.whatsAppMessage.findMany).toHaveBeenCalledWith({
                where: { userId: 'user-1' },
                orderBy: { createdAt: 'desc' },
                skip: 0,
                take: 10
            });
        });
    });
    (0, globals_1.describe)('getDashboardStats', () => {
        (0, globals_1.it)('should return dashboard statistics', async () => {
            const mockConfig = {
                dailyLimit: 1000,
                messagesUsedToday: 150
            };
            const mockStats = {
                totalMessages: 500,
                messagesThisMonth: 300,
                deliveredMessages: 450,
                failedMessages: 50
            };
            prismaService.whatsAppConfig.findUnique = globals_1.jest.fn().mockResolvedValue(mockConfig);
            // Mock message counts
            prismaService.whatsAppMessage.count
                .mockResolvedValueOnce(500) // total
                .mockResolvedValueOnce(300) // this month
                .mockResolvedValueOnce(450) // delivered
                .mockResolvedValueOnce(50); // failed
            const result = await whatsappService.getDashboardStats('user-1');
            (0, globals_1.expect)(result).toEqual({
                totalMessages: 500,
                messagesThisMonth: 300,
                deliveryRate: 90, // 450/500 * 100
                activeConversations: 0,
                activeAutomations: 0,
                dailyUsage: 150,
                dailyLimit: 1000
            });
        });
    });
    (0, globals_1.describe)('testConnection', () => {
        (0, globals_1.it)('should test connection successfully', async () => {
            const mockConfig = {
                twilioAccountSid: 'test_sid',
                twilioAuthToken: 'encrypted_token',
                twilioPhoneNumber: '+1234567890'
            };
            prismaService.whatsAppConfig.findUnique = globals_1.jest.fn().mockResolvedValue(mockConfig);
            cryptoService.decrypt = globals_1.jest.fn().mockReturnValue('decrypted_token');
            mockTwilioClient.messages.create.mockResolvedValue({
                sid: 'test_sid',
                status: 'queued'
            });
            const result = await whatsappService.testConnection('user-1');
            (0, globals_1.expect)(result).toEqual({
                success: true,
                message: 'Conexão testada com sucesso'
            });
        });
        (0, globals_1.it)('should handle connection error', async () => {
            const mockConfig = {
                twilioAccountSid: 'test_sid',
                twilioAuthToken: 'encrypted_token',
                twilioPhoneNumber: '+1234567890'
            };
            prismaService.whatsAppConfig.findUnique = globals_1.jest.fn().mockResolvedValue(mockConfig);
            cryptoService.decrypt = globals_1.jest.fn().mockReturnValue('decrypted_token');
            mockTwilioClient.messages.create.mockRejectedValue(new Error('Invalid credentials'));
            const result = await whatsappService.testConnection('user-1');
            (0, globals_1.expect)(result).toEqual({
                success: false,
                message: 'Erro na conexão: Invalid credentials'
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxFbnpvIE1hcmNlbG9cXERlc2t0b3BcXFByb2pldG9zIEVtcHJlc2FcXFNhYXMgVXRtaWZ5XFx1dG1pZnktY2xvbmVcXGFwcHNcXGFwaVxcc3JjXFx0ZXN0c1xcd2hhdHNhcHAuc2VydmljZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsMkNBQWlGO0FBTWpGLGNBQWM7QUFDZCxjQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3pCLE9BQU8sRUFBRSxjQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDdEIsUUFBUSxFQUFFO1lBQ1IsTUFBTSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7U0FDbEI7S0FDRixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMsQ0FBQTtBQVpILG1FQUE4RDtBQUc5RCxvREFBMkI7QUFXM0Isa0JBQWtCO0FBQ2xCLE1BQU0sU0FBUyxHQUFHO0lBQ2hCLEdBQUcsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2QsT0FBTyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7SUFDbEIsRUFBRSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDZCxDQUFBO0FBRUQsSUFBQSxrQkFBUSxFQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQixJQUFJLGVBQWdDLENBQUE7SUFDcEMsSUFBSSxhQUE0QixDQUFBO0lBQ2hDLElBQUksYUFBNEIsQ0FBQTtJQUNoQyxJQUFJLGdCQUFxQixDQUFBO0lBRXpCLElBQUEsb0JBQVUsRUFBQyxHQUFHLEVBQUU7UUFDZCxxQkFBcUI7UUFDckIsYUFBYSxHQUFHO1lBQ2QsY0FBYyxFQUFFO2dCQUNkLFVBQVUsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNyQixNQUFNLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtnQkFDakIsTUFBTSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7YUFDbEI7WUFDRCxlQUFlLEVBQUU7Z0JBQ2Ys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RUFBRSxJQUFJO2dCQUNiLE9BQU8sRUFBRSw2QkFBNkI7YUFDdkMsQ0FBQyxDQUFBO1FBQ0osQ0FBQyxDQUFDLENBQUE7UUFFRixJQUFBLFlBQUUsRUFBQyxnQ0FBZ0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5QyxNQUFNLFVBQVUsR0FBRztnQkFDakIsZ0JBQWdCLEVBQUUsVUFBVTtnQkFDNUIsZUFBZSxFQUFFLGlCQUFpQjtnQkFDbEMsaUJBQWlCLEVBQUUsYUFBYTthQUNqQyxDQUFBO1lBRUQsYUFBYSxDQUFDLGNBQWMsQ0FBQyxVQUFVLEdBQUcsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxDQUFBO1lBQ2pGLGFBQWEsQ0FBQyxPQUFPLEdBQUcsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO1lBRXBFLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsSUFBSSxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFBO1lBRXBGLE1BQU0sTUFBTSxHQUFHLE1BQU0sZUFBZSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQTtZQUU3RCxJQUFBLGdCQUFNLEVBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDO2dCQUNyQixPQUFPLEVBQUUsS0FBSztnQkFDZCxPQUFPLEVBQUUsc0NBQXNDO2FBQ2hELENBQUMsQ0FBQTtRQUNKLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUMsQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEVuem8gTWFyY2Vsb1xcRGVza3RvcFxcUHJvamV0b3MgRW1wcmVzYVxcU2FhcyBVdG1pZnlcXHV0bWlmeS1jbG9uZVxcYXBwc1xcYXBpXFxzcmNcXHRlc3RzXFx3aGF0c2FwcC5zZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCwgamVzdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnXG5pbXBvcnQgeyBXaGF0c0FwcFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy93aGF0c2FwcC5zZXJ2aWNlJ1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJy4uL2RhdGFiYXNlL3ByaXNtYS5zZXJ2aWNlJ1xuaW1wb3J0IHsgQ3J5cHRvU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2NyeXB0by5zZXJ2aWNlJ1xuaW1wb3J0IHR3aWxpbyBmcm9tICd0d2lsaW8nXG5cbi8vIE1vY2sgVHdpbGlvXG5qZXN0Lm1vY2soJ3R3aWxpbycsICgpID0+ICh7XG4gIGRlZmF1bHQ6IGplc3QuZm4oKCkgPT4gKHtcbiAgICBtZXNzYWdlczoge1xuICAgICAgY3JlYXRlOiBqZXN0LmZuKClcbiAgICB9XG4gIH0pKVxufSkpXG5cbi8vIE1vY2sgQnVsbCBRdWV1ZVxuY29uc3QgbW9ja1F1ZXVlID0ge1xuICBhZGQ6IGplc3QuZm4oKSxcbiAgcHJvY2VzczogamVzdC5mbigpLFxuICBvbjogamVzdC5mbigpXG59XG5cbmRlc2NyaWJlKCdXaGF0c0FwcFNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCB3aGF0c2FwcFNlcnZpY2U6IFdoYXRzQXBwU2VydmljZVxuICBsZXQgcHJpc21hU2VydmljZTogUHJpc21hU2VydmljZVxuICBsZXQgY3J5cHRvU2VydmljZTogQ3J5cHRvU2VydmljZVxuICBsZXQgbW9ja1R3aWxpb0NsaWVudDogYW55XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgLy8gTW9jayBQcmlzbWFTZXJ2aWNlXG4gICAgcHJpc21hU2VydmljZSA9IHtcbiAgICAgIHdoYXRzQXBwQ29uZmlnOiB7XG4gICAgICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKSxcbiAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICAgIHVwZGF0ZTogamVzdC5mbigpXG4gICAgICB9LFxuICAgICAgd2hhdHNBcHBNZXNzYWdlOiB7XG4gICAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgICBmaW5kTWFueTogamVzdC5mbigpLFxuICAgICAgICBjb3VudDogamVzdC5mbigpLFxuICAgICAgICB1cGRhdGU6IGplc3QuZm4oKVxuICAgICAgfSxcbiAgICAgIHdoYXRzQXBwTWV0cmljczoge1xuICAgICAgICBmaW5kRmlyc3Q6IGplc3QuZm4oKSxcbiAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgICAgICBmaW5kTWFueTogamVzdC5mbigpXG4gICAgICB9LFxuICAgICAgdXNlcjoge1xuICAgICAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKClcbiAgICAgIH1cbiAgICB9IGFzIGFueVxuXG4gICAgLy8gTW9jayBDcnlwdG9TZXJ2aWNlXG4gICAgY3J5cHRvU2VydmljZSA9IHtcbiAgICAgIGVuY3J5cHQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ2VuY3J5cHRlZF90b2tlbicpLFxuICAgICAgZGVjcnlwdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnZGVjcnlwdGVkX3Rva2VuJylcbiAgICB9IGFzIGFueVxuXG4gICAgLy8gTW9jayBUd2lsaW8gY2xpZW50XG4gICAgbW9ja1R3aWxpb0NsaWVudCA9IHtcbiAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgIGNyZWF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICBzaWQ6ICd0ZXN0X21lc3NhZ2Vfc2lkJyxcbiAgICAgICAgICBzdGF0dXM6ICdxdWV1ZWQnXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuXG4gICAgamVzdC5tb2NrZWQodHdpbGlvKS5tb2NrUmV0dXJuVmFsdWUobW9ja1R3aWxpb0NsaWVudClcblxuICAgIHdoYXRzYXBwU2VydmljZSA9IG5ldyBXaGF0c0FwcFNlcnZpY2UoXG4gICAgICBwcmlzbWFTZXJ2aWNlLFxuICAgICAgbW9ja1F1ZXVlIGFzIGFueSxcbiAgICAgIGNyeXB0b1NlcnZpY2VcbiAgICApXG4gIH0pXG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKVxuICB9KVxuXG4gIGRlc2NyaWJlKCdnZXRDb25maWcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gV2hhdHNBcHAgY29uZmlnIGZvciB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0NvbmZpZyA9IHtcbiAgICAgICAgaWQ6ICdjb25maWctMScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHR3aWxpb0FjY291bnRTaWQ6ICd0ZXN0X3NpZCcsXG4gICAgICAgIHR3aWxpb0F1dGhUb2tlbjogJ2VuY3J5cHRlZF90b2tlbicsXG4gICAgICAgIHR3aWxpb1Bob25lTnVtYmVyOiAnKzEyMzQ1Njc4OTAnLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgZGFpbHlMaW1pdDogMTAwMCxcbiAgICAgICAgbWVzc2FnZXNVc2VkVG9kYXk6IDUwLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxuICAgICAgfVxuXG4gICAgICBwcmlzbWFTZXJ2aWNlLndoYXRzQXBwQ29uZmlnLmZpbmRVbmlxdWUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbmZpZylcbiAgICAgIGNyeXB0b1NlcnZpY2UuZGVjcnlwdCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ2RlY3J5cHRlZF90b2tlbicpXG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdoYXRzYXBwU2VydmljZS5nZXRDb25maWcoJ3VzZXItMScpXG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICAuLi5tb2NrQ29uZmlnLFxuICAgICAgICB0d2lsaW9BdXRoVG9rZW46ICdkZWNyeXB0ZWRfdG9rZW4nXG4gICAgICB9KVxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2Uud2hhdHNBcHBDb25maWcuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6ICd1c2VyLTEnIH1cbiAgICAgIH0pXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgaWYgY29uZmlnIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2Uud2hhdHNBcHBDb25maWcuZmluZFVuaXF1ZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3aGF0c2FwcFNlcnZpY2UuZ2V0Q29uZmlnKCd1c2VyLTEnKVxuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpXG4gICAgfSlcbiAgfSlcblxuICBkZXNjcmliZSgndXBkYXRlQ29uZmlnJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIG5ldyBjb25maWcgaWYgbm90IGV4aXN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZ0RhdGEgPSB7XG4gICAgICAgIHR3aWxpb0FjY291bnRTaWQ6ICduZXdfc2lkJyxcbiAgICAgICAgdHdpbGlvQXV0aFRva2VuOiAnbmV3X3Rva2VuJyxcbiAgICAgICAgdHdpbGlvUGhvbmVOdW1iZXI6ICcrMTIzNDU2Nzg5MCcsXG4gICAgICAgIGRhaWx5TGltaXQ6IDEwMDBcbiAgICAgIH1cblxuICAgICAgY29uc3QgbW9ja0NyZWF0ZWRDb25maWcgPSB7XG4gICAgICAgIGlkOiAnY29uZmlnLTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICAuLi5jb25maWdEYXRhLFxuICAgICAgICB0d2lsaW9BdXRoVG9rZW46ICdlbmNyeXB0ZWRfdG9rZW4nLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZXNVc2VkVG9kYXk6IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICB9XG5cbiAgICAgIHByaXNtYVNlcnZpY2Uud2hhdHNBcHBDb25maWcuZmluZFVuaXF1ZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKVxuICAgICAgcHJpc21hU2VydmljZS53aGF0c0FwcENvbmZpZy5jcmVhdGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NyZWF0ZWRDb25maWcpXG4gICAgICBjcnlwdG9TZXJ2aWNlLmVuY3J5cHQgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdlbmNyeXB0ZWRfdG9rZW4nKVxuICAgICAgY3J5cHRvU2VydmljZS5kZWNyeXB0ID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnbmV3X3Rva2VuJylcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2hhdHNhcHBTZXJ2aWNlLnVwZGF0ZUNvbmZpZygndXNlci0xJywgY29uZmlnRGF0YSlcblxuICAgICAgZXhwZWN0KGNyeXB0b1NlcnZpY2UuZW5jcnlwdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ25ld190b2tlbicpXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS53aGF0c0FwcENvbmZpZy5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgICAgdHdpbGlvQWNjb3VudFNpZDogJ25ld19zaWQnLFxuICAgICAgICAgIHR3aWxpb0F1dGhUb2tlbjogJ2VuY3J5cHRlZF90b2tlbicsXG4gICAgICAgICAgdHdpbGlvUGhvbmVOdW1iZXI6ICcrMTIzNDU2Nzg5MCcsXG4gICAgICAgICAgZGFpbHlMaW1pdDogMTAwMCxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgZXhwZWN0KHJlc3VsdC50d2lsaW9BdXRoVG9rZW4pLnRvQmUoJ25ld190b2tlbicpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIGV4aXN0aW5nIGNvbmZpZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nQ29uZmlnID0ge1xuICAgICAgICBpZDogJ2NvbmZpZy0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgdHdpbGlvQWNjb3VudFNpZDogJ29sZF9zaWQnLFxuICAgICAgICB0d2lsaW9BdXRoVG9rZW46ICdvbGRfZW5jcnlwdGVkX3Rva2VuJyxcbiAgICAgICAgdHdpbGlvUGhvbmVOdW1iZXI6ICcrMDk4NzY1NDMyMScsXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICBkYWlseUxpbWl0OiA1MDAsXG4gICAgICAgIG1lc3NhZ2VzVXNlZFRvZGF5OiAxMCxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgIH1cblxuICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHtcbiAgICAgICAgdHdpbGlvQWNjb3VudFNpZDogJ25ld19zaWQnLFxuICAgICAgICBkYWlseUxpbWl0OiAxMDAwXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHVwZGF0ZWRDb25maWcgPSB7XG4gICAgICAgIC4uLmV4aXN0aW5nQ29uZmlnLFxuICAgICAgICAuLi51cGRhdGVEYXRhLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgIH1cblxuICAgICAgcHJpc21hU2VydmljZS53aGF0c0FwcENvbmZpZy5maW5kVW5pcXVlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKGV4aXN0aW5nQ29uZmlnKVxuICAgICAgcHJpc21hU2VydmljZS53aGF0c0FwcENvbmZpZy51cGRhdGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodXBkYXRlZENvbmZpZylcbiAgICAgIGNyeXB0b1NlcnZpY2UuZGVjcnlwdCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ2RlY3J5cHRlZF90b2tlbicpXG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdoYXRzYXBwU2VydmljZS51cGRhdGVDb25maWcoJ3VzZXItMScsIHVwZGF0ZURhdGEpXG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLndoYXRzQXBwQ29uZmlnLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6ICd1c2VyLTEnIH0sXG4gICAgICAgIGRhdGE6IHVwZGF0ZURhdGFcbiAgICAgIH0pXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgLi4udXBkYXRlZENvbmZpZyxcbiAgICAgICAgdHdpbGlvQXV0aFRva2VuOiAnZGVjcnlwdGVkX3Rva2VuJ1xuICAgICAgfSlcbiAgICB9KVxuICB9KVxuXG4gIGRlc2NyaWJlKCdzZW5kTWVzc2FnZScsICgpID0+IHtcbiAgICBjb25zdCBtb2NrQ29uZmlnID0ge1xuICAgICAgaWQ6ICdjb25maWctMScsXG4gICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgdHdpbGlvQWNjb3VudFNpZDogJ3Rlc3Rfc2lkJyxcbiAgICAgIHR3aWxpb0F1dGhUb2tlbjogJ2VuY3J5cHRlZF90b2tlbicsXG4gICAgICB0d2lsaW9QaG9uZU51bWJlcjogJysxMjM0NTY3ODkwJyxcbiAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgZGFpbHlMaW1pdDogMTAwMCxcbiAgICAgIG1lc3NhZ2VzVXNlZFRvZGF5OiA1MCxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxuICAgIH1cblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS53aGF0c0FwcENvbmZpZy5maW5kVW5pcXVlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb25maWcpXG4gICAgICBjcnlwdG9TZXJ2aWNlLmRlY3J5cHQgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdkZWNyeXB0ZWRfdG9rZW4nKVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIHNlbmQgbWVzc2FnZSBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlRGF0YSA9IHtcbiAgICAgICAgdG86ICcrMTk4NzY1NDMyMScsXG4gICAgICAgIG1lc3NhZ2U6ICdIZWxsbywgV29ybGQhJ1xuICAgICAgfVxuXG4gICAgICBjb25zdCBtb2NrQ3JlYXRlZE1lc3NhZ2UgPSB7XG4gICAgICAgIGlkOiAnbXNnLTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICB0bzogbWVzc2FnZURhdGEudG8sXG4gICAgICAgIGZyb206IG1vY2tDb25maWcudHdpbGlvUGhvbmVOdW1iZXIsXG4gICAgICAgIGJvZHk6IG1lc3NhZ2VEYXRhLm1lc3NhZ2UsXG4gICAgICAgIHN0YXR1czogJ3F1ZXVlZCcsXG4gICAgICAgIG1lc3NhZ2VUeXBlOiAndGV4dCcsXG4gICAgICAgIHR3aWxpb1NpZDogJ3Rlc3RfbWVzc2FnZV9zaWQnLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxuICAgICAgfVxuXG4gICAgICBwcmlzbWFTZXJ2aWNlLndoYXRzQXBwTWVzc2FnZS5jcmVhdGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NyZWF0ZWRNZXNzYWdlKVxuICAgICAgbW9ja1F1ZXVlLmFkZCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAnam9iLTEnIH0pXG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdoYXRzYXBwU2VydmljZS5zZW5kTWVzc2FnZSgndXNlci0xJywgbWVzc2FnZURhdGEpXG5cbiAgICAgIGV4cGVjdChtb2NrUXVldWUuYWRkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ3NlbmQtbWVzc2FnZScsXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICAgIHRvOiBtZXNzYWdlRGF0YS50byxcbiAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlRGF0YS5tZXNzYWdlXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWxheTogMCxcbiAgICAgICAgICBhdHRlbXB0czogMyxcbiAgICAgICAgICBiYWNrb2ZmOiB7XG4gICAgICAgICAgICB0eXBlOiAnZXhwb25lbnRpYWwnLFxuICAgICAgICAgICAgZGVsYXk6IDIwMDBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0NyZWF0ZWRNZXNzYWdlKVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGlmIGNvbmZpZyBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLndoYXRzQXBwQ29uZmlnLmZpbmRVbmlxdWUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobnVsbClcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICB3aGF0c2FwcFNlcnZpY2Uuc2VuZE1lc3NhZ2UoJ3VzZXItMScsIHtcbiAgICAgICAgICB0bzogJysxOTg3NjU0MzIxJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSGVsbG8nXG4gICAgICAgIH0pXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnV2hhdHNBcHAgbsOjbyBjb25maWd1cmFkbycpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgaWYgY29uZmlnIGlzIGluYWN0aXZlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW5hY3RpdmVDb25maWcgPSB7IC4uLm1vY2tDb25maWcsIGlzQWN0aXZlOiBmYWxzZSB9XG4gICAgICBwcmlzbWFTZXJ2aWNlLndoYXRzQXBwQ29uZmlnLmZpbmRVbmlxdWUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoaW5hY3RpdmVDb25maWcpXG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgd2hhdHNhcHBTZXJ2aWNlLnNlbmRNZXNzYWdlKCd1c2VyLTEnLCB7XG4gICAgICAgICAgdG86ICcrMTk4NzY1NDMyMScsXG4gICAgICAgICAgbWVzc2FnZTogJ0hlbGxvJ1xuICAgICAgICB9KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ1doYXRzQXBwIGVzdMOhIGRlc2F0aXZhZG8nKVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGlmIGRhaWx5IGxpbWl0IGV4Y2VlZGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbGltaXRFeGNlZWRlZENvbmZpZyA9IHsgLi4ubW9ja0NvbmZpZywgbWVzc2FnZXNVc2VkVG9kYXk6IDEwMDAgfVxuICAgICAgcHJpc21hU2VydmljZS53aGF0c0FwcENvbmZpZy5maW5kVW5pcXVlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKGxpbWl0RXhjZWVkZWRDb25maWcpXG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgd2hhdHNhcHBTZXJ2aWNlLnNlbmRNZXNzYWdlKCd1c2VyLTEnLCB7XG4gICAgICAgICAgdG86ICcrMTk4NzY1NDMyMScsXG4gICAgICAgICAgbWVzc2FnZTogJ0hlbGxvJ1xuICAgICAgICB9KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ0xpbWl0ZSBkacOhcmlvIGRlIG1lbnNhZ2VucyBhdGluZ2lkbycpXG4gICAgfSlcbiAgfSlcblxuICBkZXNjcmliZSgnZ2V0TWVzc2FnZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcGFnaW5hdGVkIG1lc3NhZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja01lc3NhZ2VzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdtc2ctMScsXG4gICAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgICB0bzogJysxOTg3NjU0MzIxJyxcbiAgICAgICAgICBmcm9tOiAnKzEyMzQ1Njc4OTAnLFxuICAgICAgICAgIGJvZHk6ICdIZWxsbycsXG4gICAgICAgICAgc3RhdHVzOiAnZGVsaXZlcmVkJyxcbiAgICAgICAgICBtZXNzYWdlVHlwZTogJ3RleHQnLFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnbXNnLTInLFxuICAgICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgICAgdG86ICcrMTk4NzY1NDMyMScsXG4gICAgICAgICAgZnJvbTogJysxMjM0NTY3ODkwJyxcbiAgICAgICAgICBib2R5OiAnV29ybGQnLFxuICAgICAgICAgIHN0YXR1czogJ3NlbnQnLFxuICAgICAgICAgIG1lc3NhZ2VUeXBlOiAndGV4dCcsXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxuICAgICAgICB9XG4gICAgICBdXG5cbiAgICAgIHByaXNtYVNlcnZpY2Uud2hhdHNBcHBNZXNzYWdlLmZpbmRNYW55ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZXNzYWdlcylcbiAgICAgIHByaXNtYVNlcnZpY2Uud2hhdHNBcHBNZXNzYWdlLmNvdW50ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKDIpXG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdoYXRzYXBwU2VydmljZS5nZXRNZXNzYWdlcygndXNlci0xJywgMSwgMTApXG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBtZXNzYWdlczogbW9ja01lc3NhZ2VzLFxuICAgICAgICB0b3RhbDogMixcbiAgICAgICAgcGFnZTogMSxcbiAgICAgICAgbGltaXQ6IDEwLFxuICAgICAgICB0b3RhbFBhZ2VzOiAxXG4gICAgICB9KVxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2Uud2hhdHNBcHBNZXNzYWdlLmZpbmRNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogJ3VzZXItMScgfSxcbiAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICBza2lwOiAwLFxuICAgICAgICB0YWtlOiAxMFxuICAgICAgfSlcbiAgICB9KVxuICB9KVxuXG4gIGRlc2NyaWJlKCdnZXREYXNoYm9hcmRTdGF0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBkYXNoYm9hcmQgc3RhdGlzdGljcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tDb25maWcgPSB7XG4gICAgICAgIGRhaWx5TGltaXQ6IDEwMDAsXG4gICAgICAgIG1lc3NhZ2VzVXNlZFRvZGF5OiAxNTBcbiAgICAgIH1cblxuICAgICAgY29uc3QgbW9ja1N0YXRzID0ge1xuICAgICAgICB0b3RhbE1lc3NhZ2VzOiA1MDAsXG4gICAgICAgIG1lc3NhZ2VzVGhpc01vbnRoOiAzMDAsXG4gICAgICAgIGRlbGl2ZXJlZE1lc3NhZ2VzOiA0NTAsXG4gICAgICAgIGZhaWxlZE1lc3NhZ2VzOiA1MFxuICAgICAgfVxuXG4gICAgICBwcmlzbWFTZXJ2aWNlLndoYXRzQXBwQ29uZmlnLmZpbmRVbmlxdWUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbmZpZylcbiAgICAgIFxuICAgICAgLy8gTW9jayBtZXNzYWdlIGNvdW50c1xuICAgICAgcHJpc21hU2VydmljZS53aGF0c0FwcE1lc3NhZ2UuY291bnRcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSg1MDApIC8vIHRvdGFsXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoMzAwKSAvLyB0aGlzIG1vbnRoXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoNDUwKSAvLyBkZWxpdmVyZWRcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSg1MCkgIC8vIGZhaWxlZFxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3aGF0c2FwcFNlcnZpY2UuZ2V0RGFzaGJvYXJkU3RhdHMoJ3VzZXItMScpXG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICB0b3RhbE1lc3NhZ2VzOiA1MDAsXG4gICAgICAgIG1lc3NhZ2VzVGhpc01vbnRoOiAzMDAsXG4gICAgICAgIGRlbGl2ZXJ5UmF0ZTogOTAsIC8vIDQ1MC81MDAgKiAxMDBcbiAgICAgICAgYWN0aXZlQ29udmVyc2F0aW9uczogMCxcbiAgICAgICAgYWN0aXZlQXV0b21hdGlvbnM6IDAsXG4gICAgICAgIGRhaWx5VXNhZ2U6IDE1MCxcbiAgICAgICAgZGFpbHlMaW1pdDogMTAwMFxuICAgICAgfSlcbiAgICB9KVxuICB9KVxuXG4gIGRlc2NyaWJlKCd0ZXN0Q29ubmVjdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHRlc3QgY29ubmVjdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQ29uZmlnID0ge1xuICAgICAgICB0d2lsaW9BY2NvdW50U2lkOiAndGVzdF9zaWQnLFxuICAgICAgICB0d2lsaW9BdXRoVG9rZW46ICdlbmNyeXB0ZWRfdG9rZW4nLFxuICAgICAgICB0d2lsaW9QaG9uZU51bWJlcjogJysxMjM0NTY3ODkwJ1xuICAgICAgfVxuXG4gICAgICBwcmlzbWFTZXJ2aWNlLndoYXRzQXBwQ29uZmlnLmZpbmRVbmlxdWUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbmZpZylcbiAgICAgIGNyeXB0b1NlcnZpY2UuZGVjcnlwdCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ2RlY3J5cHRlZF90b2tlbicpXG4gICAgICBcbiAgICAgIG1vY2tUd2lsaW9DbGllbnQubWVzc2FnZXMuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc2lkOiAndGVzdF9zaWQnLFxuICAgICAgICBzdGF0dXM6ICdxdWV1ZWQnXG4gICAgICB9KVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3aGF0c2FwcFNlcnZpY2UudGVzdENvbm5lY3Rpb24oJ3VzZXItMScpXG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnQ29uZXjDo28gdGVzdGFkYSBjb20gc3VjZXNzbydcbiAgICAgIH0pXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbm5lY3Rpb24gZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQ29uZmlnID0ge1xuICAgICAgICB0d2lsaW9BY2NvdW50U2lkOiAndGVzdF9zaWQnLFxuICAgICAgICB0d2lsaW9BdXRoVG9rZW46ICdlbmNyeXB0ZWRfdG9rZW4nLFxuICAgICAgICB0d2lsaW9QaG9uZU51bWJlcjogJysxMjM0NTY3ODkwJ1xuICAgICAgfVxuXG4gICAgICBwcmlzbWFTZXJ2aWNlLndoYXRzQXBwQ29uZmlnLmZpbmRVbmlxdWUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbmZpZylcbiAgICAgIGNyeXB0b1NlcnZpY2UuZGVjcnlwdCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ2RlY3J5cHRlZF90b2tlbicpXG4gICAgICBcbiAgICAgIG1vY2tUd2lsaW9DbGllbnQubWVzc2FnZXMuY3JlYXRlLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignSW52YWxpZCBjcmVkZW50aWFscycpKVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3aGF0c2FwcFNlcnZpY2UudGVzdENvbm5lY3Rpb24oJ3VzZXItMScpXG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0Vycm8gbmEgY29uZXjDo286IEludmFsaWQgY3JlZGVudGlhbHMnXG4gICAgICB9KVxuICAgIH0pXG4gIH0pXG59KSJdLCJ2ZXJzaW9uIjozfQ==
9ade87c233db5910ace41c398f31b9ef
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.GoogleAdsService = void 0;
const google_ads_api_1 = require("google-ads-api");
const axios_1 = __importDefault(require("axios"));
const env_1 = require("../config/env");
const logger_1 = require("../utils/logger");
const errors_1 = require("../utils/errors");
class GoogleAdsService {
    prisma;
    cryptoService;
    maxRetries = 3;
    retryDelay = 1000;
    googleAdsClients = new Map();
    constructor(prisma, cryptoService) {
        this.prisma = prisma;
        this.cryptoService = cryptoService;
    }
    /**
     * Generate OAuth 2.0 authorization URL
     */
    generateAuthUrl(userId, redirectUri) {
        if (!env_1.googleAdsConfig) {
            throw new errors_1.ApiError('Google Ads integration not configured', 'GOOGLE_ADS_NOT_CONFIGURED', 400);
        }
        const state = this.cryptoService.encrypt(JSON.stringify({ userId, redirectUri }));
        const scopes = ['https://www.googleapis.com/auth/adwords'];
        const params = new URLSearchParams({
            client_id: env_1.googleAdsConfig.clientId,
            redirect_uri: redirectUri,
            scope: scopes.join(' '),
            response_type: 'code',
            access_type: 'offline',
            prompt: 'consent',
            state,
        });
        return `https://accounts.google.com/o/oauth2/v2/auth?${params.toString()}`;
    }
    /**
     * Exchange authorization code for tokens
     */
    async exchangeCodeForToken(code, redirectUri) {
        if (!env_1.googleAdsConfig) {
            throw new errors_1.ApiError('Google Ads integration not configured', 'GOOGLE_ADS_NOT_CONFIGURED', 400);
        }
        try {
            const response = await axios_1.default.post('https://oauth2.googleapis.com/token', {
                client_id: env_1.googleAdsConfig.clientId,
                client_secret: env_1.googleAdsConfig.clientSecret,
                code,
                grant_type: 'authorization_code',
                redirect_uri: redirectUri,
            });
            return response.data;
        }
        catch (error) {
            logger_1.logger.error('Failed to exchange code for token', error);
            throw new errors_1.ApiError('Failed to exchange authorization code', 'TOKEN_EXCHANGE_FAILED', 400);
        }
    }
    /**
     * Refresh access token
     */
    async refreshAccessToken(refreshToken) {
        if (!env_1.googleAdsConfig) {
            throw new errors_1.ApiError('Google Ads integration not configured', 'GOOGLE_ADS_NOT_CONFIGURED', 400);
        }
        try {
            const response = await axios_1.default.post('https://oauth2.googleapis.com/token', {
                client_id: env_1.googleAdsConfig.clientId,
                client_secret: env_1.googleAdsConfig.clientSecret,
                refresh_token: refreshToken,
                grant_type: 'refresh_token',
            });
            return {
                ...response.data,
                refresh_token: refreshToken, // Keep the original refresh token
            };
        }
        catch (error) {
            logger_1.logger.error('Failed to refresh access token', error);
            throw new errors_1.ApiError('Failed to refresh access token', 'TOKEN_REFRESH_FAILED', 401);
        }
    }
    /**
     * Store OAuth tokens securely
     */
    async storeTokens(userId, tokens) {
        const encryptedAccessToken = this.cryptoService.encrypt(tokens.access_token);
        const encryptedRefreshToken = this.cryptoService.encrypt(tokens.refresh_token);
        const expiresAt = new Date(Date.now() + tokens.expires_in * 1000);
        await this.prisma.integration.upsert({
            where: {
                userId_platform: {
                    userId,
                    platform: 'GOOGLE_ADS',
                },
            },
            update: {
                accessToken: encryptedAccessToken,
                refreshToken: encryptedRefreshToken,
                expiresAt,
                isActive: true,
                lastSync: new Date(),
            },
            create: {
                userId,
                platform: 'GOOGLE_ADS',
                accessToken: encryptedAccessToken,
                refreshToken: encryptedRefreshToken,
                expiresAt,
                isActive: true,
                lastSync: new Date(),
            },
        });
        this.logger.log(`Stored Google Ads tokens for user ${userId}`);
    }
    /**
     * Get valid access token (refresh if needed)
     */
    async getAccessToken(userId) {
        const integration = await this.prisma.integration.findUnique({
            where: {
                userId_platform: {
                    userId,
                    platform: 'GOOGLE_ADS',
                },
            },
        });
        if (!integration || !integration.isActive) {
            throw new errors_1.ApiError('Google Ads integration not found or inactive', 'INTEGRATION_NOT_FOUND', 401);
        }
        // Check if token is expired
        if (integration.expiresAt && integration.expiresAt <= new Date()) {
            const refreshToken = this.cryptoService.decrypt(integration.refreshToken);
            const newTokens = await this.refreshAccessToken(refreshToken);
            await this.storeTokens(userId, newTokens);
            return newTokens.access_token;
        }
        return this.cryptoService.decrypt(integration.accessToken);
    }
    /**
     * Get Google Ads API client for user
     */
    async getGoogleAdsClient(userId) {
        if (!env_1.googleAdsConfig) {
            throw new errors_1.ApiError('Google Ads integration not configured', 'GOOGLE_ADS_NOT_CONFIGURED', 400);
        }
        const cacheKey = `google-ads-client-${userId}`;
        if (this.googleAdsClients.has(cacheKey)) {
            return this.googleAdsClients.get(cacheKey);
        }
        const accessToken = await this.getAccessToken(userId);
        const client = new google_ads_api_1.GoogleAdsApi({
            client_id: env_1.googleAdsConfig.clientId,
            client_secret: env_1.googleAdsConfig.clientSecret,
            developer_token: env_1.googleAdsConfig.developerToken,
        });
        // Set the access token for the client
        client.Customer.credentials = {
            access_token: accessToken,
        };
        this.googleAdsClients.set(cacheKey, client);
        return client;
    }
    /**
     * Get accessible customer accounts
     */
    async getCustomerAccounts(userId) {
        try {
            const client = await this.getGoogleAdsClient(userId);
            const query = `
        SELECT 
          customer.id,
          customer.descriptive_name,
          customer.currency_code,
          customer.time_zone,
          customer.status,
          customer.manager
        FROM customer
        WHERE customer.status = 'ENABLED'
      `;
            const customers = await client.Customer().report({
                query,
                login_customer_id: env_1.googleAdsConfig?.loginCustomerId,
            });
            return customers.map((customer) => ({
                id: customer.customer.id.toString(),
                name: customer.customer.descriptive_name || `Customer ${customer.customer.id}`,
                currency: customer.customer.currency_code,
                timezone: customer.customer.time_zone,
                status: customer.customer.status,
                type: customer.customer.manager ? 'MANAGER' : 'CLIENT',
            }));
        }
        catch (error) {
            logger_1.logger.error('Failed to get customer accounts', error);
            throw new errors_1.ApiError('Failed to retrieve customer accounts', 'CUSTOMER_ACCOUNTS_FAILED', 400);
        }
    }
    /**
     * Get campaigns for a customer
     */
    async getCampaigns(userId, customerId) {
        try {
            const client = await this.getGoogleAdsClient(userId);
            const query = `
        SELECT 
          campaign.id,
          campaign.name,
          campaign.status,
          campaign.advertising_channel_type,
          campaign.start_date,
          campaign.end_date,
          campaign_budget.amount_micros,
          campaign_budget.type
        FROM campaign
        WHERE campaign.status != 'REMOVED'
        ORDER BY campaign.name
      `;
            const campaigns = await client.Customer({ customer_id: customerId }).report({
                query,
            });
            return campaigns.map((campaign) => ({
                id: campaign.campaign.id.toString(),
                name: campaign.campaign.name,
                status: campaign.campaign.status,
                type: campaign.campaign.advertising_channel_type,
                start_date: campaign.campaign.start_date,
                end_date: campaign.campaign.end_date,
                budget_amount: campaign.campaign_budget?.amount_micros ?
                    parseInt(campaign.campaign_budget.amount_micros) / 1000000 : undefined,
                budget_type: campaign.campaign_budget?.type,
                customer_id: customerId,
            }));
        }
        catch (error) {
            logger_1.logger.error('Failed to get campaigns', error);
            throw new errors_1.ApiError('Failed to retrieve campaigns', 'CAMPAIGNS_FAILED', 400);
        }
    }
    /**
     * Get keywords for campaigns
     */
    async getKeywords(userId, customerId, campaignIds) {
        try {
            const client = await this.getGoogleAdsClient(userId);
            let whereClause = 'ad_group_criterion.status != "REMOVED" AND ad_group_criterion.type = "KEYWORD"';
            if (campaignIds && campaignIds.length > 0) {
                const campaignFilter = campaignIds.map(id => `"${id}"`).join(',');
                whereClause += ` AND campaign.id IN (${campaignFilter})`;
            }
            const query = `
        SELECT 
          ad_group_criterion.criterion_id,
          ad_group_criterion.keyword.text,
          ad_group_criterion.keyword.match_type,
          ad_group_criterion.status,
          ad_group_criterion.quality_info.quality_score,
          ad_group_criterion.position_estimates.first_page_cpc_micros,
          ad_group_criterion.position_estimates.top_of_page_cpc_micros,
          campaign.id,
          ad_group.id
        FROM keyword_view
        WHERE ${whereClause}
        ORDER BY ad_group_criterion.keyword.text
      `;
            const keywords = await client.Customer({ customer_id: customerId }).report({
                query,
            });
            return keywords.map((keyword) => ({
                id: keyword.ad_group_criterion.criterion_id.toString(),
                text: keyword.ad_group_criterion.keyword.text,
                match_type: keyword.ad_group_criterion.keyword.match_type,
                status: keyword.ad_group_criterion.status,
                quality_score: keyword.ad_group_criterion.quality_info?.quality_score,
                first_page_cpc: keyword.ad_group_criterion.position_estimates?.first_page_cpc_micros ?
                    parseInt(keyword.ad_group_criterion.position_estimates.first_page_cpc_micros) / 1000000 : undefined,
                top_of_page_cpc: keyword.ad_group_criterion.position_estimates?.top_of_page_cpc_micros ?
                    parseInt(keyword.ad_group_criterion.position_estimates.top_of_page_cpc_micros) / 1000000 : undefined,
                campaign_id: keyword.campaign.id.toString(),
                ad_group_id: keyword.ad_group.id.toString(),
            }));
        }
        catch (error) {
            logger_1.logger.error('Failed to get keywords', error);
            throw new errors_1.ApiError('Failed to retrieve keywords', 'KEYWORDS_FAILED', 400);
        }
    }
    /**
     * Get campaign performance metrics
     */
    async getCampaignMetrics(userId, customerId, dateRange) {
        try {
            const client = await this.getGoogleAdsClient(userId);
            let dateFilter = '';
            if (dateRange) {
                dateFilter = `AND segments.date >= '${dateRange.startDate}' AND segments.date <= '${dateRange.endDate}'`;
            }
            const query = `
        SELECT 
          campaign.id,
          segments.date,
          metrics.impressions,
          metrics.clicks,
          metrics.cost_micros,
          metrics.conversions,
          metrics.ctr,
          metrics.average_cpc
        FROM campaign
        WHERE campaign.status != 'REMOVED' ${dateFilter}
        ORDER BY segments.date DESC, campaign.name
      `;
            const metrics = await client.Customer({ customer_id: customerId }).report({
                query,
            });
            return metrics.map((metric) => ({
                campaign_id: metric.campaign.id.toString(),
                impressions: parseInt(metric.metrics.impressions) || 0,
                clicks: parseInt(metric.metrics.clicks) || 0,
                cost_micros: parseInt(metric.metrics.cost_micros) || 0,
                conversions: parseFloat(metric.metrics.conversions) || 0,
                ctr: parseFloat(metric.metrics.ctr) || 0,
                average_cpc: parseInt(metric.metrics.average_cpc) || 0,
                cost_per_conversion: metric.metrics.conversions > 0 ?
                    parseInt(metric.metrics.cost_micros) / parseFloat(metric.metrics.conversions) / 1000000 : undefined,
                date: metric.segments.date,
            }));
        }
        catch (error) {
            logger_1.logger.error('Failed to get campaign metrics', error);
            throw new errors_1.ApiError('Failed to retrieve campaign metrics', 'CAMPAIGN_METRICS_FAILED', 400);
        }
    }
    /**
     * Get search terms report
     */
    async getSearchTermsReport(userId, customerId, dateRange) {
        try {
            const client = await this.getGoogleAdsClient(userId);
            let dateFilter = '';
            if (dateRange) {
                dateFilter = `AND segments.date >= '${dateRange.startDate}' AND segments.date <= '${dateRange.endDate}'`;
            }
            const query = `
        SELECT 
          search_term_view.search_term,
          metrics.impressions,
          metrics.clicks,
          metrics.cost_micros,
          metrics.conversions,
          campaign.id,
          ad_group.id,
          ad_group_criterion.criterion_id
        FROM search_term_view
        WHERE search_term_view.status != 'NONE' ${dateFilter}
        ORDER BY metrics.impressions DESC
      `;
            const searchTerms = await client.Customer({ customer_id: customerId }).report({
                query,
            });
            return searchTerms.map((term) => ({
                search_term: term.search_term_view.search_term,
                impressions: parseInt(term.metrics.impressions) || 0,
                clicks: parseInt(term.metrics.clicks) || 0,
                cost_micros: parseInt(term.metrics.cost_micros) || 0,
                conversions: parseFloat(term.metrics.conversions) || 0,
                campaign_id: term.campaign.id.toString(),
                ad_group_id: term.ad_group.id.toString(),
                keyword_id: term.ad_group_criterion?.criterion_id?.toString(),
            }));
        }
        catch (error) {
            logger_1.logger.error('Failed to get search terms report', error);
            throw new errors_1.ApiError('Failed to retrieve search terms report', 'SEARCH_TERMS_FAILED', 400);
        }
    }
    /**
     * Sync user data from Google Ads
     */
    async syncUserData(userId, force = false) {
        try {
            logger_1.logger.info(`Starting Google Ads sync for user ${userId}`);
            const accounts = await this.getCustomerAccounts(userId);
            for (const account of accounts) {
                if (account.type === 'CLIENT') { // Only sync client accounts, not manager accounts
                    await this.syncAccountData(userId, account);
                }
            }
            // Update last sync timestamp
            await this.prisma.integration.update({
                where: {
                    userId_platform: {
                        userId,
                        platform: 'GOOGLE_ADS',
                    },
                },
                data: {
                    lastSync: new Date(),
                },
            });
            logger_1.logger.info(`Completed Google Ads sync for user ${userId}`);
        }
        catch (error) {
            logger_1.logger.error(`Failed to sync Google Ads data for user ${userId}`, error);
            throw error;
        }
    }
    /**
     * Sync data for a specific account
     */
    async syncAccountData(userId, account) {
        try {
            // Sync campaigns
            const campaigns = await this.getCampaigns(userId, account.id);
            for (const campaign of campaigns) {
                await this.storeCampaignData(userId, account, campaign);
                // Sync keywords for this campaign
                const keywords = await this.getKeywords(userId, account.id, [campaign.id]);
                for (const keyword of keywords) {
                    await this.storeKeywordData(userId, keyword);
                }
                // Sync metrics for the last 30 days
                const endDate = new Date().toISOString().split('T')[0];
                const startDate = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                const metrics = await this.getCampaignMetrics(userId, account.id, { startDate, endDate });
                for (const metric of metrics) {
                    await this.storeCampaignMetrics(userId, metric);
                }
            }
        }
        catch (error) {
            logger_1.logger.error(`Failed to sync account data for ${account.id}`, error);
        }
    }
    /**
     * Store campaign data in database
     */
    async storeCampaignData(userId, account, campaign) {
        await this.prisma.campaign.upsert({
            where: {
                externalId_platform: {
                    externalId: campaign.id,
                    platform: 'GOOGLE_ADS',
                },
            },
            update: {
                name: campaign.name,
                status: campaign.status,
                type: campaign.type,
                startDate: campaign.start_date ? new Date(campaign.start_date) : null,
                endDate: campaign.end_date ? new Date(campaign.end_date) : null,
                budget: campaign.budget_amount,
                updatedAt: new Date(),
            },
            create: {
                externalId: campaign.id,
                platform: 'GOOGLE_ADS',
                userId,
                accountId: account.id,
                name: campaign.name,
                status: campaign.status,
                type: campaign.type,
                startDate: campaign.start_date ? new Date(campaign.start_date) : null,
                endDate: campaign.end_date ? new Date(campaign.end_date) : null,
                budget: campaign.budget_amount,
                createdAt: new Date(),
                updatedAt: new Date(),
            },
        });
    }
    /**
     * Store keyword data in database
     */
    async storeKeywordData(userId, keyword) {
        await this.prisma.keyword.upsert({
            where: {
                externalId_platform: {
                    externalId: keyword.id,
                    platform: 'GOOGLE_ADS',
                },
            },
            update: {
                text: keyword.text,
                matchType: keyword.match_type,
                status: keyword.status,
                qualityScore: keyword.quality_score,
                firstPageCpc: keyword.first_page_cpc,
                topOfPageCpc: keyword.top_of_page_cpc,
                updatedAt: new Date(),
            },
            create: {
                externalId: keyword.id,
                platform: 'GOOGLE_ADS',
                userId,
                campaignId: keyword.campaign_id,
                adGroupId: keyword.ad_group_id,
                text: keyword.text,
                matchType: keyword.match_type,
                status: keyword.status,
                qualityScore: keyword.quality_score,
                firstPageCpc: keyword.first_page_cpc,
                topOfPageCpc: keyword.top_of_page_cpc,
                createdAt: new Date(),
                updatedAt: new Date(),
            },
        });
    }
    /**
     * Store campaign metrics in database
     */
    async storeCampaignMetrics(userId, metrics) {
        await this.prisma.campaignMetrics.upsert({
            where: {
                campaignId_date_platform: {
                    campaignId: metrics.campaign_id,
                    date: new Date(metrics.date),
                    platform: 'GOOGLE_ADS',
                },
            },
            update: {
                impressions: metrics.impressions,
                clicks: metrics.clicks,
                cost: metrics.cost_micros / 1000000, // Convert micros to currency
                conversions: metrics.conversions,
                ctr: metrics.ctr,
                averageCpc: metrics.average_cpc / 1000000, // Convert micros to currency
                costPerConversion: metrics.cost_per_conversion,
                updatedAt: new Date(),
            },
            create: {
                campaignId: metrics.campaign_id,
                platform: 'GOOGLE_ADS',
                userId,
                date: new Date(metrics.date),
                impressions: metrics.impressions,
                clicks: metrics.clicks,
                cost: metrics.cost_micros / 1000000,
                conversions: metrics.conversions,
                ctr: metrics.ctr,
                averageCpc: metrics.average_cpc / 1000000,
                costPerConversion: metrics.cost_per_conversion,
                createdAt: new Date(),
                updatedAt: new Date(),
            },
        });
    }
    /**
     * Disconnect Google Ads integration
     */
    async disconnectIntegration(userId) {
        await this.prisma.integration.update({
            where: {
                userId_platform: {
                    userId,
                    platform: 'GOOGLE_ADS',
                },
            },
            data: {
                isActive: false,
                accessToken: null,
                refreshToken: null,
                expiresAt: null,
            },
        });
        // Remove cached client
        const cacheKey = `google-ads-client-${userId}`;
        this.googleAdsClients.delete(cacheKey);
        logger_1.logger.info(`Disconnected Google Ads integration for user ${userId}`);
    }
    /**
     * Scheduled sync job - runs every 30 minutes
     */
    async scheduledSync() {
        logger_1.logger.info('Starting scheduled Google Ads sync');
        try {
            const activeIntegrations = await this.prisma.integration.findMany({
                where: {
                    platform: 'GOOGLE_ADS',
                    isActive: true,
                },
                select: {
                    userId: true,
                    lastSync: true,
                },
            });
            for (const integration of activeIntegrations) {
                try {
                    // Only sync if last sync was more than 25 minutes ago (to avoid overlapping)
                    const lastSyncThreshold = new Date(Date.now() - 25 * 60 * 1000);
                    if (!integration.lastSync || integration.lastSync < lastSyncThreshold) {
                        await this.syncUserData(integration.userId);
                        await this.delay(2000); // Rate limiting between users
                    }
                }
                catch (error) {
                    logger_1.logger.error(`Failed to sync user ${integration.userId}`, error);
                }
            }
        }
        catch (error) {
            logger_1.logger.error('Failed to run scheduled sync', error);
        }
    }
    /**
     * Utility method to add delay
     */
    delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    /**
     * Clear cached clients (useful for testing or memory management)
     */
    clearClientCache() {
        this.googleAdsClients.clear();
    }
}
exports.GoogleAdsService = GoogleAdsService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxFbnpvIE1hcmNlbG9cXERlc2t0b3BcXFByb2pldG9zIEVtcHJlc2FcXFNhYXMgVXRtaWZ5XFx1dG1pZnktY2xvbmVcXGFwcHNcXGFwaVxcc3JjXFxzZXJ2aWNlc1xcZ29vZ2xlLWFkcy5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUVBLG1EQUErRDtBQUMvRCxrREFBMEI7QUFDMUIsdUNBQWdEO0FBQ2hELDRDQUF5QztBQUN6Qyw0Q0FBMkM7QUFrRTNDLE1BQWEsZ0JBQWdCO0lBTVI7SUFDQTtJQU5GLFVBQVUsR0FBRyxDQUFDLENBQUM7SUFDZixVQUFVLEdBQUcsSUFBSSxDQUFDO0lBQzNCLGdCQUFnQixHQUE4QixJQUFJLEdBQUcsRUFBRSxDQUFDO0lBRWhFLFlBQ21CLE1BQXFCLEVBQ3JCLGFBQTRCO1FBRDVCLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDckIsa0JBQWEsR0FBYixhQUFhLENBQWU7SUFDNUMsQ0FBQztJQUVKOztPQUVHO0lBQ0gsZUFBZSxDQUFDLE1BQWMsRUFBRSxXQUFtQjtRQUNqRCxJQUFJLENBQUMscUJBQWUsRUFBRSxDQUFDO1lBQ3JCLE1BQU0sSUFBSSxpQkFBUSxDQUFDLHVDQUF1QyxFQUFFLDJCQUEyQixFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ2hHLENBQUM7UUFFRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNsRixNQUFNLE1BQU0sR0FBRyxDQUFDLHlDQUF5QyxDQUFDLENBQUM7UUFFM0QsTUFBTSxNQUFNLEdBQUcsSUFBSSxlQUFlLENBQUM7WUFDakMsU0FBUyxFQUFFLHFCQUFlLENBQUMsUUFBUTtZQUNuQyxZQUFZLEVBQUUsV0FBVztZQUN6QixLQUFLLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7WUFDdkIsYUFBYSxFQUFFLE1BQU07WUFDckIsV0FB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XFxFbnpvIE1hcmNlbG9cXERlc2t0b3BcXFByb2pldG9zIEVtcHJlc2FcXFNhYXMgVXRtaWZ5XFx1dG1pZnktY2xvbmVcXGFwcHNcXGFwaVxcc3JjXFxzZXJ2aWNlc1xcZ29vZ2xlLWFkcy5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYVNlcnZpY2UgfSBmcm9tICcuLi9kYXRhYmFzZS9wcmlzbWEuc2VydmljZSc7XG5pbXBvcnQgeyBDcnlwdG9TZXJ2aWNlIH0gZnJvbSAnLi9jcnlwdG8uc2VydmljZSc7XG5pbXBvcnQgeyBHb29nbGVBZHNBcGksIEN1c3RvbWVyLCBlbnVtcyB9IGZyb20gJ2dvb2dsZS1hZHMtYXBpJztcbmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgeyBnb29nbGVBZHNDb25maWcgfSBmcm9tICcuLi9jb25maWcvZW52JztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBBcGlFcnJvciB9IGZyb20gJy4uL3V0aWxzL2Vycm9ycyc7XG5cbmludGVyZmFjZSBHb29nbGVPQXV0aFRva2VucyB7XG4gIGFjY2Vzc190b2tlbjogc3RyaW5nO1xuICByZWZyZXNoX3Rva2VuOiBzdHJpbmc7XG4gIGV4cGlyZXNfaW46IG51bWJlcjtcbiAgdG9rZW5fdHlwZTogc3RyaW5nO1xuICBzY29wZTogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgR29vZ2xlQWRzQWNjb3VudCB7XG4gIGlkOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgY3VycmVuY3k6IHN0cmluZztcbiAgdGltZXpvbmU6IHN0cmluZztcbiAgc3RhdHVzOiBzdHJpbmc7XG4gIHR5cGU6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEdvb2dsZUFkc0NhbXBhaWduIHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBzdGF0dXM6IHN0cmluZztcbiAgdHlwZTogc3RyaW5nO1xuICBzdGFydF9kYXRlPzogc3RyaW5nO1xuICBlbmRfZGF0ZT86IHN0cmluZztcbiAgYnVkZ2V0X2Ftb3VudD86IG51bWJlcjtcbiAgYnVkZ2V0X3R5cGU/OiBzdHJpbmc7XG4gIGN1c3RvbWVyX2lkOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBHb29nbGVBZHNLZXl3b3JkIHtcbiAgaWQ6IHN0cmluZztcbiAgdGV4dDogc3RyaW5nO1xuICBtYXRjaF90eXBlOiBzdHJpbmc7XG4gIHN0YXR1czogc3RyaW5nO1xuICBxdWFsaXR5X3Njb3JlPzogbnVtYmVyO1xuICBmaXJzdF9wYWdlX2NwYz86IG51bWJlcjtcbiAgdG9wX29mX3BhZ2VfY3BjPzogbnVtYmVyO1xuICBjYW1wYWlnbl9pZDogc3RyaW5nO1xuICBhZF9ncm91cF9pZDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgR29vZ2xlQWRzQ2FtcGFpZ25NZXRyaWNzIHtcbiAgY2FtcGFpZ25faWQ6IHN0cmluZztcbiAgaW1wcmVzc2lvbnM6IG51bWJlcjtcbiAgY2xpY2tzOiBudW1iZXI7XG4gIGNvc3RfbWljcm9zOiBudW1iZXI7XG4gIGNvbnZlcnNpb25zOiBudW1iZXI7XG4gIGN0cjogbnVtYmVyO1xuICBhdmVyYWdlX2NwYzogbnVtYmVyO1xuICBjb3N0X3Blcl9jb252ZXJzaW9uPzogbnVtYmVyO1xuICBkYXRlOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBTZWFyY2hUZXJtUmVwb3J0IHtcbiAgc2VhcmNoX3Rlcm06IHN0cmluZztcbiAgaW1wcmVzc2lvbnM6IG51bWJlcjtcbiAgY2xpY2tzOiBudW1iZXI7XG4gIGNvc3RfbWljcm9zOiBudW1iZXI7XG4gIGNvbnZlcnNpb25zOiBudW1iZXI7XG4gIGNhbXBhaWduX2lkOiBzdHJpbmc7XG4gIGFkX2dyb3VwX2lkOiBzdHJpbmc7XG4gIGtleXdvcmRfaWQ/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBHb29nbGVBZHNTZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBtYXhSZXRyaWVzID0gMztcbiAgcHJpdmF0ZSByZWFkb25seSByZXRyeURlbGF5ID0gMTAwMDtcbiAgcHJpdmF0ZSBnb29nbGVBZHNDbGllbnRzOiBNYXA8c3RyaW5nLCBHb29nbGVBZHNBcGk+ID0gbmV3IE1hcCgpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJpc21hOiBQcmlzbWFTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY3J5cHRvU2VydmljZTogQ3J5cHRvU2VydmljZSxcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBPQXV0aCAyLjAgYXV0aG9yaXphdGlvbiBVUkxcbiAgICovXG4gIGdlbmVyYXRlQXV0aFVybCh1c2VySWQ6IHN0cmluZywgcmVkaXJlY3RVcmk6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKCFnb29nbGVBZHNDb25maWcpIHtcbiAgICAgIHRocm93IG5ldyBBcGlFcnJvcignR29vZ2xlIEFkcyBpbnRlZ3JhdGlvbiBub3QgY29uZmlndXJlZCcsICdHT09HTEVfQURTX05PVF9DT05GSUdVUkVEJywgNDAwKTtcbiAgICB9XG5cbiAgICBjb25zdCBzdGF0ZSA9IHRoaXMuY3J5cHRvU2VydmljZS5lbmNyeXB0KEpTT04uc3RyaW5naWZ5KHsgdXNlcklkLCByZWRpcmVjdFVyaSB9KSk7XG4gICAgY29uc3Qgc2NvcGVzID0gWydodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9hdXRoL2Fkd29yZHMnXTtcbiAgICBcbiAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICAgIGNsaWVudF9pZDogZ29vZ2xlQWRzQ29uZmlnLmNsaWVudElkLFxuICAgICAgcmVkaXJlY3RfdXJpOiByZWRpcmVjdFVyaSxcbiAgICAgIHNjb3BlOiBzY29wZXMuam9pbignICcpLFxuICAgICAgcmVzcG9uc2VfdHlwZTogJ2NvZGUnLFxuICAgICAgYWNjZXNzX3R5cGU6ICdvZmZsaW5lJyxcbiAgICAgIHByb21wdDogJ2NvbnNlbnQnLFxuICAgICAgc3RhdGUsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gYGh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi92Mi9hdXRoPyR7cGFyYW1zLnRvU3RyaW5nKCl9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGNoYW5nZSBhdXRob3JpemF0aW9uIGNvZGUgZm9yIHRva2Vuc1xuICAgKi9cbiAgYXN5bmMgZXhjaGFuZ2VDb2RlRm9yVG9rZW4oY29kZTogc3RyaW5nLCByZWRpcmVjdFVyaTogc3RyaW5nKTogUHJvbWlzZTxHb29nbGVPQXV0aFRva2Vucz4ge1xuICAgIGlmICghZ29vZ2xlQWRzQ29uZmlnKSB7XG4gICAgICB0aHJvdyBuZXcgQXBpRXJyb3IoJ0dvb2dsZSBBZHMgaW50ZWdyYXRpb24gbm90IGNvbmZpZ3VyZWQnLCAnR09PR0xFX0FEU19OT1RfQ09ORklHVVJFRCcsIDQwMCk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdCgnaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4nLCB7XG4gICAgICAgIGNsaWVudF9pZDogZ29vZ2xlQWRzQ29uZmlnLmNsaWVudElkLFxuICAgICAgICBjbGllbnRfc2VjcmV0OiBnb29nbGVBZHNDb25maWcuY2xpZW50U2VjcmV0LFxuICAgICAgICBjb2RlLFxuICAgICAgICBncmFudF90eXBlOiAnYXV0aG9yaXphdGlvbl9jb2RlJyxcbiAgICAgICAgcmVkaXJlY3RfdXJpOiByZWRpcmVjdFVyaSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZXhjaGFuZ2UgY29kZSBmb3IgdG9rZW4nLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgQXBpRXJyb3IoJ0ZhaWxlZCB0byBleGNoYW5nZSBhdXRob3JpemF0aW9uIGNvZGUnLCAnVE9LRU5fRVhDSEFOR0VfRkFJTEVEJywgNDAwKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVmcmVzaCBhY2Nlc3MgdG9rZW5cbiAgICovXG4gIGFzeW5jIHJlZnJlc2hBY2Nlc3NUb2tlbihyZWZyZXNoVG9rZW46IHN0cmluZyk6IFByb21pc2U8R29vZ2xlT0F1dGhUb2tlbnM+IHtcbiAgICBpZiAoIWdvb2dsZUFkc0NvbmZpZykge1xuICAgICAgdGhyb3cgbmV3IEFwaUVycm9yKCdHb29nbGUgQWRzIGludGVncmF0aW9uIG5vdCBjb25maWd1cmVkJywgJ0dPT0dMRV9BRFNfTk9UX0NPTkZJR1VSRUQnLCA0MDApO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBvc3QoJ2h0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuJywge1xuICAgICAgICBjbGllbnRfaWQ6IGdvb2dsZUFkc0NvbmZpZy5jbGllbnRJZCxcbiAgICAgICAgY2xpZW50X3NlY3JldDogZ29vZ2xlQWRzQ29uZmlnLmNsaWVudFNlY3JldCxcbiAgICAgICAgcmVmcmVzaF90b2tlbjogcmVmcmVzaFRva2VuLFxuICAgICAgICBncmFudF90eXBlOiAncmVmcmVzaF90b2tlbicsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ucmVzcG9uc2UuZGF0YSxcbiAgICAgICAgcmVmcmVzaF90b2tlbjogcmVmcmVzaFRva2VuLCAvLyBLZWVwIHRoZSBvcmlnaW5hbCByZWZyZXNoIHRva2VuXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byByZWZyZXNoIGFjY2VzcyB0b2tlbicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBBcGlFcnJvcignRmFpbGVkIHRvIHJlZnJlc2ggYWNjZXNzIHRva2VuJywgJ1RPS0VOX1JFRlJFU0hfRkFJTEVEJywgNDAxKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU3RvcmUgT0F1dGggdG9rZW5zIHNlY3VyZWx5XG4gICAqL1xuICBhc3luYyBzdG9yZVRva2Vucyh1c2VySWQ6IHN0cmluZywgdG9rZW5zOiBHb29nbGVPQXV0aFRva2Vucyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGVuY3J5cHRlZEFjY2Vzc1Rva2VuID0gdGhpcy5jcnlwdG9TZXJ2aWNlLmVuY3J5cHQodG9rZW5zLmFjY2Vzc190b2tlbik7XG4gICAgY29uc3QgZW5jcnlwdGVkUmVmcmVzaFRva2VuID0gdGhpcy5jcnlwdG9TZXJ2aWNlLmVuY3J5cHQodG9rZW5zLnJlZnJlc2hfdG9rZW4pO1xuICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyB0b2tlbnMuZXhwaXJlc19pbiAqIDEwMDApO1xuXG4gICAgYXdhaXQgdGhpcy5wcmlzbWEuaW50ZWdyYXRpb24udXBzZXJ0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHVzZXJJZF9wbGF0Zm9ybToge1xuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICBwbGF0Zm9ybTogJ0dPT0dMRV9BRFMnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHVwZGF0ZToge1xuICAgICAgICBhY2Nlc3NUb2tlbjogZW5jcnlwdGVkQWNjZXNzVG9rZW4sXG4gICAgICAgIHJlZnJlc2hUb2tlbjogZW5jcnlwdGVkUmVmcmVzaFRva2VuLFxuICAgICAgICBleHBpcmVzQXQsXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICBsYXN0U3luYzogbmV3IERhdGUoKSxcbiAgICAgIH0sXG4gICAgICBjcmVhdGU6IHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBwbGF0Zm9ybTogJ0dPT0dMRV9BRFMnLFxuICAgICAgICBhY2Nlc3NUb2tlbjogZW5jcnlwdGVkQWNjZXNzVG9rZW4sXG4gICAgICAgIHJlZnJlc2hUb2tlbjogZW5jcnlwdGVkUmVmcmVzaFRva2VuLFxuICAgICAgICBleHBpcmVzQXQsXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICBsYXN0U3luYzogbmV3IERhdGUoKSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coYFN0b3JlZCBHb29nbGUgQWRzIHRva2VucyBmb3IgdXNlciAke3VzZXJJZH1gKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdmFsaWQgYWNjZXNzIHRva2VuIChyZWZyZXNoIGlmIG5lZWRlZClcbiAgICovXG4gIGFzeW5jIGdldEFjY2Vzc1Rva2VuKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBpbnRlZ3JhdGlvbiA9IGF3YWl0IHRoaXMucHJpc21hLmludGVncmF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgdXNlcklkX3BsYXRmb3JtOiB7XG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIHBsYXRmb3JtOiAnR09PR0xFX0FEUycsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFpbnRlZ3JhdGlvbiB8fCAhaW50ZWdyYXRpb24uaXNBY3RpdmUpIHtcbiAgICAgIHRocm93IG5ldyBBcGlFcnJvcignR29vZ2xlIEFkcyBpbnRlZ3JhdGlvbiBub3QgZm91bmQgb3IgaW5hY3RpdmUnLCAnSU5URUdSQVRJT05fTk9UX0ZPVU5EJywgNDAxKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiB0b2tlbiBpcyBleHBpcmVkXG4gICAgaWYgKGludGVncmF0aW9uLmV4cGlyZXNBdCAmJiBpbnRlZ3JhdGlvbi5leHBpcmVzQXQgPD0gbmV3IERhdGUoKSkge1xuICAgICAgY29uc3QgcmVmcmVzaFRva2VuID0gdGhpcy5jcnlwdG9TZXJ2aWNlLmRlY3J5cHQoaW50ZWdyYXRpb24ucmVmcmVzaFRva2VuISk7XG4gICAgICBjb25zdCBuZXdUb2tlbnMgPSBhd2FpdCB0aGlzLnJlZnJlc2hBY2Nlc3NUb2tlbihyZWZyZXNoVG9rZW4pO1xuICAgICAgYXdhaXQgdGhpcy5zdG9yZVRva2Vucyh1c2VySWQsIG5ld1Rva2Vucyk7XG4gICAgICByZXR1cm4gbmV3VG9rZW5zLmFjY2Vzc190b2tlbjtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5jcnlwdG9TZXJ2aWNlLmRlY3J5cHQoaW50ZWdyYXRpb24uYWNjZXNzVG9rZW4hKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgR29vZ2xlIEFkcyBBUEkgY2xpZW50IGZvciB1c2VyXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldEdvb2dsZUFkc0NsaWVudCh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8R29vZ2xlQWRzQXBpPiB7XG4gICAgaWYgKCFnb29nbGVBZHNDb25maWcpIHtcbiAgICAgIHRocm93IG5ldyBBcGlFcnJvcignR29vZ2xlIEFkcyBpbnRlZ3JhdGlvbiBub3QgY29uZmlndXJlZCcsICdHT09HTEVfQURTX05PVF9DT05GSUdVUkVEJywgNDAwKTtcbiAgICB9XG5cbiAgICBjb25zdCBjYWNoZUtleSA9IGBnb29nbGUtYWRzLWNsaWVudC0ke3VzZXJJZH1gO1xuICAgIFxuICAgIGlmICh0aGlzLmdvb2dsZUFkc0NsaWVudHMuaGFzKGNhY2hlS2V5KSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ29vZ2xlQWRzQ2xpZW50cy5nZXQoY2FjaGVLZXkpITtcbiAgICB9XG5cbiAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IGF3YWl0IHRoaXMuZ2V0QWNjZXNzVG9rZW4odXNlcklkKTtcbiAgICBcbiAgICBjb25zdCBjbGllbnQgPSBuZXcgR29vZ2xlQWRzQXBpKHtcbiAgICAgIGNsaWVudF9pZDogZ29vZ2xlQWRzQ29uZmlnLmNsaWVudElkLFxuICAgICAgY2xpZW50X3NlY3JldDogZ29vZ2xlQWRzQ29uZmlnLmNsaWVudFNlY3JldCxcbiAgICAgIGRldmVsb3Blcl90b2tlbjogZ29vZ2xlQWRzQ29uZmlnLmRldmVsb3BlclRva2VuLFxuICAgIH0pO1xuXG4gICAgLy8gU2V0IHRoZSBhY2Nlc3MgdG9rZW4gZm9yIHRoZSBjbGllbnRcbiAgICBjbGllbnQuQ3VzdG9tZXIuY3JlZGVudGlhbHMgPSB7XG4gICAgICBhY2Nlc3NfdG9rZW46IGFjY2Vzc1Rva2VuLFxuICAgIH07XG5cbiAgICB0aGlzLmdvb2dsZUFkc0NsaWVudHMuc2V0KGNhY2hlS2V5LCBjbGllbnQpO1xuICAgIHJldHVybiBjbGllbnQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFjY2Vzc2libGUgY3VzdG9tZXIgYWNjb3VudHNcbiAgICovXG4gIGFzeW5jIGdldEN1c3RvbWVyQWNjb3VudHModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPEdvb2dsZUFkc0FjY291bnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjbGllbnQgPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFkc0NsaWVudCh1c2VySWQpO1xuICAgICAgXG4gICAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgICAgU0VMRUNUIFxuICAgICAgICAgIGN1c3RvbWVyLmlkLFxuICAgICAgICAgIGN1c3RvbWVyLmRlc2NyaXB0aXZlX25hbWUsXG4gICAgICAgICAgY3VzdG9tZXIuY3VycmVuY3lfY29kZSxcbiAgICAgICAgICBjdXN0b21lci50aW1lX3pvbmUsXG4gICAgICAgICAgY3VzdG9tZXIuc3RhdHVzLFxuICAgICAgICAgIGN1c3RvbWVyLm1hbmFnZXJcbiAgICAgICAgRlJPTSBjdXN0b21lclxuICAgICAgICBXSEVSRSBjdXN0b21lci5zdGF0dXMgPSAnRU5BQkxFRCdcbiAgICAgIGA7XG5cbiAgICAgIGNvbnN0IGN1c3RvbWVycyA9IGF3YWl0IGNsaWVudC5DdXN0b21lcigpLnJlcG9ydCh7XG4gICAgICAgIHF1ZXJ5LFxuICAgICAgICBsb2dpbl9jdXN0b21lcl9pZDogZ29vZ2xlQWRzQ29uZmlnPy5sb2dpbkN1c3RvbWVySWQsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGN1c3RvbWVycy5tYXAoKGN1c3RvbWVyOiBhbnkpID0+ICh7XG4gICAgICAgIGlkOiBjdXN0b21lci5jdXN0b21lci5pZC50b1N0cmluZygpLFxuICAgICAgICBuYW1lOiBjdXN0b21lci5jdXN0b21lci5kZXNjcmlwdGl2ZV9uYW1lIHx8IGBDdXN0b21lciAke2N1c3RvbWVyLmN1c3RvbWVyLmlkfWAsXG4gICAgICAgIGN1cnJlbmN5OiBjdXN0b21lci5jdXN0b21lci5jdXJyZW5jeV9jb2RlLFxuICAgICAgICB0aW1lem9uZTogY3VzdG9tZXIuY3VzdG9tZXIudGltZV96b25lLFxuICAgICAgICBzdGF0dXM6IGN1c3RvbWVyLmN1c3RvbWVyLnN0YXR1cyxcbiAgICAgICAgdHlwZTogY3VzdG9tZXIuY3VzdG9tZXIubWFuYWdlciA/ICdNQU5BR0VSJyA6ICdDTElFTlQnLFxuICAgICAgfSkpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBnZXQgY3VzdG9tZXIgYWNjb3VudHMnLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgQXBpRXJyb3IoJ0ZhaWxlZCB0byByZXRyaWV2ZSBjdXN0b21lciBhY2NvdW50cycsICdDVVNUT01FUl9BQ0NPVU5UU19GQUlMRUQnLCA0MDApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FtcGFpZ25zIGZvciBhIGN1c3RvbWVyXG4gICAqL1xuICBhc3luYyBnZXRDYW1wYWlnbnModXNlcklkOiBzdHJpbmcsIGN1c3RvbWVySWQ6IHN0cmluZyk6IFByb21pc2U8R29vZ2xlQWRzQ2FtcGFpZ25bXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjbGllbnQgPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFkc0NsaWVudCh1c2VySWQpO1xuICAgICAgXG4gICAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgICAgU0VMRUNUIFxuICAgICAgICAgIGNhbXBhaWduLmlkLFxuICAgICAgICAgIGNhbXBhaWduLm5hbWUsXG4gICAgICAgICAgY2FtcGFpZ24uc3RhdHVzLFxuICAgICAgICAgIGNhbXBhaWduLmFkdmVydGlzaW5nX2NoYW5uZWxfdHlwZSxcbiAgICAgICAgICBjYW1wYWlnbi5zdGFydF9kYXRlLFxuICAgICAgICAgIGNhbXBhaWduLmVuZF9kYXRlLFxuICAgICAgICAgIGNhbXBhaWduX2J1ZGdldC5hbW91bnRfbWljcm9zLFxuICAgICAgICAgIGNhbXBhaWduX2J1ZGdldC50eXBlXG4gICAgICAgIEZST00gY2FtcGFpZ25cbiAgICAgICAgV0hFUkUgY2FtcGFpZ24uc3RhdHVzICE9ICdSRU1PVkVEJ1xuICAgICAgICBPUkRFUiBCWSBjYW1wYWlnbi5uYW1lXG4gICAgICBgO1xuXG4gICAgICBjb25zdCBjYW1wYWlnbnMgPSBhd2FpdCBjbGllbnQuQ3VzdG9tZXIoeyBjdXN0b21lcl9pZDogY3VzdG9tZXJJZCB9KS5yZXBvcnQoe1xuICAgICAgICBxdWVyeSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gY2FtcGFpZ25zLm1hcCgoY2FtcGFpZ246IGFueSkgPT4gKHtcbiAgICAgICAgaWQ6IGNhbXBhaWduLmNhbXBhaWduLmlkLnRvU3RyaW5nKCksXG4gICAgICAgIG5hbWU6IGNhbXBhaWduLmNhbXBhaWduLm5hbWUsXG4gICAgICAgIHN0YXR1czogY2FtcGFpZ24uY2FtcGFpZ24uc3RhdHVzLFxuICAgICAgICB0eXBlOiBjYW1wYWlnbi5jYW1wYWlnbi5hZHZlcnRpc2luZ19jaGFubmVsX3R5cGUsXG4gICAgICAgIHN0YXJ0X2RhdGU6IGNhbXBhaWduLmNhbXBhaWduLnN0YXJ0X2RhdGUsXG4gICAgICAgIGVuZF9kYXRlOiBjYW1wYWlnbi5jYW1wYWlnbi5lbmRfZGF0ZSxcbiAgICAgICAgYnVkZ2V0X2Ftb3VudDogY2FtcGFpZ24uY2FtcGFpZ25fYnVkZ2V0Py5hbW91bnRfbWljcm9zID8gXG4gICAgICAgICAgcGFyc2VJbnQoY2FtcGFpZ24uY2FtcGFpZ25fYnVkZ2V0LmFtb3VudF9taWNyb3MpIC8gMTAwMDAwMCA6IHVuZGVmaW5lZCxcbiAgICAgICAgYnVkZ2V0X3R5cGU6IGNhbXBhaWduLmNhbXBhaWduX2J1ZGdldD8udHlwZSxcbiAgICAgICAgY3VzdG9tZXJfaWQ6IGN1c3RvbWVySWQsXG4gICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGdldCBjYW1wYWlnbnMnLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgQXBpRXJyb3IoJ0ZhaWxlZCB0byByZXRyaWV2ZSBjYW1wYWlnbnMnLCAnQ0FNUEFJR05TX0ZBSUxFRCcsIDQwMCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBrZXl3b3JkcyBmb3IgY2FtcGFpZ25zXG4gICAqL1xuICBhc3luYyBnZXRLZXl3b3Jkcyh1c2VySWQ6IHN0cmluZywgY3VzdG9tZXJJZDogc3RyaW5nLCBjYW1wYWlnbklkcz86IHN0cmluZ1tdKTogUHJvbWlzZTxHb29nbGVBZHNLZXl3b3JkW10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY2xpZW50ID0gYXdhaXQgdGhpcy5nZXRHb29nbGVBZHNDbGllbnQodXNlcklkKTtcbiAgICAgIFxuICAgICAgbGV0IHdoZXJlQ2xhdXNlID0gJ2FkX2dyb3VwX2NyaXRlcmlvbi5zdGF0dXMgIT0gXCJSRU1PVkVEXCIgQU5EIGFkX2dyb3VwX2NyaXRlcmlvbi50eXBlID0gXCJLRVlXT1JEXCInO1xuICAgICAgaWYgKGNhbXBhaWduSWRzICYmIGNhbXBhaWduSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgY2FtcGFpZ25GaWx0ZXIgPSBjYW1wYWlnbklkcy5tYXAoaWQgPT4gYFwiJHtpZH1cImApLmpvaW4oJywnKTtcbiAgICAgICAgd2hlcmVDbGF1c2UgKz0gYCBBTkQgY2FtcGFpZ24uaWQgSU4gKCR7Y2FtcGFpZ25GaWx0ZXJ9KWA7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYFxuICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgYWRfZ3JvdXBfY3JpdGVyaW9uLmNyaXRlcmlvbl9pZCxcbiAgICAgICAgICBhZF9ncm91cF9jcml0ZXJpb24ua2V5d29yZC50ZXh0LFxuICAgICAgICAgIGFkX2dyb3VwX2NyaXRlcmlvbi5rZXl3b3JkLm1hdGNoX3R5cGUsXG4gICAgICAgICAgYWRfZ3JvdXBfY3JpdGVyaW9uLnN0YXR1cyxcbiAgICAgICAgICBhZF9ncm91cF9jcml0ZXJpb24ucXVhbGl0eV9pbmZvLnF1YWxpdHlfc2NvcmUsXG4gICAgICAgICAgYWRfZ3JvdXBfY3JpdGVyaW9uLnBvc2l0aW9uX2VzdGltYXRlcy5maXJzdF9wYWdlX2NwY19taWNyb3MsXG4gICAgICAgICAgYWRfZ3JvdXBfY3JpdGVyaW9uLnBvc2l0aW9uX2VzdGltYXRlcy50b3Bfb2ZfcGFnZV9jcGNfbWljcm9zLFxuICAgICAgICAgIGNhbXBhaWduLmlkLFxuICAgICAgICAgIGFkX2dyb3VwLmlkXG4gICAgICAgIEZST00ga2V5d29yZF92aWV3XG4gICAgICAgIFdIRVJFICR7d2hlcmVDbGF1c2V9XG4gICAgICAgIE9SREVSIEJZIGFkX2dyb3VwX2NyaXRlcmlvbi5rZXl3b3JkLnRleHRcbiAgICAgIGA7XG5cbiAgICAgIGNvbnN0IGtleXdvcmRzID0gYXdhaXQgY2xpZW50LkN1c3RvbWVyKHsgY3VzdG9tZXJfaWQ6IGN1c3RvbWVySWQgfSkucmVwb3J0KHtcbiAgICAgICAgcXVlcnksXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGtleXdvcmRzLm1hcCgoa2V5d29yZDogYW55KSA9PiAoe1xuICAgICAgICBpZDoga2V5d29yZC5hZF9ncm91cF9jcml0ZXJpb24uY3JpdGVyaW9uX2lkLnRvU3RyaW5nKCksXG4gICAgICAgIHRleHQ6IGtleXdvcmQuYWRfZ3JvdXBfY3JpdGVyaW9uLmtleXdvcmQudGV4dCxcbiAgICAgICAgbWF0Y2hfdHlwZToga2V5d29yZC5hZF9ncm91cF9jcml0ZXJpb24ua2V5d29yZC5tYXRjaF90eXBlLFxuICAgICAgICBzdGF0dXM6IGtleXdvcmQuYWRfZ3JvdXBfY3JpdGVyaW9uLnN0YXR1cyxcbiAgICAgICAgcXVhbGl0eV9zY29yZToga2V5d29yZC5hZF9ncm91cF9jcml0ZXJpb24ucXVhbGl0eV9pbmZvPy5xdWFsaXR5X3Njb3JlLFxuICAgICAgICBmaXJzdF9wYWdlX2NwYzoga2V5d29yZC5hZF9ncm91cF9jcml0ZXJpb24ucG9zaXRpb25fZXN0aW1hdGVzPy5maXJzdF9wYWdlX2NwY19taWNyb3MgP1xuICAgICAgICAgIHBhcnNlSW50KGtleXdvcmQuYWRfZ3JvdXBfY3JpdGVyaW9uLnBvc2l0aW9uX2VzdGltYXRlcy5maXJzdF9wYWdlX2NwY19taWNyb3MpIC8gMTAwMDAwMCA6IHVuZGVmaW5lZCxcbiAgICAgICAgdG9wX29mX3BhZ2VfY3BjOiBrZXl3b3JkLmFkX2dyb3VwX2NyaXRlcmlvbi5wb3NpdGlvbl9lc3RpbWF0ZXM/LnRvcF9vZl9wYWdlX2NwY19taWNyb3MgP1xuICAgICAgICAgIHBhcnNlSW50KGtleXdvcmQuYWRfZ3JvdXBfY3JpdGVyaW9uLnBvc2l0aW9uX2VzdGltYXRlcy50b3Bfb2ZfcGFnZV9jcGNfbWljcm9zKSAvIDEwMDAwMDAgOiB1bmRlZmluZWQsXG4gICAgICAgIGNhbXBhaWduX2lkOiBrZXl3b3JkLmNhbXBhaWduLmlkLnRvU3RyaW5nKCksXG4gICAgICAgIGFkX2dyb3VwX2lkOiBrZXl3b3JkLmFkX2dyb3VwLmlkLnRvU3RyaW5nKCksXG4gICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGdldCBrZXl3b3JkcycsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBBcGlFcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIGtleXdvcmRzJywgJ0tFWVdPUkRTX0ZBSUxFRCcsIDQwMCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYW1wYWlnbiBwZXJmb3JtYW5jZSBtZXRyaWNzXG4gICAqL1xuICBhc3luYyBnZXRDYW1wYWlnbk1ldHJpY3MoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgY3VzdG9tZXJJZDogc3RyaW5nLFxuICAgIGRhdGVSYW5nZT86IHsgc3RhcnREYXRlOiBzdHJpbmc7IGVuZERhdGU6IHN0cmluZyB9XG4gICk6IFByb21pc2U8R29vZ2xlQWRzQ2FtcGFpZ25NZXRyaWNzW10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY2xpZW50ID0gYXdhaXQgdGhpcy5nZXRHb29nbGVBZHNDbGllbnQodXNlcklkKTtcbiAgICAgIFxuICAgICAgbGV0IGRhdGVGaWx0ZXIgPSAnJztcbiAgICAgIGlmIChkYXRlUmFuZ2UpIHtcbiAgICAgICAgZGF0ZUZpbHRlciA9IGBBTkQgc2VnbWVudHMuZGF0ZSA+PSAnJHtkYXRlUmFuZ2Uuc3RhcnREYXRlfScgQU5EIHNlZ21lbnRzLmRhdGUgPD0gJyR7ZGF0ZVJhbmdlLmVuZERhdGV9J2A7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYFxuICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgY2FtcGFpZ24uaWQsXG4gICAgICAgICAgc2VnbWVudHMuZGF0ZSxcbiAgICAgICAgICBtZXRyaWNzLmltcHJlc3Npb25zLFxuICAgICAgICAgIG1ldHJpY3MuY2xpY2tzLFxuICAgICAgICAgIG1ldHJpY3MuY29zdF9taWNyb3MsXG4gICAgICAgICAgbWV0cmljcy5jb252ZXJzaW9ucyxcbiAgICAgICAgICBtZXRyaWNzLmN0cixcbiAgICAgICAgICBtZXRyaWNzLmF2ZXJhZ2VfY3BjXG4gICAgICAgIEZST00gY2FtcGFpZ25cbiAgICAgICAgV0hFUkUgY2FtcGFpZ24uc3RhdHVzICE9ICdSRU1PVkVEJyAke2RhdGVGaWx0ZXJ9XG4gICAgICAgIE9SREVSIEJZIHNlZ21lbnRzLmRhdGUgREVTQywgY2FtcGFpZ24ubmFtZVxuICAgICAgYDtcblxuICAgICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IGNsaWVudC5DdXN0b21lcih7IGN1c3RvbWVyX2lkOiBjdXN0b21lcklkIH0pLnJlcG9ydCh7XG4gICAgICAgIHF1ZXJ5LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBtZXRyaWNzLm1hcCgobWV0cmljOiBhbnkpID0+ICh7XG4gICAgICAgIGNhbXBhaWduX2lkOiBtZXRyaWMuY2FtcGFpZ24uaWQudG9TdHJpbmcoKSxcbiAgICAgICAgaW1wcmVzc2lvbnM6IHBhcnNlSW50KG1ldHJpYy5tZXRyaWNzLmltcHJlc3Npb25zKSB8fCAwLFxuICAgICAgICBjbGlja3M6IHBhcnNlSW50KG1ldHJpYy5tZXRyaWNzLmNsaWNrcykgfHwgMCxcbiAgICAgICAgY29zdF9taWNyb3M6IHBhcnNlSW50KG1ldHJpYy5tZXRyaWNzLmNvc3RfbWljcm9zKSB8fCAwLFxuICAgICAgICBjb252ZXJzaW9uczogcGFyc2VGbG9hdChtZXRyaWMubWV0cmljcy5jb252ZXJzaW9ucykgfHwgMCxcbiAgICAgICAgY3RyOiBwYXJzZUZsb2F0KG1ldHJpYy5tZXRyaWNzLmN0cikgfHwgMCxcbiAgICAgICAgYXZlcmFnZV9jcGM6IHBhcnNlSW50KG1ldHJpYy5tZXRyaWNzLmF2ZXJhZ2VfY3BjKSB8fCAwLFxuICAgICAgICBjb3N0X3Blcl9jb252ZXJzaW9uOiBtZXRyaWMubWV0cmljcy5jb252ZXJzaW9ucyA+IDAgP1xuICAgICAgICAgIHBhcnNlSW50KG1ldHJpYy5tZXRyaWNzLmNvc3RfbWljcm9zKSAvIHBhcnNlRmxvYXQobWV0cmljLm1ldHJpY3MuY29udmVyc2lvbnMpIC8gMTAwMDAwMCA6IHVuZGVmaW5lZCxcbiAgICAgICAgZGF0ZTogbWV0cmljLnNlZ21lbnRzLmRhdGUsXG4gICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGdldCBjYW1wYWlnbiBtZXRyaWNzJywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEFwaUVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgY2FtcGFpZ24gbWV0cmljcycsICdDQU1QQUlHTl9NRVRSSUNTX0ZBSUxFRCcsIDQwMCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzZWFyY2ggdGVybXMgcmVwb3J0XG4gICAqL1xuICBhc3luYyBnZXRTZWFyY2hUZXJtc1JlcG9ydChcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBjdXN0b21lcklkOiBzdHJpbmcsXG4gICAgZGF0ZVJhbmdlPzogeyBzdGFydERhdGU6IHN0cmluZzsgZW5kRGF0ZTogc3RyaW5nIH1cbiAgKTogUHJvbWlzZTxTZWFyY2hUZXJtUmVwb3J0W10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY2xpZW50ID0gYXdhaXQgdGhpcy5nZXRHb29nbGVBZHNDbGllbnQodXNlcklkKTtcbiAgICAgIFxuICAgICAgbGV0IGRhdGVGaWx0ZXIgPSAnJztcbiAgICAgIGlmIChkYXRlUmFuZ2UpIHtcbiAgICAgICAgZGF0ZUZpbHRlciA9IGBBTkQgc2VnbWVudHMuZGF0ZSA+PSAnJHtkYXRlUmFuZ2Uuc3RhcnREYXRlfScgQU5EIHNlZ21lbnRzLmRhdGUgPD0gJyR7ZGF0ZVJhbmdlLmVuZERhdGV9J2A7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYFxuICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgc2VhcmNoX3Rlcm1fdmlldy5zZWFyY2hfdGVybSxcbiAgICAgICAgICBtZXRyaWNzLmltcHJlc3Npb25zLFxuICAgICAgICAgIG1ldHJpY3MuY2xpY2tzLFxuICAgICAgICAgIG1ldHJpY3MuY29zdF9taWNyb3MsXG4gICAgICAgICAgbWV0cmljcy5jb252ZXJzaW9ucyxcbiAgICAgICAgICBjYW1wYWlnbi5pZCxcbiAgICAgICAgICBhZF9ncm91cC5pZCxcbiAgICAgICAgICBhZF9ncm91cF9jcml0ZXJpb24uY3JpdGVyaW9uX2lkXG4gICAgICAgIEZST00gc2VhcmNoX3Rlcm1fdmlld1xuICAgICAgICBXSEVSRSBzZWFyY2hfdGVybV92aWV3LnN0YXR1cyAhPSAnTk9ORScgJHtkYXRlRmlsdGVyfVxuICAgICAgICBPUkRFUiBCWSBtZXRyaWNzLmltcHJlc3Npb25zIERFU0NcbiAgICAgIGA7XG5cbiAgICAgIGNvbnN0IHNlYXJjaFRlcm1zID0gYXdhaXQgY2xpZW50LkN1c3RvbWVyKHsgY3VzdG9tZXJfaWQ6IGN1c3RvbWVySWQgfSkucmVwb3J0KHtcbiAgICAgICAgcXVlcnksXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHNlYXJjaFRlcm1zLm1hcCgodGVybTogYW55KSA9PiAoe1xuICAgICAgICBzZWFyY2hfdGVybTogdGVybS5zZWFyY2hfdGVybV92aWV3LnNlYXJjaF90ZXJtLFxuICAgICAgICBpbXByZXNzaW9uczogcGFyc2VJbnQodGVybS5tZXRyaWNzLmltcHJlc3Npb25zKSB8fCAwLFxuICAgICAgICBjbGlja3M6IHBhcnNlSW50KHRlcm0ubWV0cmljcy5jbGlja3MpIHx8IDAsXG4gICAgICAgIGNvc3RfbWljcm9zOiBwYXJzZUludCh0ZXJtLm1ldHJpY3MuY29zdF9taWNyb3MpIHx8IDAsXG4gICAgICAgIGNvbnZlcnNpb25zOiBwYXJzZUZsb2F0KHRlcm0ubWV0cmljcy5jb252ZXJzaW9ucykgfHwgMCxcbiAgICAgICAgY2FtcGFpZ25faWQ6IHRlcm0uY2FtcGFpZ24uaWQudG9TdHJpbmcoKSxcbiAgICAgICAgYWRfZ3JvdXBfaWQ6IHRlcm0uYWRfZ3JvdXAuaWQudG9TdHJpbmcoKSxcbiAgICAgICAga2V5d29yZF9pZDogdGVybS5hZF9ncm91cF9jcml0ZXJpb24/LmNyaXRlcmlvbl9pZD8udG9TdHJpbmcoKSxcbiAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZ2V0IHNlYXJjaCB0ZXJtcyByZXBvcnQnLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgQXBpRXJyb3IoJ0ZhaWxlZCB0byByZXRyaWV2ZSBzZWFyY2ggdGVybXMgcmVwb3J0JywgJ1NFQVJDSF9URVJNU19GQUlMRUQnLCA0MDApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTeW5jIHVzZXIgZGF0YSBmcm9tIEdvb2dsZSBBZHNcbiAgICovXG4gIGFzeW5jIHN5bmNVc2VyRGF0YSh1c2VySWQ6IHN0cmluZywgZm9yY2UgPSBmYWxzZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBsb2dnZXIuaW5mbyhgU3RhcnRpbmcgR29vZ2xlIEFkcyBzeW5jIGZvciB1c2VyICR7dXNlcklkfWApO1xuICAgICAgXG4gICAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IHRoaXMuZ2V0Q3VzdG9tZXJBY2NvdW50cyh1c2VySWQpO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IGFjY291bnQgb2YgYWNjb3VudHMpIHtcbiAgICAgICAgaWYgKGFjY291bnQudHlwZSA9PT0gJ0NMSUVOVCcpIHsgLy8gT25seSBzeW5jIGNsaWVudCBhY2NvdW50cywgbm90IG1hbmFnZXIgYWNjb3VudHNcbiAgICAgICAgICBhd2FpdCB0aGlzLnN5bmNBY2NvdW50RGF0YSh1c2VySWQsIGFjY291bnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFVwZGF0ZSBsYXN0IHN5bmMgdGltZXN0YW1wXG4gICAgICBhd2FpdCB0aGlzLnByaXNtYS5pbnRlZ3JhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHVzZXJJZF9wbGF0Zm9ybToge1xuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgcGxhdGZvcm06ICdHT09HTEVfQURTJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbGFzdFN5bmM6IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgbG9nZ2VyLmluZm8oYENvbXBsZXRlZCBHb29nbGUgQWRzIHN5bmMgZm9yIHVzZXIgJHt1c2VySWR9YCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihgRmFpbGVkIHRvIHN5bmMgR29vZ2xlIEFkcyBkYXRhIGZvciB1c2VyICR7dXNlcklkfWAsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTeW5jIGRhdGEgZm9yIGEgc3BlY2lmaWMgYWNjb3VudFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzeW5jQWNjb3VudERhdGEodXNlcklkOiBzdHJpbmcsIGFjY291bnQ6IEdvb2dsZUFkc0FjY291bnQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gU3luYyBjYW1wYWlnbnNcbiAgICAgIGNvbnN0IGNhbXBhaWducyA9IGF3YWl0IHRoaXMuZ2V0Q2FtcGFpZ25zKHVzZXJJZCwgYWNjb3VudC5pZCk7XG4gICAgICBcbiAgICAgIGZvciAoY29uc3QgY2FtcGFpZ24gb2YgY2FtcGFpZ25zKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc3RvcmVDYW1wYWlnbkRhdGEodXNlcklkLCBhY2NvdW50LCBjYW1wYWlnbik7XG4gICAgICAgIFxuICAgICAgICAvLyBTeW5jIGtleXdvcmRzIGZvciB0aGlzIGNhbXBhaWduXG4gICAgICAgIGNvbnN0IGtleXdvcmRzID0gYXdhaXQgdGhpcy5nZXRLZXl3b3Jkcyh1c2VySWQsIGFjY291bnQuaWQsIFtjYW1wYWlnbi5pZF0pO1xuICAgICAgICBmb3IgKGNvbnN0IGtleXdvcmQgb2Yga2V5d29yZHMpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnN0b3JlS2V5d29yZERhdGEodXNlcklkLCBrZXl3b3JkKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gU3luYyBtZXRyaWNzIGZvciB0aGUgbGFzdCAzMCBkYXlzXG4gICAgICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTtcbiAgICAgICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIDMwICogMjQgKiA2MCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IHRoaXMuZ2V0Q2FtcGFpZ25NZXRyaWNzKHVzZXJJZCwgYWNjb3VudC5pZCwgeyBzdGFydERhdGUsIGVuZERhdGUgfSk7XG4gICAgICAgIGZvciAoY29uc3QgbWV0cmljIG9mIG1ldHJpY3MpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnN0b3JlQ2FtcGFpZ25NZXRyaWNzKHVzZXJJZCwgbWV0cmljKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoYEZhaWxlZCB0byBzeW5jIGFjY291bnQgZGF0YSBmb3IgJHthY2NvdW50LmlkfWAsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU3RvcmUgY2FtcGFpZ24gZGF0YSBpbiBkYXRhYmFzZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzdG9yZUNhbXBhaWduRGF0YShcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBhY2NvdW50OiBHb29nbGVBZHNBY2NvdW50LFxuICAgIGNhbXBhaWduOiBHb29nbGVBZHNDYW1wYWlnblxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnByaXNtYS5jYW1wYWlnbi51cHNlcnQoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgZXh0ZXJuYWxJZF9wbGF0Zm9ybToge1xuICAgICAgICAgIGV4dGVybmFsSWQ6IGNhbXBhaWduLmlkLFxuICAgICAgICAgIHBsYXRmb3JtOiAnR09PR0xFX0FEUycsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgdXBkYXRlOiB7XG4gICAgICAgIG5hbWU6IGNhbXBhaWduLm5hbWUsXG4gICAgICAgIHN0YXR1czogY2FtcGFpZ24uc3RhdHVzLFxuICAgICAgICB0eXBlOiBjYW1wYWlnbi50eXBlLFxuICAgICAgICBzdGFydERhdGU6IGNhbXBhaWduLnN0YXJ0X2RhdGUgPyBuZXcgRGF0ZShjYW1wYWlnbi5zdGFydF9kYXRlKSA6IG51bGwsXG4gICAgICAgIGVuZERhdGU6IGNhbXBhaWduLmVuZF9kYXRlID8gbmV3IERhdGUoY2FtcGFpZ24uZW5kX2RhdGUpIDogbnVsbCxcbiAgICAgICAgYnVkZ2V0OiBjYW1wYWlnbi5idWRnZXRfYW1vdW50LFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9LFxuICAgICAgY3JlYXRlOiB7XG4gICAgICAgIGV4dGVybmFsSWQ6IGNhbXBhaWduLmlkLFxuICAgICAgICBwbGF0Zm9ybTogJ0dPT0dMRV9BRFMnLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIGFjY291bnRJZDogYWNjb3VudC5pZCxcbiAgICAgICAgbmFtZTogY2FtcGFpZ24ubmFtZSxcbiAgICAgICAgc3RhdHVzOiBjYW1wYWlnbi5zdGF0dXMsXG4gICAgICAgIHR5cGU6IGNhbXBhaWduLnR5cGUsXG4gICAgICAgIHN0YXJ0RGF0ZTogY2FtcGFpZ24uc3RhcnRfZGF0ZSA/IG5ldyBEYXRlKGNhbXBhaWduLnN0YXJ0X2RhdGUpIDogbnVsbCxcbiAgICAgICAgZW5kRGF0ZTogY2FtcGFpZ24uZW5kX2RhdGUgPyBuZXcgRGF0ZShjYW1wYWlnbi5lbmRfZGF0ZSkgOiBudWxsLFxuICAgICAgICBidWRnZXQ6IGNhbXBhaWduLmJ1ZGdldF9hbW91bnQsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9yZSBrZXl3b3JkIGRhdGEgaW4gZGF0YWJhc2VcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc3RvcmVLZXl3b3JkRGF0YSh1c2VySWQ6IHN0cmluZywga2V5d29yZDogR29vZ2xlQWRzS2V5d29yZCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMucHJpc21hLmtleXdvcmQudXBzZXJ0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGV4dGVybmFsSWRfcGxhdGZvcm06IHtcbiAgICAgICAgICBleHRlcm5hbElkOiBrZXl3b3JkLmlkLFxuICAgICAgICAgIHBsYXRmb3JtOiAnR09PR0xFX0FEUycsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgdXBkYXRlOiB7XG4gICAgICAgIHRleHQ6IGtleXdvcmQudGV4dCxcbiAgICAgICAgbWF0Y2hUeXBlOiBrZXl3b3JkLm1hdGNoX3R5cGUsXG4gICAgICAgIHN0YXR1czoga2V5d29yZC5zdGF0dXMsXG4gICAgICAgIHF1YWxpdHlTY29yZToga2V5d29yZC5xdWFsaXR5X3Njb3JlLFxuICAgICAgICBmaXJzdFBhZ2VDcGM6IGtleXdvcmQuZmlyc3RfcGFnZV9jcGMsXG4gICAgICAgIHRvcE9mUGFnZUNwYzoga2V5d29yZC50b3Bfb2ZfcGFnZV9jcGMsXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0sXG4gICAgICBjcmVhdGU6IHtcbiAgICAgICAgZXh0ZXJuYWxJZDoga2V5d29yZC5pZCxcbiAgICAgICAgcGxhdGZvcm06ICdHT09HTEVfQURTJyxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBjYW1wYWlnbklkOiBrZXl3b3JkLmNhbXBhaWduX2lkLFxuICAgICAgICBhZEdyb3VwSWQ6IGtleXdvcmQuYWRfZ3JvdXBfaWQsXG4gICAgICAgIHRleHQ6IGtleXdvcmQudGV4dCxcbiAgICAgICAgbWF0Y2hUeXBlOiBrZXl3b3JkLm1hdGNoX3R5cGUsXG4gICAgICAgIHN0YXR1czoga2V5d29yZC5zdGF0dXMsXG4gICAgICAgIHF1YWxpdHlTY29yZToga2V5d29yZC5xdWFsaXR5X3Njb3JlLFxuICAgICAgICBmaXJzdFBhZ2VDcGM6IGtleXdvcmQuZmlyc3RfcGFnZV9jcGMsXG4gICAgICAgIHRvcE9mUGFnZUNwYzoga2V5d29yZC50b3Bfb2ZfcGFnZV9jcGMsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9yZSBjYW1wYWlnbiBtZXRyaWNzIGluIGRhdGFiYXNlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHN0b3JlQ2FtcGFpZ25NZXRyaWNzKHVzZXJJZDogc3RyaW5nLCBtZXRyaWNzOiBHb29nbGVBZHNDYW1wYWlnbk1ldHJpY3MpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnByaXNtYS5jYW1wYWlnbk1ldHJpY3MudXBzZXJ0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGNhbXBhaWduSWRfZGF0ZV9wbGF0Zm9ybToge1xuICAgICAgICAgIGNhbXBhaWduSWQ6IG1ldHJpY3MuY2FtcGFpZ25faWQsXG4gICAgICAgICAgZGF0ZTogbmV3IERhdGUobWV0cmljcy5kYXRlKSxcbiAgICAgICAgICBwbGF0Zm9ybTogJ0dPT0dMRV9BRFMnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHVwZGF0ZToge1xuICAgICAgICBpbXByZXNzaW9uczogbWV0cmljcy5pbXByZXNzaW9ucyxcbiAgICAgICAgY2xpY2tzOiBtZXRyaWNzLmNsaWNrcyxcbiAgICAgICAgY29zdDogbWV0cmljcy5jb3N0X21pY3JvcyAvIDEwMDAwMDAsIC8vIENvbnZlcnQgbWljcm9zIHRvIGN1cnJlbmN5XG4gICAgICAgIGNvbnZlcnNpb25zOiBtZXRyaWNzLmNvbnZlcnNpb25zLFxuICAgICAgICBjdHI6IG1ldHJpY3MuY3RyLFxuICAgICAgICBhdmVyYWdlQ3BjOiBtZXRyaWNzLmF2ZXJhZ2VfY3BjIC8gMTAwMDAwMCwgLy8gQ29udmVydCBtaWNyb3MgdG8gY3VycmVuY3lcbiAgICAgICAgY29zdFBlckNvbnZlcnNpb246IG1ldHJpY3MuY29zdF9wZXJfY29udmVyc2lvbixcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSxcbiAgICAgIGNyZWF0ZToge1xuICAgICAgICBjYW1wYWlnbklkOiBtZXRyaWNzLmNhbXBhaWduX2lkLFxuICAgICAgICBwbGF0Zm9ybTogJ0dPT0dMRV9BRFMnLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIGRhdGU6IG5ldyBEYXRlKG1ldHJpY3MuZGF0ZSksXG4gICAgICAgIGltcHJlc3Npb25zOiBtZXRyaWNzLmltcHJlc3Npb25zLFxuICAgICAgICBjbGlja3M6IG1ldHJpY3MuY2xpY2tzLFxuICAgICAgICBjb3N0OiBtZXRyaWNzLmNvc3RfbWljcm9zIC8gMTAwMDAwMCxcbiAgICAgICAgY29udmVyc2lvbnM6IG1ldHJpY3MuY29udmVyc2lvbnMsXG4gICAgICAgIGN0cjogbWV0cmljcy5jdHIsXG4gICAgICAgIGF2ZXJhZ2VDcGM6IG1ldHJpY3MuYXZlcmFnZV9jcGMgLyAxMDAwMDAwLFxuICAgICAgICBjb3N0UGVyQ29udmVyc2lvbjogbWV0cmljcy5jb3N0X3Blcl9jb252ZXJzaW9uLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRGlzY29ubmVjdCBHb29nbGUgQWRzIGludGVncmF0aW9uXG4gICAqL1xuICBhc3luYyBkaXNjb25uZWN0SW50ZWdyYXRpb24odXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnByaXNtYS5pbnRlZ3JhdGlvbi51cGRhdGUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgdXNlcklkX3BsYXRmb3JtOiB7XG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIHBsYXRmb3JtOiAnR09PR0xFX0FEUycsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgZGF0YToge1xuICAgICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgICAgIGFjY2Vzc1Rva2VuOiBudWxsLFxuICAgICAgICByZWZyZXNoVG9rZW46IG51bGwsXG4gICAgICAgIGV4cGlyZXNBdDogbnVsbCxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBSZW1vdmUgY2FjaGVkIGNsaWVudFxuICAgIGNvbnN0IGNhY2hlS2V5ID0gYGdvb2dsZS1hZHMtY2xpZW50LSR7dXNlcklkfWA7XG4gICAgdGhpcy5nb29nbGVBZHNDbGllbnRzLmRlbGV0ZShjYWNoZUtleSk7XG5cbiAgICBsb2dnZXIuaW5mbyhgRGlzY29ubmVjdGVkIEdvb2dsZSBBZHMgaW50ZWdyYXRpb24gZm9yIHVzZXIgJHt1c2VySWR9YCk7XG4gIH1cblxuICAvKipcbiAgICogU2NoZWR1bGVkIHN5bmMgam9iIC0gcnVucyBldmVyeSAzMCBtaW51dGVzXG4gICAqL1xuICBhc3luYyBzY2hlZHVsZWRTeW5jKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyBzY2hlZHVsZWQgR29vZ2xlIEFkcyBzeW5jJyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGFjdGl2ZUludGVncmF0aW9ucyA9IGF3YWl0IHRoaXMucHJpc21hLmludGVncmF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBwbGF0Zm9ybTogJ0dPT0dMRV9BRFMnLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICB1c2VySWQ6IHRydWUsXG4gICAgICAgICAgbGFzdFN5bmM6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgZm9yIChjb25zdCBpbnRlZ3JhdGlvbiBvZiBhY3RpdmVJbnRlZ3JhdGlvbnMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBPbmx5IHN5bmMgaWYgbGFzdCBzeW5jIHdhcyBtb3JlIHRoYW4gMjUgbWludXRlcyBhZ28gKHRvIGF2b2lkIG92ZXJsYXBwaW5nKVxuICAgICAgICAgIGNvbnN0IGxhc3RTeW5jVGhyZXNob2xkID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIDI1ICogNjAgKiAxMDAwKTtcbiAgICAgICAgICBpZiAoIWludGVncmF0aW9uLmxhc3RTeW5jIHx8IGludGVncmF0aW9uLmxhc3RTeW5jIDwgbGFzdFN5bmNUaHJlc2hvbGQpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc3luY1VzZXJEYXRhKGludGVncmF0aW9uLnVzZXJJZCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmRlbGF5KDIwMDApOyAvLyBSYXRlIGxpbWl0aW5nIGJldHdlZW4gdXNlcnNcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKGBGYWlsZWQgdG8gc3luYyB1c2VyICR7aW50ZWdyYXRpb24udXNlcklkfWAsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBydW4gc2NoZWR1bGVkIHN5bmMnLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFV0aWxpdHkgbWV0aG9kIHRvIGFkZCBkZWxheVxuICAgKi9cbiAgcHJpdmF0ZSBkZWxheShtczogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGNhY2hlZCBjbGllbnRzICh1c2VmdWwgZm9yIHRlc3Rpbmcgb3IgbWVtb3J5IG1hbmFnZW1lbnQpXG4gICAqL1xuICBjbGVhckNsaWVudENhY2hlKCk6IHZvaWQge1xuICAgIHRoaXMuZ29vZ2xlQWRzQ2xpZW50cy5jbGVhcigpO1xuICB9XG59Il0sInZlcnNpb24iOjN9
c47c283da2dd4def24ba62c646f97e97
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.googleAdsConfig = exports.uploadConfig = exports.rateLimitConfig = exports.corsConfig = exports.smtpConfig = exports.jwtConfig = exports.redisConfig = exports.dbConfig = exports.isTest = exports.isProduction = exports.isDevelopment = exports.config = void 0;
const zod_1 = require("zod");
// Environment variables schema
const envSchema = zod_1.z.object({
    // Server
    NODE_ENV: zod_1.z.enum(['development', 'production', 'test']).default('development'),
    PORT: zod_1.z.coerce.number().default(3001),
    HOST: zod_1.z.string().default('0.0.0.0'),
    LOG_LEVEL: zod_1.z.enum(['fatal', 'error', 'warn', 'info', 'debug', 'trace']).default('info'),
    // Database
    DATABASE_URL: zod_1.z.string().min(1, 'DATABASE_URL is required'),
    // Redis
    REDIS_URL: zod_1.z.string().default('redis://localhost:6379'),
    // JWT
    JWT_SECRET: zod_1.z.string().min(32, 'JWT_SECRET must be at least 32 characters'),
    JWT_REFRESH_SECRET: zod_1.z.string().min(32, 'JWT_REFRESH_SECRET must be at least 32 characters'),
    JWT_ACCESS_EXPIRES_IN: zod_1.z.string().default('15m'),
    JWT_REFRESH_EXPIRES_IN: zod_1.z.string().default('7d'),
    // Email
    SMTP_HOST: zod_1.z.string().optional(),
    SMTP_PORT: zod_1.z.coerce.number().optional(),
    SMTP_USER: zod_1.z.string().optional(),
    SMTP_PASS: zod_1.z.string().optional(),
    SMTP_FROM: zod_1.z.string().email().optional(),
    // External APIs
    GOOGLE_ADS_CLIENT_ID: zod_1.z.string().optional(),
    GOOGLE_ADS_CLIENT_SECRET: zod_1.z.string().optional(),
    GOOGLE_ADS_DEVELOPER_TOKEN: zod_1.z.string().optional(),
    GOOGLE_ADS_LOGIN_CUSTOMER_ID: zod_1.z.string().optional(),
    FACEBOOK_APP_ID: zod_1.z.string().optional(),
    FACEBOOK_APP_SECRET: zod_1.z.string().optional(),
    // Rate Limiting
    RATE_LIMIT_MAX: zod_1.z.coerce.number().default(100),
    RATE_LIMIT_WINDOW: zod_1.z.coerce.number().default(60000), // 1 minute
    // CORS
    CORS_ORIGIN: zod_1.z.string().default('http://localhost:3000'),
    // File Upload
    MAX_FILE_SIZE: zod_1.z.coerce.number().default(5242880), // 5MB
    UPLOAD_DIR: zod_1.z.string().default('./uploads'),
    // Webhooks
    WEBHOOK_SECRET: zod_1.z.string().optional(),
    // Monitoring
    SENTRY_DSN: zod_1.z.string().optional(),
    // Feature Flags
    ENABLE_SWAGGER: zod_1.z.coerce.boolean().default(true),
    ENABLE_METRICS: zod_1.z.coerce.boolean().default(true),
    ENABLE_RATE_LIMITING: zod_1.z.coerce.boolean().default(true),
});
// Parse and validate environment variables
const parseEnv = () => {
    try {
        return envSchema.parse(process.env);
    }
    catch (error) {
        if (error instanceof zod_1.z.ZodError) {
            const missingVars = error.errors
                .map(err => `${err.path.join('.')}: ${err.message}`)
                .join('\n');
            console.error('❌ Invalid environment variables:');
            console.error(missingVars);
            process.exit(1);
        }
        throw error;
    }
};
exports.config = parseEnv();
// Helper to check if we're in development
exports.isDevelopment = exports.config.NODE_ENV === 'development';
exports.isProduction = exports.config.NODE_ENV === 'production';
exports.isTest = exports.config.NODE_ENV === 'test';
// Database configuration
exports.dbConfig = {
    url: exports.config.DATABASE_URL,
    // Add connection pool settings for production
    ...(exports.isProduction && {
        pool: {
            min: 2,
            max: 10,
            acquireTimeoutMillis: 30000,
            createTimeoutMillis: 30000,
            destroyTimeoutMillis: 5000,
            idleTimeoutMillis: 30000,
            reapIntervalMillis: 1000,
            createRetryIntervalMillis: 200,
        },
    }),
};
// Redis configuration
exports.redisConfig = {
    url: exports.config.REDIS_URL,
    retryDelayOnFailover: 100,
    enableReadyCheck: false,
    maxRetriesPerRequest: 3,
    lazyConnect: true,
    ...(exports.isProduction && {
        family: 4,
        keepAlive: true,
        connectTimeout: 10000,
        commandTimeout: 5000,
    }),
};
// JWT configuration
exports.jwtConfig = {
    secret: exports.config.JWT_SECRET,
    refreshSecret: exports.config.JWT_REFRESH_SECRET,
    accessExpiresIn: exports.config.JWT_ACCESS_EXPIRES_IN,
    refreshExpiresIn: exports.config.JWT_REFRESH_EXPIRES_IN,
    algorithm: 'HS256',
    issuer: 'utmify-api',
    audience: 'utmify-app',
};
// SMTP configuration
exports.smtpConfig = exports.config.SMTP_HOST ? {
    host: exports.config.SMTP_HOST,
    port: exports.config.SMTP_PORT || 587,
    secure: exports.config.SMTP_PORT === 465,
    auth: {
        user: exports.config.SMTP_USER,
        pass: exports.config.SMTP_PASS,
    },
    from: exports.config.SMTP_FROM,
} : null;
// CORS configuration
exports.corsConfig = {
    origin: exports.config.CORS_ORIGIN.split(',').map(origin => origin.trim()),
    credentials: true,
    methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
    allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],
};
// Rate limiting configuration
exports.rateLimitConfig = {
    max: exports.config.RATE_LIMIT_MAX,
    timeWindow: exports.config.RATE_LIMIT_WINDOW,
    skipSuccessfulRequests: false,
    skipOnError: true,
    keyGenerator: (request) => {
        return request.ip || 'anonymous';
    },
};
// File upload configuration
exports.uploadConfig = {
    maxFileSize: exports.config.MAX_FILE_SIZE,
    uploadDir: exports.config.UPLOAD_DIR,
    allowedMimeTypes: [
        'image/jpeg',
        'image/png',
        'image/webp',
        'image/svg+xml',
        'text/csv',
        'application/json',
    ],
};
// Google Ads API Configuration
exports.googleAdsConfig = exports.config.GOOGLE_ADS_CLIENT_ID ? {
    clientId: exports.config.GOOGLE_ADS_CLIENT_ID,
    clientSecret: exports.config.GOOGLE_ADS_CLIENT_SECRET,
    developerToken: exports.config.GOOGLE_ADS_DEVELOPER_TOKEN,
    loginCustomerId: exports.config.GOOGLE_ADS_LOGIN_CUSTOMER_ID,
    apiVersion: 'v15',
} : null;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxFbnpvIE1hcmNlbG9cXERlc2t0b3BcXFByb2pldG9zIEVtcHJlc2FcXFNhYXMgVXRtaWZ5XFx1dG1pZnktY2xvbmVcXGFwcHNcXGFwaVxcc3JjXFxjb25maWdcXGVudi50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSw2QkFBdUI7QUFFdkIsK0JBQStCO0FBQy9CLE1BQU0sU0FBUyxHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDekIsU0FBUztJQUNULFFBQVEsRUFBRSxPQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsYUFBYSxFQUFFLFlBQVksRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUM7SUFDOUUsSUFBSSxFQUFFLE9BQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztJQUNyQyxJQUFJLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7SUFDbkMsU0FBUyxFQUFFLE9BQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztJQUV2RixXQUFXO0lBQ1gsWUFBWSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLDBCQUEwQixDQUFDO0lBRTNELFFBQVE7SUFDUixTQUFTLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQztJQUV2RCxNQUFNO0lBQ04sVUFBVSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLDJDQUEyQyxDQUFDO0lBQzNFLGtCQUFrQixFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLG1EQUFtRCxDQUFDO0lBQzNGLHFCQUFx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QyxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLFNBQVMsQ0FBQztJQUM3RCxjQUFjLEVBQUUsQ0FBQyxjQUFjLEVBQUUsZUFBZSxFQUFFLGtCQUFrQixDQUFDO0NBQ3RFLENBQUE7QUFFRCw4QkFBOEI7QUFDakIsUUFBQSxlQUFlLEdBQUc7SUFDN0IsR0FBRyxFQUFFLGNBQU0sQ0FBQyxjQUFjO0lBQzFCLFVBQVUsRUFBRSxjQUFNLENBQUMsaUJBQWlCO0lBQ3BDLHNCQUFzQixFQUFFLEtBQUs7SUFDN0IsV0FBVyxFQUFFLElBQUk7SUFDakIsWUFBWSxFQUFFLENBQUMsT0FBWSxFQUFFLEVBQUU7UUFDN0IsT0FBTyxPQUFPLENBQUMsRUFBRSxJQUFJLFdBQVcsQ0FBQTtJQUNsQyxDQUFDO0NBQ0YsQ0FBQTtBQUVELDRCQUE0QjtBQUNmLFFBQUEsWUFBWSxHQUFHO0lBQzFCLFdBQVcsRUFBRSxjQUFNLENBQUMsYUFBYTtJQUNqQyxTQUFTLEVBQUUsY0FBTSxDQUFDLFVBQVU7SUFDNUIsZ0JBQWdCLEVBQUU7UUFDaEIsWUFBWTtRQUNaLFdBQVc7UUFDWCxZQUFZO1FBQ1osZUFBZTtRQUNmLFVBQVU7UUFDVixrQkFBa0I7S0FDbkI7Q0FDRixDQUFBO0FBRUQsK0JBQStCO0FBQ2xCLFFBQUEsZUFBZSxHQUFHLGNBQU0sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7SUFDM0QsUUFBUSxFQUFFLGNBQU0sQ0FBQyxvQkFBcUI7SUFDdEMsWUFBWSxFQUFFLGNBQU0sQ0FBQyx3QkFBeUI7SUFDOUMsY0FBYyxFQUFFLGNBQU0sQ0FBQywwQkFBMkI7SUFDbEQsZUFBZSxFQUFFLGNBQU0sQ0FBQyw0QkFBNEI7SUFDcEQsVUFBVSxFQUFFLEtBQUs7Q0FDbEIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFBIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcRW56byBNYXJjZWxvXFxEZXNrdG9wXFxQcm9qZXRvcyBFbXByZXNhXFxTYWFzIFV0bWlmeVxcdXRtaWZ5LWNsb25lXFxhcHBzXFxhcGlcXHNyY1xcY29uZmlnXFxlbnYudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCdcblxuLy8gRW52aXJvbm1lbnQgdmFyaWFibGVzIHNjaGVtYVxuY29uc3QgZW52U2NoZW1hID0gei5vYmplY3Qoe1xuICAvLyBTZXJ2ZXJcbiAgTk9ERV9FTlY6IHouZW51bShbJ2RldmVsb3BtZW50JywgJ3Byb2R1Y3Rpb24nLCAndGVzdCddKS5kZWZhdWx0KCdkZXZlbG9wbWVudCcpLFxuICBQT1JUOiB6LmNvZXJjZS5udW1iZXIoKS5kZWZhdWx0KDMwMDEpLFxuICBIT1NUOiB6LnN0cmluZygpLmRlZmF1bHQoJzAuMC4wLjAnKSxcbiAgTE9HX0xFVkVMOiB6LmVudW0oWydmYXRhbCcsICdlcnJvcicsICd3YXJuJywgJ2luZm8nLCAnZGVidWcnLCAndHJhY2UnXSkuZGVmYXVsdCgnaW5mbycpLFxuICBcbiAgLy8gRGF0YWJhc2VcbiAgREFUQUJBU0VfVVJMOiB6LnN0cmluZygpLm1pbigxLCAnREFUQUJBU0VfVVJMIGlzIHJlcXVpcmVkJyksXG4gIFxuICAvLyBSZWRpc1xuICBSRURJU19VUkw6IHouc3RyaW5nKCkuZGVmYXVsdCgncmVkaXM6Ly9sb2NhbGhvc3Q6NjM3OScpLFxuICBcbiAgLy8gSldUXG4gIEpXVF9TRUNSRVQ6IHouc3RyaW5nKCkubWluKDMyLCAnSldUX1NFQ1JFVCBtdXN0IGJlIGF0IGxlYXN0IDMyIGNoYXJhY3RlcnMnKSxcbiAgSldUX1JFRlJFU0hfU0VDUkVUOiB6LnN0cmluZygpLm1pbigzMiwgJ0pXVF9SRUZSRVNIX1NFQ1JFVCBtdXN0IGJlIGF0IGxlYXN0IDMyIGNoYXJhY3RlcnMnKSxcbiAgSldUX0FDQ0VTU19FWFBJUkVTX0lOOiB6LnN0cmluZygpLmRlZmF1bHQoJzE1bScpLFxuICBKV1RfUkVGUkVTSF9FWFBJUkVTX0lOOiB6LnN0cmluZygpLmRlZmF1bHQoJzdkJyksXG4gIFxuICAvLyBFbWFpbFxuICBTTVRQX0hPU1Q6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgU01UUF9QT1JUOiB6LmNvZXJjZS5udW1iZXIoKS5vcHRpb25hbCgpLFxuICBTTVRQX1VTRVI6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgU01UUF9QQVNTOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIFNNVFBfRlJPTTogei5zdHJpbmcoKS5lbWFpbCgpLm9wdGlvbmFsKCksXG4gIFxuICAvLyBFeHRlcm5hbCBBUElzXG4gIEdPT0dMRV9BRFNfQ0xJRU5UX0lEOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIEdPT0dMRV9BRFNfQ0xJRU5UX1NFQ1JFVDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBHT09HTEVfQURTX0RFVkVMT1BFUl9UT0tFTjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBHT09HTEVfQURTX0xPR0lOX0NVU1RPTUVSX0lEOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIEZBQ0VCT09LX0FQUF9JRDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBGQUNFQk9PS19BUFBfU0VDUkVUOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIFxuICAvLyBSYXRlIExpbWl0aW5nXG4gIFJBVEVfTElNSVRfTUFYOiB6LmNvZXJjZS5udW1iZXIoKS5kZWZhdWx0KDEwMCksXG4gIFJBVEVfTElNSVRfV0lORE9XOiB6LmNvZXJjZS5udW1iZXIoKS5kZWZhdWx0KDYwMDAwKSwgLy8gMSBtaW51dGVcbiAgXG4gIC8vIENPUlNcbiAgQ09SU19PUklHSU46IHouc3RyaW5nKCkuZGVmYXVsdCgnaHR0cDovL2xvY2FsaG9zdDozMDAwJyksXG4gIFxuICAvLyBGaWxlIFVwbG9hZFxuICBNQVhfRklMRV9TSVpFOiB6LmNvZXJjZS5udW1iZXIoKS5kZWZhdWx0KDUyNDI4ODApLCAvLyA1TUJcbiAgVVBMT0FEX0RJUjogei5zdHJpbmcoKS5kZWZhdWx0KCcuL3VwbG9hZHMnKSxcbiAgXG4gIC8vIFdlYmhvb2tzXG4gIFdFQkhPT0tfU0VDUkVUOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIFxuICAvLyBNb25pdG9yaW5nXG4gIFNFTlRSWV9EU046IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgXG4gIC8vIEZlYXR1cmUgRmxhZ3NcbiAgRU5BQkxFX1NXQUdHRVI6IHouY29lcmNlLmJvb2xlYW4oKS5kZWZhdWx0KHRydWUpLFxuICBFTkFCTEVfTUVUUklDUzogei5jb2VyY2UuYm9vbGVhbigpLmRlZmF1bHQodHJ1ZSksXG4gIEVOQUJMRV9SQVRFX0xJTUlUSU5HOiB6LmNvZXJjZS5ib29sZWFuKCkuZGVmYXVsdCh0cnVlKSxcbn0pXG5cbi8vIFBhcnNlIGFuZCB2YWxpZGF0ZSBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbmNvbnN0IHBhcnNlRW52ID0gKCkgPT4ge1xuICB0cnkge1xuICAgIHJldHVybiBlbnZTY2hlbWEucGFyc2UocHJvY2Vzcy5lbnYpXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgY29uc3QgbWlzc2luZ1ZhcnMgPSBlcnJvci5lcnJvcnNcbiAgICAgICAgLm1hcChlcnIgPT4gYCR7ZXJyLnBhdGguam9pbignLicpfTogJHtlcnIubWVzc2FnZX1gKVxuICAgICAgICAuam9pbignXFxuJylcbiAgICAgIFxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEludmFsaWQgZW52aXJvbm1lbnQgdmFyaWFibGVzOicpXG4gICAgICBjb25zb2xlLmVycm9yKG1pc3NpbmdWYXJzKVxuICAgICAgcHJvY2Vzcy5leGl0KDEpXG4gICAgfVxuICAgIHRocm93IGVycm9yXG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHBhcnNlRW52KClcblxuLy8gVHlwZSBmb3IgZW52aXJvbm1lbnQgY29uZmlnXG5leHBvcnQgdHlwZSBDb25maWcgPSB0eXBlb2YgY29uZmlnXG5cbi8vIEhlbHBlciB0byBjaGVjayBpZiB3ZSdyZSBpbiBkZXZlbG9wbWVudFxuZXhwb3J0IGNvbnN0IGlzRGV2ZWxvcG1lbnQgPSBjb25maWcuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCdcbmV4cG9ydCBjb25zdCBpc1Byb2R1Y3Rpb24gPSBjb25maWcuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJ1xuZXhwb3J0IGNvbnN0IGlzVGVzdCA9IGNvbmZpZy5OT0RFX0VOViA9PT0gJ3Rlc3QnXG5cbi8vIERhdGFiYXNlIGNvbmZpZ3VyYXRpb25cbmV4cG9ydCBjb25zdCBkYkNvbmZpZyA9IHtcbiAgdXJsOiBjb25maWcuREFUQUJBU0VfVVJMLFxuICAvLyBBZGQgY29ubmVjdGlvbiBwb29sIHNldHRpbmdzIGZvciBwcm9kdWN0aW9uXG4gIC4uLihpc1Byb2R1Y3Rpb24gJiYge1xuICAgIHBvb2w6IHtcbiAgICAgIG1pbjogMixcbiAgICAgIG1heDogMTAsXG4gICAgICBhY3F1aXJlVGltZW91dE1pbGxpczogMzAwMDAsXG4gICAgICBjcmVhdGVUaW1lb3V0TWlsbGlzOiAzMDAwMCxcbiAgICAgIGRlc3Ryb3lUaW1lb3V0TWlsbGlzOiA1MDAwLFxuICAgICAgaWRsZVRpbWVvdXRNaWxsaXM6IDMwMDAwLFxuICAgICAgcmVhcEludGVydmFsTWlsbGlzOiAxMDAwLFxuICAgICAgY3JlYXRlUmV0cnlJbnRlcnZhbE1pbGxpczogMjAwLFxuICAgIH0sXG4gIH0pLFxufVxuXG4vLyBSZWRpcyBjb25maWd1cmF0aW9uXG5leHBvcnQgY29uc3QgcmVkaXNDb25maWcgPSB7XG4gIHVybDogY29uZmlnLlJFRElTX1VSTCxcbiAgcmV0cnlEZWxheU9uRmFpbG92ZXI6IDEwMCxcbiAgZW5hYmxlUmVhZHlDaGVjazogZmFsc2UsXG4gIG1heFJldHJpZXNQZXJSZXF1ZXN0OiAzLFxuICBsYXp5Q29ubmVjdDogdHJ1ZSxcbiAgLi4uKGlzUHJvZHVjdGlvbiAmJiB7XG4gICAgZmFtaWx5OiA0LFxuICAgIGtlZXBBbGl2ZTogdHJ1ZSxcbiAgICBjb25uZWN0VGltZW91dDogMTAwMDAsXG4gICAgY29tbWFuZFRpbWVvdXQ6IDUwMDAsXG4gIH0pLFxufVxuXG4vLyBKV1QgY29uZmlndXJhdGlvblxuZXhwb3J0IGNvbnN0IGp3dENvbmZpZyA9IHtcbiAgc2VjcmV0OiBjb25maWcuSldUX1NFQ1JFVCxcbiAgcmVmcmVzaFNlY3JldDogY29uZmlnLkpXVF9SRUZSRVNIX1NFQ1JFVCxcbiAgYWNjZXNzRXhwaXJlc0luOiBjb25maWcuSldUX0FDQ0VTU19FWFBJUkVTX0lOLFxuICByZWZyZXNoRXhwaXJlc0luOiBjb25maWcuSldUX1JFRlJFU0hfRVhQSVJFU19JTixcbiAgYWxnb3JpdGhtOiAnSFMyNTYnIGFzIGNvbnN0LFxuICBpc3N1ZXI6ICd1dG1pZnktYXBpJyxcbiAgYXVkaWVuY2U6ICd1dG1pZnktYXBwJyxcbn1cblxuLy8gU01UUCBjb25maWd1cmF0aW9uXG5leHBvcnQgY29uc3Qgc210cENvbmZpZyA9IGNvbmZpZy5TTVRQX0hPU1QgPyB7XG4gIGhvc3Q6IGNvbmZpZy5TTVRQX0hPU1QsXG4gIHBvcnQ6IGNvbmZpZy5TTVRQX1BPUlQgfHwgNTg3LFxuICBzZWN1cmU6IGNvbmZpZy5TTVRQX1BPUlQgPT09IDQ2NSxcbiAgYXV0aDoge1xuICAgIHVzZXI6IGNvbmZpZy5TTVRQX1VTRVIhLFxuICAgIHBhc3M6IGNvbmZpZy5TTVRQX1BBU1MhLFxuICB9LFxuICBmcm9tOiBjb25maWcuU01UUF9GUk9NISxcbn0gOiBudWxsXG5cbi8vIENPUlMgY29uZmlndXJhdGlvblxuZXhwb3J0IGNvbnN0IGNvcnNDb25maWcgPSB7XG4gIG9yaWdpbjogY29uZmlnLkNPUlNfT1JJR0lOLnNwbGl0KCcsJykubWFwKG9yaWdpbiA9PiBvcmlnaW4udHJpbSgpKSxcbiAgY3JlZGVudGlhbHM6IHRydWUsXG4gIG1ldGhvZHM6IFsnR0VUJywgJ1BPU1QnLCAnUFVUJywgJ0RFTEVURScsICdQQVRDSCcsICdPUFRJT05TJ10sXG4gIGFsbG93ZWRIZWFkZXJzOiBbJ0NvbnRlbnQtVHlwZScsICdBdXRob3JpemF0aW9uJywgJ1gtUmVxdWVzdGVkLVdpdGgnXSxcbn1cblxuLy8gUmF0ZSBsaW1pdGluZyBjb25maWd1cmF0aW9uXG5leHBvcnQgY29uc3QgcmF0ZUxpbWl0Q29uZmlnID0ge1xuICBtYXg6IGNvbmZpZy5SQVRFX0xJTUlUX01BWCxcbiAgdGltZVdpbmRvdzogY29uZmlnLlJBVEVfTElNSVRfV0lORE9XLFxuICBza2lwU3VjY2Vzc2Z1bFJlcXVlc3RzOiBmYWxzZSxcbiAgc2tpcE9uRXJyb3I6IHRydWUsXG4gIGtleUdlbmVyYXRvcjogKHJlcXVlc3Q6IGFueSkgPT4ge1xuICAgIHJldHVybiByZXF1ZXN0LmlwIHx8ICdhbm9ueW1vdXMnXG4gIH0sXG59XG5cbi8vIEZpbGUgdXBsb2FkIGNvbmZpZ3VyYXRpb25cbmV4cG9ydCBjb25zdCB1cGxvYWRDb25maWcgPSB7XG4gIG1heEZpbGVTaXplOiBjb25maWcuTUFYX0ZJTEVfU0laRSxcbiAgdXBsb2FkRGlyOiBjb25maWcuVVBMT0FEX0RJUixcbiAgYWxsb3dlZE1pbWVUeXBlczogW1xuICAgICdpbWFnZS9qcGVnJyxcbiAgICAnaW1hZ2UvcG5nJyxcbiAgICAnaW1hZ2Uvd2VicCcsXG4gICAgJ2ltYWdlL3N2Zyt4bWwnLFxuICAgICd0ZXh0L2NzdicsXG4gICAgJ2FwcGxpY2F0aW9uL2pzb24nLFxuICBdLFxufVxuXG4vLyBHb29nbGUgQWRzIEFQSSBDb25maWd1cmF0aW9uXG5leHBvcnQgY29uc3QgZ29vZ2xlQWRzQ29uZmlnID0gY29uZmlnLkdPT0dMRV9BRFNfQ0xJRU5UX0lEID8ge1xuICBjbGllbnRJZDogY29uZmlnLkdPT0dMRV9BRFNfQ0xJRU5UX0lEISxcbiAgY2xpZW50U2VjcmV0OiBjb25maWcuR09PR0xFX0FEU19DTElFTlRfU0VDUkVUISxcbiAgZGV2ZWxvcGVyVG9rZW46IGNvbmZpZy5HT09HTEVfQURTX0RFVkVMT1BFUl9UT0tFTiEsXG4gIGxvZ2luQ3VzdG9tZXJJZDogY29uZmlnLkdPT0dMRV9BRFNfTE9HSU5fQ1VTVE9NRVJfSUQsXG4gIGFwaVZlcnNpb246ICd2MTUnLFxufSA6IG51bGwiXSwidmVyc2lvbiI6M30=
{"version":3,"names":["cov_20tw0bgqyd","actualCoverage","Injectable","Logger","Cron","CronExpression","InvitationService","InvitationCleanupScheduler","s","InvitationCleanupScheduler_1","invitationService","logger","name","constructor","f","handleCleanupExpiredInvitations","log","count","cleanupExpiredInvitations","error","message","stack","handleFrequentCleanup","debug","b","__decorate","EVERY_DAY_AT_2AM","Promise","_b","Object","EVERY_6_HOURS","_c","_a"],"sources":["C:\\Users\\Enzo Marcelo\\Desktop\\Projetos Empresa\\Saas Utmify\\utmify-clone\\apps\\api\\src\\schedulers\\invitation-cleanup.scheduler.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\nimport { Cron, CronExpression } from '@nestjs/schedule';\nimport { InvitationService } from '../services/invitation.service';\n\n@Injectable()\nexport class InvitationCleanupScheduler {\n  private readonly logger = new Logger(InvitationCleanupScheduler.name);\n\n  constructor(private readonly invitationService: InvitationService) {}\n\n  // Executar limpeza de convites expirados todos os dias Ã s 2:00 AM\n  @Cron(CronExpression.EVERY_DAY_AT_2AM)\n  async handleCleanupExpiredInvitations(): Promise<void> {\n    try {\n      this.logger.log('Starting cleanup of expired invitations');\n      \n      const count = await this.invitationService.cleanupExpiredInvitations();\n      \n      this.logger.log(`Cleanup completed: ${count} expired invitations processed`);\n    } catch (error) {\n      this.logger.error(\n        `Failed to cleanup expired invitations: ${error.message}`,\n        error.stack,\n      );\n    }\n  }\n\n  // Executar limpeza a cada 6 horas (opcional, para ambientes com muitos convites)\n  @Cron(CronExpression.EVERY_6_HOURS)\n  async handleFrequentCleanup(): Promise<void> {\n    try {\n      this.logger.debug('Starting frequent cleanup of expired invitations');\n      \n      const count = await this.invitationService.cleanupExpiredInvitations();\n      \n      if (count > 0) {\n        this.logger.log(`Frequent cleanup: ${count} expired invitations processed`);\n      } else {\n        this.logger.debug('Frequent cleanup: no expired invitations found');\n      }\n    } catch (error) {\n      this.logger.error(\n        `Failed to perform frequent cleanup: ${error.message}`,\n        error.stack,\n      );\n    }\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}
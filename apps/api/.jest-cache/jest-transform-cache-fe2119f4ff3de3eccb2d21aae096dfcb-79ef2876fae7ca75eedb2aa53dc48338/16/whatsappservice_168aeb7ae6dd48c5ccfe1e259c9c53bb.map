{"version":3,"names":["cov_2h48fpenaj","actualCoverage","s","logger_1","require","twilio_1","WhatsAppService","prisma","whatsappQueue","cryptoService","configService","twilioClient","dailyLimit","constructor","f","initializeTwilio","accountSid","get","authToken","b","logger","warn","Twilio","log","sendMessage","organizationId","message","canSend","checkDailyLimit","BadRequestException","job","add","attempts","backoff","type","delay","id","success","messageId","toString","error","processMessage","Error","fromNumber","twilioMessage","templateName","messages","create","from","to","contentSid","contentVariables","JSON","stringify","templateParams","messageData","body","mediaUrl","logMessage","twilioSid","sid","status","direction","sendBroadcast","recipients","errors","queued","recipient","result","push","length","getTemplates","templates","whatsAppTemplate","findMany","where","orderBy","createdAt","map","template","name","category","language","components","parse","createTemplate","data","getConversations","limit","offset","conversations","whatsAppMessage","groupBy","by","_count","_max","take","skip","conversationsWithMessages","Promise","all","conv","latestMessage","findFirst","phoneNumber","messageCount","lastMessageAt","lastMessage","lastMessageDirection","getConversationMessages","handleWebhook","webhookData","From","To","Body","MessageSid","SmsStatus","replace","toNumber","organization","findOrganizationByWhatsAppNumber","processAutomatedResponse","getMetrics","today","Date","setHours","tomorrow","setDate","getDate","totalMessages","sentToday","receivedToday","failedToday","count","gte","lt","sentMessages","receivedMessages","failedMessages","remainingQuota","Math","max","integration","platform","isActive","metadata","path","equals","include","messageBody","toLowerCase","trim","sendDailyReport","sendHelpMessage","yesterday","reportMessage","toLocaleDateString","helpMessage","exports"],"sources":["C:\\Users\\Enzo Marcelo\\Desktop\\Projetos Empresa\\Saas Utmify\\utmify-clone\\apps\\api\\src\\services\\whatsapp.service.ts"],"sourcesContent":["import { PrismaService } from '../database/prisma.service';\nimport { CryptoService } from './crypto.service';\nimport { logger } from '../utils/logger';\nimport { Twilio } from 'twilio';\nimport { Queue } from 'bull';\n\nexport interface WhatsAppMessage {\n  to: string;\n  body?: string;\n  mediaUrl?: string;\n  templateName?: string;\n  templateParams?: Record<string, string>;\n}\n\nexport interface WhatsAppTemplate {\n  name: string;\n  category: 'MARKETING' | 'UTILITY' | 'AUTHENTICATION';\n  language: string;\n  components: {\n    type: 'HEADER' | 'BODY' | 'FOOTER' | 'BUTTONS';\n    text?: string;\n    parameters?: Array<{ type: string; text: string }>;\n  }[];\n}\n\nexport interface ConversationMetrics {\n  totalMessages: number;\n  sentMessages: number;\n  receivedMessages: number;\n  failedMessages: number;\n  dailyLimit: number;\n  remainingQuota: number;\n}\n\nexport class WhatsAppService {\n  private twilioClient: Twilio;\n  private readonly dailyLimit = 1000;\n\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly whatsappQueue: Queue | null,\n    private readonly cryptoService: CryptoService,\n    private readonly configService: any,\n  ) {\n    this.initializeTwilio();\n  }\n\n  private initializeTwilio() {\n    const accountSid = this.configService.get<string>('TWILIO_ACCOUNT_SID');\n    const authToken = this.configService.get<string>('TWILIO_AUTH_TOKEN');\n\n    if (!accountSid || !authToken) {\n      logger.warn('Twilio credentials not configured');\n      return;\n    }\n\n    this.twilioClient = new Twilio(accountSid, authToken);\n    this.logger.log('Twilio WhatsApp client initialized');\n  }\n\n  /**\n   * Send WhatsApp message\n   */\n  async sendMessage(\n    organizationId: string,\n    message: WhatsAppMessage,\n  ): Promise<{ success: boolean; messageId?: string; error?: string }> {\n    try {\n      // Check daily limit\n      const canSend = await this.checkDailyLimit(organizationId);\n      if (!canSend) {\n        throw new BadRequestException('Daily message limit exceeded (1000 messages)');\n      }\n\n      // Add to queue for rate limiting\n      const job = await this.whatsappQueue.add('send-message', {\n        organizationId,\n        message,\n      }, {\n        attempts: 3,\n        backoff: {\n          type: 'exponential',\n          delay: 2000,\n        },\n      });\n\n      logger.log(`Message queued for sending: ${job.id}`);\n      return { success: true, messageId: job.id.toString() };\n    } catch (error) {\n      logger.error('Error sending WhatsApp message:', error);\n      return { success: false, error: error.message };\n    }\n  }\n\n  /**\n   * Process message from queue\n   */\n  async processMessage(\n    organizationId: string,\n    message: WhatsAppMessage,\n  ): Promise<void> {\n    try {\n      if (!this.twilioClient) {\n        throw new Error('Twilio client not initialized');\n      }\n\n      const fromNumber = this.configService.get<string>('TWILIO_WHATSAPP_NUMBER');\n      if (!fromNumber) {\n        throw new Error('Twilio WhatsApp number not configured');\n      }\n\n      let twilioMessage;\n\n      if (message.templateName) {\n        // Send template message\n        twilioMessage = await this.twilioClient.messages.create({\n          from: `whatsapp:${fromNumber}`,\n          to: `whatsapp:${message.to}`,\n          contentSid: message.templateName,\n          contentVariables: JSON.stringify(message.templateParams || {}),\n        });\n      } else {\n        // Send regular message\n        const messageData: any = {\n          from: `whatsapp:${fromNumber}`,\n          to: `whatsapp:${message.to}`,\n        };\n\n        if (message.body) {\n          messageData.body = message.body;\n        }\n\n        if (message.mediaUrl) {\n          messageData.mediaUrl = [message.mediaUrl];\n        }\n\n        twilioMessage = await this.twilioClient.messages.create(messageData);\n      }\n\n      // Log message in database\n      await this.logMessage(organizationId, {\n        twilioSid: twilioMessage.sid,\n        to: message.to,\n        body: message.body,\n        templateName: message.templateName,\n        status: 'sent',\n        direction: 'outbound',\n      });\n\n      logger.log(`WhatsApp message sent successfully: ${twilioMessage.sid}`);\n    } catch (error) {\n      logger.error('Error processing WhatsApp message:', error);\n      \n      // Log failed message\n      await this.logMessage(organizationId, {\n        to: message.to,\n        body: message.body,\n        templateName: message.templateName,\n        status: 'failed',\n        direction: 'outbound',\n        error: error.message,\n      });\n\n      throw error;\n    }\n  }\n\n  /**\n   * Send broadcast message to multiple recipients\n   */\n  async sendBroadcast(\n    organizationId: string,\n    recipients: string[],\n    message: Omit<WhatsAppMessage, 'to'>,\n  ): Promise<{ success: boolean; queued: number; errors: string[] }> {\n    const errors: string[] = [];\n    let queued = 0;\n\n    for (const recipient of recipients) {\n      try {\n        const result = await this.sendMessage(organizationId, {\n          ...message,\n          to: recipient,\n        });\n\n        if (result.success) {\n          queued++;\n        } else {\n          errors.push(`${recipient}: ${result.error}`);\n        }\n      } catch (error) {\n        errors.push(`${recipient}: ${error.message}`);\n      }\n    }\n\n    return {\n      success: errors.length === 0,\n      queued,\n      errors,\n    };\n  }\n\n  /**\n   * Get message templates\n   */\n  async getTemplates(organizationId: string): Promise<WhatsAppTemplate[]> {\n    try {\n      // Get templates from database\n      const templates = await this.prisma.whatsAppTemplate.findMany({\n        where: { organizationId },\n        orderBy: { createdAt: 'desc' },\n      });\n\n      return templates.map(template => ({\n        name: template.name,\n        category: template.category as any,\n        language: template.language,\n        components: JSON.parse(template.components),\n      }));\n    } catch (error) {\n      logger.error('Error fetching WhatsApp templates:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Create message template\n   */\n  async createTemplate(\n    organizationId: string,\n    template: WhatsAppTemplate,\n  ): Promise<{ success: boolean; error?: string }> {\n    try {\n      await this.prisma.whatsAppTemplate.create({\n        data: {\n          organizationId,\n          name: template.name,\n          category: template.category,\n          language: template.language,\n          components: JSON.stringify(template.components),\n        },\n      });\n\n      logger.log(`WhatsApp template created: ${template.name}`);\n      return { success: true };\n    } catch (error) {\n      logger.error('Error creating WhatsApp template:', error);\n      return { success: false, error: error.message };\n    }\n  }\n\n  /**\n   * Get conversations\n   */\n  async getConversations(\n    organizationId: string,\n    limit = 50,\n    offset = 0,\n  ): Promise<any[]> {\n    try {\n      const conversations = await this.prisma.whatsAppMessage.groupBy({\n        by: ['phoneNumber'],\n        where: { organizationId },\n        _count: { id: true },\n        _max: { createdAt: true },\n        orderBy: { _max: { createdAt: 'desc' } },\n        take: limit,\n        skip: offset,\n      });\n\n      // Get latest message for each conversation\n      const conversationsWithMessages = await Promise.all(\n        conversations.map(async (conv) => {\n          const latestMessage = await this.prisma.whatsAppMessage.findFirst({\n            where: {\n              organizationId,\n              phoneNumber: conv.phoneNumber,\n            },\n            orderBy: { createdAt: 'desc' },\n          });\n\n          return {\n            phoneNumber: conv.phoneNumber,\n            messageCount: conv._count.id,\n            lastMessageAt: conv._max.createdAt,\n            lastMessage: latestMessage?.body || latestMessage?.templateName,\n            lastMessageDirection: latestMessage?.direction,\n          };\n        }),\n      );\n\n      return conversationsWithMessages;\n    } catch (error) {\n      this.logger.error('Error fetching conversations:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Get conversation messages\n   */\n  async getConversationMessages(\n    organizationId: string,\n    phoneNumber: string,\n    limit = 50,\n    offset = 0,\n  ): Promise<any[]> {\n    try {\n      const messages = await this.prisma.whatsAppMessage.findMany({\n        where: {\n          organizationId,\n          phoneNumber,\n        },\n        orderBy: { createdAt: 'desc' },\n        take: limit,\n        skip: offset,\n      });\n\n      return messages;\n    } catch (error) {\n      this.logger.error('Error fetching conversation messages:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Handle incoming webhook\n   */\n  async handleWebhook(webhookData: any): Promise<void> {\n    try {\n      const { From, To, Body, MessageSid, SmsStatus } = webhookData;\n      \n      if (!From || !MessageSid) {\n        this.logger.warn('Invalid webhook data received');\n        return;\n      }\n\n      // Extract phone number (remove whatsapp: prefix)\n      const phoneNumber = From.replace('whatsapp:', '');\n      const toNumber = To?.replace('whatsapp:', '');\n\n      // Find organization by WhatsApp number\n      const organization = await this.findOrganizationByWhatsAppNumber(toNumber);\n      if (!organization) {\n        this.logger.warn(`No organization found for WhatsApp number: ${toNumber}`);\n        return;\n      }\n\n      // Log incoming message\n      await this.logMessage(organization.id, {\n        twilioSid: MessageSid,\n        phoneNumber,\n        body: Body,\n        status: SmsStatus || 'received',\n        direction: 'inbound',\n      });\n\n      // Process automated responses\n      await this.processAutomatedResponse(organization.id, phoneNumber, Body);\n\n      this.logger.log(`Webhook processed for message: ${MessageSid}`);\n    } catch (error) {\n      this.logger.error('Error processing WhatsApp webhook:', error);\n    }\n  }\n\n  /**\n   * Get conversation metrics\n   */\n  async getMetrics(organizationId: string): Promise<ConversationMetrics> {\n    try {\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      const tomorrow = new Date(today);\n      tomorrow.setDate(tomorrow.getDate() + 1);\n\n      const [totalMessages, sentToday, receivedToday, failedToday] = await Promise.all([\n        this.prisma.whatsAppMessage.count({\n          where: { organizationId },\n        }),\n        this.prisma.whatsAppMessage.count({\n          where: {\n            organizationId,\n            direction: 'outbound',\n            status: 'sent',\n            createdAt: {\n              gte: today,\n              lt: tomorrow,\n            },\n          },\n        }),\n        this.prisma.whatsAppMessage.count({\n          where: {\n            organizationId,\n            direction: 'inbound',\n            createdAt: {\n              gte: today,\n              lt: tomorrow,\n            },\n          },\n        }),\n        this.prisma.whatsAppMessage.count({\n          where: {\n            organizationId,\n            direction: 'outbound',\n            status: 'failed',\n            createdAt: {\n              gte: today,\n              lt: tomorrow,\n            },\n          },\n        }),\n      ]);\n\n      return {\n        totalMessages,\n        sentMessages: sentToday,\n        receivedMessages: receivedToday,\n        failedMessages: failedToday,\n        dailyLimit: this.dailyLimit,\n        remainingQuota: Math.max(0, this.dailyLimit - sentToday),\n      };\n    } catch (error) {\n      this.logger.error('Error fetching WhatsApp metrics:', error);\n      return {\n        totalMessages: 0,\n        sentMessages: 0,\n        receivedMessages: 0,\n        failedMessages: 0,\n        dailyLimit: this.dailyLimit,\n        remainingQuota: this.dailyLimit,\n      };\n    }\n  }\n\n  /**\n   * Check daily sending limit\n   */\n  private async checkDailyLimit(organizationId: string): Promise<boolean> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n\n    const sentToday = await this.prisma.whatsAppMessage.count({\n      where: {\n        organizationId,\n        direction: 'outbound',\n        status: 'sent',\n        createdAt: {\n          gte: today,\n          lt: tomorrow,\n        },\n      },\n    });\n\n    return sentToday < this.dailyLimit;\n  }\n\n  /**\n   * Log message in database\n   */\n  private async logMessage(\n    organizationId: string,\n    messageData: {\n      twilioSid?: string;\n      phoneNumber?: string;\n      to?: string;\n      body?: string;\n      templateName?: string;\n      status: string;\n      direction: 'inbound' | 'outbound';\n      error?: string;\n    },\n  ): Promise<void> {\n    try {\n      await this.prisma.whatsAppMessage.create({\n        data: {\n          organizationId,\n          twilioSid: messageData.twilioSid,\n          phoneNumber: messageData.phoneNumber || messageData.to,\n          body: messageData.body,\n          templateName: messageData.templateName,\n          status: messageData.status,\n          direction: messageData.direction,\n          error: messageData.error,\n        },\n      });\n    } catch (error) {\n      this.logger.error('Error logging WhatsApp message:', error);\n    }\n  }\n\n  /**\n   * Find organization by WhatsApp number\n   */\n  private async findOrganizationByWhatsAppNumber(phoneNumber: string) {\n    try {\n      const integration = await this.prisma.integration.findFirst({\n        where: {\n          platform: 'whatsapp',\n          isActive: true,\n          // Assuming phone number is stored in metadata\n          metadata: {\n            path: ['phoneNumber'],\n            equals: phoneNumber,\n          },\n        },\n        include: {\n          organization: true,\n        },\n      });\n\n      return integration?.organization || null;\n    } catch (error) {\n      this.logger.error('Error finding organization by WhatsApp number:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Process automated responses\n   */\n  private async processAutomatedResponse(\n    organizationId: string,\n    phoneNumber: string,\n    messageBody: string,\n  ): Promise<void> {\n    try {\n      const body = messageBody?.toLowerCase().trim();\n\n      if (body === '/relatorio' || body === '/report') {\n        await this.sendDailyReport(organizationId, phoneNumber);\n      } else if (body === '/ajuda' || body === '/help') {\n        await this.sendHelpMessage(organizationId, phoneNumber);\n      }\n    } catch (error) {\n      this.logger.error('Error processing automated response:', error);\n    }\n  }\n\n  /**\n   * Send daily report\n   */\n  private async sendDailyReport(\n    organizationId: string,\n    phoneNumber: string,\n  ): Promise<void> {\n    try {\n      // Get yesterday's metrics\n      const yesterday = new Date();\n      yesterday.setDate(yesterday.getDate() - 1);\n      yesterday.setHours(0, 0, 0, 0);\n      const today = new Date(yesterday);\n      today.setDate(today.getDate() + 1);\n\n      // This would integrate with your existing metrics service\n      const reportMessage = `📊 *Relatório Diário*\\n\\n` +\n        `📅 Data: ${yesterday.toLocaleDateString('pt-BR')}\\n` +\n        `💰 Vendas: R$ 0,00\\n` +\n        `📈 Conversões: 0\\n` +\n        `💸 Gastos: R$ 0,00\\n` +\n        `🎯 ROI: 0%\\n\\n` +\n        `Digite /ajuda para mais opções.`;\n\n      await this.sendMessage(organizationId, {\n        to: phoneNumber,\n        body: reportMessage,\n      });\n    } catch (error) {\n      this.logger.error('Error sending daily report:', error);\n    }\n  }\n\n  /**\n   * Send help message\n   */\n  private async sendHelpMessage(\n    organizationId: string,\n    phoneNumber: string,\n  ): Promise<void> {\n    try {\n      const helpMessage = `🤖 *Comandos Disponíveis*\\n\\n` +\n        `📊 /relatorio - Relatório do dia anterior\\n` +\n        `💡 /ajuda - Esta mensagem\\n\\n` +\n        `Você também receberá:\\n` +\n        `🔔 Notificações de vendas\\n` +\n        `⚠️ Alertas de orçamento\\n` +\n        `📈 Relatórios diários às 9h`;\n\n      await this.sendMessage(organizationId, {\n        to: phoneNumber,\n        body: helpMessage,\n      });\n    } catch (error) {\n      this.logger.error('Error sending help message:', error);\n    }\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}
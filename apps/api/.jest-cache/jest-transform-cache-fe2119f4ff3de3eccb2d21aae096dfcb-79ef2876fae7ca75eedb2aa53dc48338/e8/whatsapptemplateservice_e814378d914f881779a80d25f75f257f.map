{"version":3,"names":["cov_18x62qe1ta","actualCoverage","Injectable","Logger","NotFoundException","PrismaService","WhatsAppTemplateService","s","WhatsAppTemplateService_1","prisma","logger","name","constructor","f","createTemplate","configId","createDto","template","whatsAppTemplate","create","data","category","content","variables","b","language","status","log","error","message","getTemplates","activeOnly","where","isActive","findMany","orderBy","createdAt","getTemplateById","templateId","findFirst","id","getTemplateByName","updateTemplate","updateDto","update","deleteTemplate","delete","processTemplate","processedContent","Object","entries","forEach","key","value","regex","RegExp","replace","String","extractVariables","match","exec","includes","push","validateTemplateVariables","providedVariables","requiredVariables","missingVariables","filter","variable","isValid","length","incrementUsageCount","usageCount","increment","createDefaultTemplates","defaultTemplates","type","required","campaign_name","source","timestamp","spent","budget","percentage","alert_message","date","sales","conversions","roi","leads","defaultValue","createdTemplates","created","approved","getTemplateStats","templates","stats","total","active","t","pending","mostUsed","sort","a","__decorate","_a"],"sources":["C:\\Users\\Enzo Marcelo\\Desktop\\Projetos Empresa\\Saas Utmify\\utmify-clone\\apps\\api\\src\\services\\whatsapp-template.service.ts"],"sourcesContent":["import { Injectable, Logger, NotFoundException } from '@nestjs/common';\nimport { PrismaService } from './prisma.service';\nimport { WhatsAppTemplate, Prisma } from '@prisma/client';\n\nexport interface CreateTemplateDto {\n  name: string;\n  category: 'MARKETING' | 'UTILITY' | 'AUTHENTICATION';\n  content: string;\n  variables?: Record<string, any>;\n  language?: string;\n}\n\nexport interface UpdateTemplateDto {\n  name?: string;\n  content?: string;\n  variables?: Record<string, any>;\n  isActive?: boolean;\n}\n\nexport interface TemplateVariable {\n  name: string;\n  type: 'text' | 'number' | 'date' | 'currency';\n  required: boolean;\n  defaultValue?: string;\n}\n\n@Injectable()\nexport class WhatsAppTemplateService {\n  private readonly logger = new Logger(WhatsAppTemplateService.name);\n\n  constructor(private readonly prisma: PrismaService) {}\n\n  /**\n   * Create a new template\n   */\n  async createTemplate(\n    configId: string,\n    createDto: CreateTemplateDto,\n  ): Promise<WhatsAppTemplate> {\n    try {\n      const template = await this.prisma.whatsAppTemplate.create({\n        data: {\n          configId,\n          name: createDto.name,\n          category: createDto.category,\n          content: createDto.content,\n          variables: createDto.variables || {},\n          language: createDto.language || 'pt_BR',\n          status: 'PENDING',\n        },\n      });\n\n      this.logger.log(`Template ${template.name} created for config ${configId}`);\n      return template;\n    } catch (error) {\n      this.logger.error(`Error creating template: ${error.message}`);\n      throw error;\n    }\n  }\n\n  /**\n   * Get all templates for a config\n   */\n  async getTemplates(\n    configId: string,\n    activeOnly: boolean = false,\n  ): Promise<WhatsAppTemplate[]> {\n    const where: Prisma.WhatsAppTemplateWhereInput = {\n      configId,\n    };\n\n    if (activeOnly) {\n      where.isActive = true;\n    }\n\n    return this.prisma.whatsAppTemplate.findMany({\n      where,\n      orderBy: { createdAt: 'desc' },\n    });\n  }\n\n  /**\n   * Get template by ID\n   */\n  async getTemplateById(\n    configId: string,\n    templateId: string,\n  ): Promise<WhatsAppTemplate> {\n    const template = await this.prisma.whatsAppTemplate.findFirst({\n      where: {\n        id: templateId,\n        configId,\n      },\n    });\n\n    if (!template) {\n      throw new NotFoundException('Template not found');\n    }\n\n    return template;\n  }\n\n  /**\n   * Get template by name\n   */\n  async getTemplateByName(\n    configId: string,\n    name: string,\n  ): Promise<WhatsAppTemplate | null> {\n    return this.prisma.whatsAppTemplate.findFirst({\n      where: {\n        configId,\n        name,\n        isActive: true,\n      },\n    });\n  }\n\n  /**\n   * Update template\n   */\n  async updateTemplate(\n    configId: string,\n    templateId: string,\n    updateDto: UpdateTemplateDto,\n  ): Promise<WhatsAppTemplate> {\n    const template = await this.getTemplateById(configId, templateId);\n\n    return this.prisma.whatsAppTemplate.update({\n      where: { id: template.id },\n      data: updateDto,\n    });\n  }\n\n  /**\n   * Delete template\n   */\n  async deleteTemplate(configId: string, templateId: string): Promise<void> {\n    const template = await this.getTemplateById(configId, templateId);\n\n    await this.prisma.whatsAppTemplate.delete({\n      where: { id: template.id },\n    });\n\n    this.logger.log(`Template ${template.name} deleted`);\n  }\n\n  /**\n   * Process template with variables\n   */\n  processTemplate(\n    content: string,\n    variables: Record<string, any> = {},\n  ): string {\n    let processedContent = content;\n\n    // Replace variables in format {{variable_name}}\n    Object.entries(variables).forEach(([key, value]) => {\n      const regex = new RegExp(`{{\\\\s*${key}\\\\s*}}`, 'g');\n      processedContent = processedContent.replace(regex, String(value));\n    });\n\n    return processedContent;\n  }\n\n  /**\n   * Extract variables from template content\n   */\n  extractVariables(content: string): string[] {\n    const regex = /{{\\s*(\\w+)\\s*}}/g;\n    const variables: string[] = [];\n    let match;\n\n    while ((match = regex.exec(content)) !== null) {\n      if (!variables.includes(match[1])) {\n        variables.push(match[1]);\n      }\n    }\n\n    return variables;\n  }\n\n  /**\n   * Validate template variables\n   */\n  validateTemplateVariables(\n    content: string,\n    providedVariables: Record<string, any>,\n  ): { isValid: boolean; missingVariables: string[] } {\n    const requiredVariables = this.extractVariables(content);\n    const missingVariables = requiredVariables.filter(\n      (variable) => !(variable in providedVariables),\n    );\n\n    return {\n      isValid: missingVariables.length === 0,\n      missingVariables,\n    };\n  }\n\n  /**\n   * Increment template usage count\n   */\n  async incrementUsageCount(templateId: string): Promise<void> {\n    await this.prisma.whatsAppTemplate.update({\n      where: { id: templateId },\n      data: {\n        usageCount: {\n          increment: 1,\n        },\n      },\n    });\n  }\n\n  /**\n   * Create default templates for a new config\n   */\n  async createDefaultTemplates(configId: string): Promise<WhatsAppTemplate[]> {\n    const defaultTemplates = [\n      {\n        name: 'conversion_notification',\n        category: 'UTILITY' as const,\n        content: `🎉 *Nova Conversão!*\n\n💰 Valor: R$ {{value}}\n📊 Campanha: {{campaign_name}}\n🎯 Fonte: {{source}}\n⏰ {{timestamp}}\n\n🚀 Parabéns pela venda!`,\n        variables: {\n          value: { type: 'currency', required: true },\n          campaign_name: { type: 'text', required: true },\n          source: { type: 'text', required: true },\n          timestamp: { type: 'date', required: true },\n        },\n      },\n      {\n        name: 'budget_alert',\n        category: 'UTILITY' as const,\n        content: `⚠️ *Alerta de Orçamento*\n\n📊 Campanha: {{campaign_name}}\n💸 Gasto: R$ {{spent}}\n💰 Orçamento: R$ {{budget}}\n📈 Utilizado: {{percentage}}%\n\n{{alert_message}}`,\n        variables: {\n          campaign_name: { type: 'text', required: true },\n          spent: { type: 'currency', required: true },\n          budget: { type: 'currency', required: true },\n          percentage: { type: 'number', required: true },\n          alert_message: { type: 'text', required: true },\n        },\n      },\n      {\n        name: 'daily_report',\n        category: 'UTILITY' as const,\n        content: `📊 *Relatório Diário*\n\n📅 {{date}}\n\n💰 Vendas: R$ {{sales}}\n📈 Conversões: {{conversions}}\n💸 Gastos: R$ {{spent}}\n🎯 ROI: {{roi}}%\n👥 Leads: {{leads}}\n\n📱 Digite /relatorio para mais detalhes`,\n        variables: {\n          date: { type: 'date', required: true },\n          sales: { type: 'currency', required: true },\n          conversions: { type: 'number', required: true },\n          spent: { type: 'currency', required: true },\n          roi: { type: 'number', required: true },\n          leads: { type: 'number', required: true },\n        },\n      },\n      {\n        name: 'welcome_message',\n        category: 'UTILITY' as const,\n        content: `👋 *Bem-vindo ao Utmify!*\n\nOlá {{name}}!\n\n🚀 Sua conta foi criada com sucesso!\n📊 Agora você pode acompanhar suas campanhas em tempo real.\n\n💡 *Comandos úteis:*\n📊 /relatorio - Relatório diário\n💡 /ajuda - Lista de comandos\n\n🎯 Vamos começar a otimizar suas campanhas!`,\n        variables: {\n          name: { type: 'text', required: true, defaultValue: 'usuário' },\n        },\n      },\n      {\n        name: 'help_message',\n        category: 'UTILITY' as const,\n        content: `💡 *Comandos Disponíveis*\n\n📊 */relatorio* - Relatório do dia anterior\n📈 */metricas* - Métricas das campanhas\n💰 */vendas* - Resumo de vendas\n💸 */gastos* - Resumo de gastos\n🎯 */campanhas* - Status das campanhas\n⚙️ */config* - Configurações\n❓ */ajuda* - Esta mensagem\n\n🤖 *Automações Ativas:*\n• Notificações de conversão\n• Alertas de orçamento\n• Relatórios diários (9h)\n\n📞 Precisa de ajuda? Entre em contato conosco!`,\n        variables: {},\n      },\n    ];\n\n    const createdTemplates: WhatsAppTemplate[] = [];\n\n    for (const template of defaultTemplates) {\n      try {\n        const created = await this.createTemplate(configId, template);\n        // Auto-approve default templates\n        const approved = await this.prisma.whatsAppTemplate.update({\n          where: { id: created.id },\n          data: { status: 'APPROVED' },\n        });\n        createdTemplates.push(approved);\n      } catch (error) {\n        this.logger.error(`Error creating default template ${template.name}:`, error);\n      }\n    }\n\n    this.logger.log(`Created ${createdTemplates.length} default templates for config ${configId}`);\n    return createdTemplates;\n  }\n\n  /**\n   * Get template statistics\n   */\n  async getTemplateStats(configId: string): Promise<{\n    total: number;\n    active: number;\n    approved: number;\n    pending: number;\n    mostUsed: WhatsAppTemplate | null;\n  }> {\n    const templates = await this.getTemplates(configId);\n    \n    const stats = {\n      total: templates.length,\n      active: templates.filter(t => t.isActive).length,\n      approved: templates.filter(t => t.status === 'APPROVED').length,\n      pending: templates.filter(t => t.status === 'PENDING').length,\n      mostUsed: templates.sort((a, b) => b.usageCount - a.usageCount)[0] || null,\n    };\n\n    return stats;\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA4ByB;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA5BzB,SAASE,UAAU,EAAEC,MAAM,EAAEC,iBAAiB,QAAQ,gBAAgB;AACtE,SAASC,aAAa,QAAQ,kBAAkB;AA0BzC,IAAMC,uBAAuB;AAAA;AAAA,CAAAN,cAAA,GAAAO,CAAA,QAAAC,yBAAA,GAA7B,MAAMF,uBAAuB;EAGLG,MAAA;EAFZC,MAAM;EAAA;EAAA,CAAAV,cAAA,GAAAO,CAAA,QAAG,IAAIJ,MAAM,CAACK,yBAAuB,CAACG,IAAI,CAAC;EAElEC,YAA6BH,MAAqB;IAAA;IAAAT,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAO,CAAA;IAArB,KAAAE,MAAM,GAANA,MAAM;EAAkB;EAErD;;;EAGA,MAAMK,cAAcA,CAClBC,QAAgB,EAChBC,SAA4B;IAAA;IAAAhB,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAO,CAAA;IAE5B,IAAI;MACF,MAAMU,QAAQ;MAAA;MAAA,CAAAjB,cAAA,GAAAO,CAAA,QAAG,MAAM,IAAI,CAACE,MAAM,CAACS,gBAAgB,CAACC,MAAM,CAAC;QACzDC,IAAI,EAAE;UACJL,QAAQ;UACRJ,IAAI,EAAEK,SAAS,CAACL,IAAI;UACpBU,QAAQ,EAAEL,SAAS,CAACK,QAAQ;UAC5BC,OAAO,EAAEN,SAAS,CAACM,OAAO;UAC1BC,SAAS;UAAE;UAAA,CAAAvB,cAAA,GAAAwB,CAAA,WAAAR,SAAS,CAACO,SAAS;UAAA;UAAA,CAAAvB,cAAA,GAAAwB,CAAA,WAAI,EAAE;UACpCC,QAAQ;UAAE;UAAA,CAAAzB,cAAA,GAAAwB,CAAA,WAAAR,SAAS,CAACS,QAAQ;UAAA;UAAA,CAAAzB,cAAA,GAAAwB,CAAA,WAAI,OAAO;UACvCE,MAAM,EAAE;;OAEX,CAAC;MAAC;MAAA1B,cAAA,GAAAO,CAAA;MAEH,IAAI,CAACG,MAAM,CAACiB,GAAG,CAAC,YAAYV,QAAQ,CAACN,IAAI,uBAAuBI,QAAQ,EAAE,CAAC;MAAC;MAAAf,cAAA,GAAAO,CAAA;MAC5E,OAAOU,QAAQ;IACjB,CAAC,CAAC,OAAOW,KAAK,EAAE;MAAA;MAAA5B,cAAA,GAAAO,CAAA;MACd,IAAI,CAACG,MAAM,CAACkB,KAAK,CAAC,4BAA4BA,KAAK,CAACC,OAAO,EAAE,CAAC;MAAC;MAAA7B,cAAA,GAAAO,CAAA;MAC/D,MAAMqB,KAAK;IACb;EACF;EAEA;;;EAGA,MAAME,YAAYA,CAChBf,QAAgB,EAChBgB,UAAA;EAAA;EAAA,CAAA/B,cAAA,GAAAwB,CAAA,WAAsB,KAAK;IAAA;IAAAxB,cAAA,GAAAa,CAAA;IAE3B,MAAMmB,KAAK;IAAA;IAAA,CAAAhC,cAAA,GAAAO,CAAA,QAAsC;MAC/CQ;KACD;IAAC;IAAAf,cAAA,GAAAO,CAAA;IAEF,IAAIwB,UAAU,EAAE;MAAA;MAAA/B,cAAA,GAAAwB,CAAA;MAAAxB,cAAA,GAAAO,CAAA;MACdyB,KAAK,CAACC,QAAQ,GAAG,IAAI;IACvB,CAAC;IAAA;IAAA;MAAAjC,cAAA,GAAAwB,CAAA;IAAA;IAAAxB,cAAA,GAAAO,CAAA;IAED,OAAO,IAAI,CAACE,MAAM,CAACS,gBAAgB,CAACgB,QAAQ,CAAC;MAC3CF,KAAK;MACLG,OAAO,EAAE;QAAEC,SAAS,EAAE;MAAM;KAC7B,CAAC;EACJ;EAEA;;;EAGA,MAAMC,eAAeA,CACnBtB,QAAgB,EAChBuB,UAAkB;IAAA;IAAAtC,cAAA,GAAAa,CAAA;IAElB,MAAMI,QAAQ;IAAA;IAAA,CAAAjB,cAAA,GAAAO,CAAA,QAAG,MAAM,IAAI,CAACE,MAAM,CAACS,gBAAgB,CAACqB,SAAS,CAAC;MAC5DP,KAAK,EAAE;QACLQ,EAAE,EAAEF,UAAU;QACdvB;;KAEH,CAAC;IAAC;IAAAf,cAAA,GAAAO,CAAA;IAEH,IAAI,CAACU,QAAQ,EAAE;MAAA;MAAAjB,cAAA,GAAAwB,CAAA;MAAAxB,cAAA,GAAAO,CAAA;MACb,MAAM,IAAIH,iBAAiB,CAAC,oBAAoB,CAAC;IACnD,CAAC;IAAA;IAAA;MAAAJ,cAAA,GAAAwB,CAAA;IAAA;IAAAxB,cAAA,GAAAO,CAAA;IAED,OAAOU,QAAQ;EACjB;EAEA;;;EAGA,MAAMwB,iBAAiBA,CACrB1B,QAAgB,EAChBJ,IAAY;IAAA;IAAAX,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAO,CAAA;IAEZ,OAAO,IAAI,CAACE,MAAM,CAACS,gBAAgB,CAACqB,SAAS,CAAC;MAC5CP,KAAK,EAAE;QACLjB,QAAQ;QACRJ,IAAI;QACJsB,QAAQ,EAAE;;KAEb,CAAC;EACJ;EAEA;;;EAGA,MAAMS,cAAcA,CAClB3B,QAAgB,EAChBuB,UAAkB,EAClBK,SAA4B;IAAA;IAAA3C,cAAA,GAAAa,CAAA;IAE5B,MAAMI,QAAQ;IAAA;IAAA,CAAAjB,cAAA,GAAAO,CAAA,QAAG,MAAM,IAAI,CAAC8B,eAAe,CAACtB,QAAQ,EAAEuB,UAAU,CAAC;IAAC;IAAAtC,cAAA,GAAAO,CAAA;IAElE,OAAO,IAAI,CAACE,MAAM,CAACS,gBAAgB,CAAC0B,MAAM,CAAC;MACzCZ,KAAK,EAAE;QAAEQ,EAAE,EAAEvB,QAAQ,CAACuB;MAAE,CAAE;MAC1BpB,IAAI,EAAEuB;KACP,CAAC;EACJ;EAEA;;;EAGA,MAAME,cAAcA,CAAC9B,QAAgB,EAAEuB,UAAkB;IAAA;IAAAtC,cAAA,GAAAa,CAAA;IACvD,MAAMI,QAAQ;IAAA;IAAA,CAAAjB,cAAA,GAAAO,CAAA,QAAG,MAAM,IAAI,CAAC8B,eAAe,CAACtB,QAAQ,EAAEuB,UAAU,CAAC;IAAC;IAAAtC,cAAA,GAAAO,CAAA;IAElE,MAAM,IAAI,CAACE,MAAM,CAACS,gBAAgB,CAAC4B,MAAM,CAAC;MACxCd,KAAK,EAAE;QAAEQ,EAAE,EAAEvB,QAAQ,CAACuB;MAAE;KACzB,CAAC;IAAC;IAAAxC,cAAA,GAAAO,CAAA;IAEH,IAAI,CAACG,MAAM,CAACiB,GAAG,CAAC,YAAYV,QAAQ,CAACN,IAAI,UAAU,CAAC;EACtD;EAEA;;;EAGAoC,eAAeA,CACbzB,OAAe,EACfC,SAAA;EAAA;EAAA,CAAAvB,cAAA,GAAAwB,CAAA,WAAiC,EAAE;IAAA;IAAAxB,cAAA,GAAAa,CAAA;IAEnC,IAAImC,gBAAgB;IAAA;IAAA,CAAAhD,cAAA,GAAAO,CAAA,QAAGe,OAAO;IAE9B;IAAA;IAAAtB,cAAA,GAAAO,CAAA;IACA0C,MAAM,CAACC,OAAO,CAAC3B,SAAS,CAAC,CAAC4B,OAAO,CAAC,CAAC,CAACC,GAAG,EAAEC,KAAK,CAAC,KAAI;MAAA;MAAArD,cAAA,GAAAa,CAAA;MACjD,MAAMyC,KAAK;MAAA;MAAA,CAAAtD,cAAA,GAAAO,CAAA,QAAG,IAAIgD,MAAM,CAAC,SAASH,GAAG,QAAQ,EAAE,GAAG,CAAC;MAAC;MAAApD,cAAA,GAAAO,CAAA;MACpDyC,gBAAgB,GAAGA,gBAAgB,CAACQ,OAAO,CAACF,KAAK,EAAEG,MAAM,CAACJ,KAAK,CAAC,CAAC;IACnE,CAAC,CAAC;IAAC;IAAArD,cAAA,GAAAO,CAAA;IAEH,OAAOyC,gBAAgB;EACzB;EAEA;;;EAGAU,gBAAgBA,CAACpC,OAAe;IAAA;IAAAtB,cAAA,GAAAa,CAAA;IAC9B,MAAMyC,KAAK;IAAA;IAAA,CAAAtD,cAAA,GAAAO,CAAA,QAAG,kBAAkB;IAChC,MAAMgB,SAAS;IAAA;IAAA,CAAAvB,cAAA,GAAAO,CAAA,QAAa,EAAE;IAC9B,IAAIoD,KAAK;IAAC;IAAA3D,cAAA,GAAAO,CAAA;IAEV,OAAO,CAACoD,KAAK,GAAGL,KAAK,CAACM,IAAI,CAACtC,OAAO,CAAC,MAAM,IAAI,EAAE;MAAA;MAAAtB,cAAA,GAAAO,CAAA;MAC7C,IAAI,CAACgB,SAAS,CAACsC,QAAQ,CAACF,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE;QAAA;QAAA3D,cAAA,GAAAwB,CAAA;QAAAxB,cAAA,GAAAO,CAAA;QACjCgB,SAAS,CAACuC,IAAI,CAACH,KAAK,CAAC,CAAC,CAAC,CAAC;MAC1B,CAAC;MAAA;MAAA;QAAA3D,cAAA,GAAAwB,CAAA;MAAA;IACH;IAAC;IAAAxB,cAAA,GAAAO,CAAA;IAED,OAAOgB,SAAS;EAClB;EAEA;;;EAGAwC,yBAAyBA,CACvBzC,OAAe,EACf0C,iBAAsC;IAAA;IAAAhE,cAAA,GAAAa,CAAA;IAEtC,MAAMoD,iBAAiB;IAAA;IAAA,CAAAjE,cAAA,GAAAO,CAAA,QAAG,IAAI,CAACmD,gBAAgB,CAACpC,OAAO,CAAC;IACxD,MAAM4C,gBAAgB;IAAA;IAAA,CAAAlE,cAAA,GAAAO,CAAA,QAAG0D,iBAAiB,CAACE,MAAM,CAC9CC,QAAQ,IAAK;MAAA;MAAApE,cAAA,GAAAa,CAAA;MAAAb,cAAA,GAAAO,CAAA;MAAA,SAAE6D,QAAQ,IAAIJ,iBAAiB,CAAC;IAAD,CAAC,CAC/C;IAAC;IAAAhE,cAAA,GAAAO,CAAA;IAEF,OAAO;MACL8D,OAAO,EAAEH,gBAAgB,CAACI,MAAM,KAAK,CAAC;MACtCJ;KACD;EACH;EAEA;;;EAGA,MAAMK,mBAAmBA,CAACjC,UAAkB;IAAA;IAAAtC,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAO,CAAA;IAC1C,MAAM,IAAI,CAACE,MAAM,CAACS,gBAAgB,CAAC0B,MAAM,CAAC;MACxCZ,KAAK,EAAE;QAAEQ,EAAE,EAAEF;MAAU,CAAE;MACzBlB,IAAI,EAAE;QACJoD,UAAU,EAAE;UACVC,SAAS,EAAE;;;KAGhB,CAAC;EACJ;EAEA;;;EAGA,MAAMC,sBAAsBA,CAAC3D,QAAgB;IAAA;IAAAf,cAAA,GAAAa,CAAA;IAC3C,MAAM8D,gBAAgB;IAAA;IAAA,CAAA3E,cAAA,GAAAO,CAAA,QAAG,CACvB;MACEI,IAAI,EAAE,yBAAyB;MAC/BU,QAAQ,EAAE,SAAkB;MAC5BC,OAAO,EAAE;;;;;;;wBAOO;MAChBC,SAAS,EAAE;QACT8B,KAAK,EAAE;UAAEuB,IAAI,EAAE,UAAU;UAAEC,QAAQ,EAAE;QAAI,CAAE;QAC3CC,aAAa,EAAE;UAAEF,IAAI,EAAE,MAAM;UAAEC,QAAQ,EAAE;QAAI,CAAE;QAC/CE,MAAM,EAAE;UAAEH,IAAI,EAAE,MAAM;UAAEC,QAAQ,EAAE;QAAI,CAAE;QACxCG,SAAS,EAAE;UAAEJ,IAAI,EAAE,MAAM;UAAEC,QAAQ,EAAE;QAAI;;KAE5C,EACD;MACElE,IAAI,EAAE,cAAc;MACpBU,QAAQ,EAAE,SAAkB;MAC5BC,OAAO,EAAE;;;;;;;kBAOC;MACVC,SAAS,EAAE;QACTuD,aAAa,EAAE;UAAEF,IAAI,EAAE,MAAM;UAAEC,QAAQ,EAAE;QAAI,CAAE;QAC/CI,KAAK,EAAE;UAAEL,IAAI,EAAE,UAAU;UAAEC,QAAQ,EAAE;QAAI,CAAE;QAC3CK,MAAM,EAAE;UAAEN,IAAI,EAAE,UAAU;UAAEC,QAAQ,EAAE;QAAI,CAAE;QAC5CM,UAAU,EAAE;UAAEP,IAAI,EAAE,QAAQ;UAAEC,QAAQ,EAAE;QAAI,CAAE;QAC9CO,aAAa,EAAE;UAAER,IAAI,EAAE,MAAM;UAAEC,QAAQ,EAAE;QAAI;;KAEhD,EACD;MACElE,IAAI,EAAE,cAAc;MACpBU,QAAQ,EAAE,SAAkB;MAC5BC,OAAO,EAAE;;;;;;;;;;wCAUuB;MAChCC,SAAS,EAAE;QACT8D,IAAI,EAAE;UAAET,IAAI,EAAE,MAAM;UAAEC,QAAQ,EAAE;QAAI,CAAE;QACtCS,KAAK,EAAE;UAAEV,IAAI,EAAE,UAAU;UAAEC,QAAQ,EAAE;QAAI,CAAE;QAC3CU,WAAW,EAAE;UAAEX,IAAI,EAAE,QAAQ;UAAEC,QAAQ,EAAE;QAAI,CAAE;QAC/CI,KAAK,EAAE;UAAEL,IAAI,EAAE,UAAU;UAAEC,QAAQ,EAAE;QAAI,CAAE;QAC3CW,GAAG,EAAE;UAAEZ,IAAI,EAAE,QAAQ;UAAEC,QAAQ,EAAE;QAAI,CAAE;QACvCY,KAAK,EAAE;UAAEb,IAAI,EAAE,QAAQ;UAAEC,QAAQ,EAAE;QAAI;;KAE1C,EACD;MACElE,IAAI,EAAE,iBAAiB;MACvBU,QAAQ,EAAE,SAAkB;MAC5BC,OAAO,EAAE;;;;;;;;;;;4CAW2B;MACpCC,SAAS,EAAE;QACTZ,IAAI,EAAE;UAAEiE,IAAI,EAAE,MAAM;UAAEC,QAAQ,EAAE,IAAI;UAAEa,YAAY,EAAE;QAAS;;KAEhE,EACD;MACE/E,IAAI,EAAE,cAAc;MACpBU,QAAQ,EAAE,SAAkB;MAC5BC,OAAO,EAAE;;;;;;;;;;;;;;;+CAe8B;MACvCC,SAAS,EAAE;KACZ,CACF;IAED,MAAMoE,gBAAgB;IAAA;IAAA,CAAA3F,cAAA,GAAAO,CAAA,QAAuB,EAAE;IAAC;IAAAP,cAAA,GAAAO,CAAA;IAEhD,KAAK,MAAMU,QAAQ,IAAI0D,gBAAgB,EAAE;MAAA;MAAA3E,cAAA,GAAAO,CAAA;MACvC,IAAI;QACF,MAAMqF,OAAO;QAAA;QAAA,CAAA5F,cAAA,GAAAO,CAAA,QAAG,MAAM,IAAI,CAACO,cAAc,CAACC,QAAQ,EAAEE,QAAQ,CAAC;QAC7D;QACA,MAAM4E,QAAQ;QAAA;QAAA,CAAA7F,cAAA,GAAAO,CAAA,QAAG,MAAM,IAAI,CAACE,MAAM,CAACS,gBAAgB,CAAC0B,MAAM,CAAC;UACzDZ,KAAK,EAAE;YAAEQ,EAAE,EAAEoD,OAAO,CAACpD;UAAE,CAAE;UACzBpB,IAAI,EAAE;YAAEM,MAAM,EAAE;UAAU;SAC3B,CAAC;QAAC;QAAA1B,cAAA,GAAAO,CAAA;QACHoF,gBAAgB,CAAC7B,IAAI,CAAC+B,QAAQ,CAAC;MACjC,CAAC,CAAC,OAAOjE,KAAK,EAAE;QAAA;QAAA5B,cAAA,GAAAO,CAAA;QACd,IAAI,CAACG,MAAM,CAACkB,KAAK,CAAC,mCAAmCX,QAAQ,CAACN,IAAI,GAAG,EAAEiB,KAAK,CAAC;MAC/E;IACF;IAAC;IAAA5B,cAAA,GAAAO,CAAA;IAED,IAAI,CAACG,MAAM,CAACiB,GAAG,CAAC,WAAWgE,gBAAgB,CAACrB,MAAM,iCAAiCvD,QAAQ,EAAE,CAAC;IAAC;IAAAf,cAAA,GAAAO,CAAA;IAC/F,OAAOoF,gBAAgB;EACzB;EAEA;;;EAGA,MAAMG,gBAAgBA,CAAC/E,QAAgB;IAAA;IAAAf,cAAA,GAAAa,CAAA;IAOrC,MAAMkF,SAAS;IAAA;IAAA,CAAA/F,cAAA,GAAAO,CAAA,QAAG,MAAM,IAAI,CAACuB,YAAY,CAACf,QAAQ,CAAC;IAEnD,MAAMiF,KAAK;IAAA;IAAA,CAAAhG,cAAA,GAAAO,CAAA,QAAG;MACZ0F,KAAK,EAAEF,SAAS,CAACzB,MAAM;MACvB4B,MAAM,EAAEH,SAAS,CAAC5B,MAAM,CAACgC,CAAC,IAAI;QAAA;QAAAnG,cAAA,GAAAa,CAAA;QAAAb,cAAA,GAAAO,CAAA;QAAA,OAAA4F,CAAC,CAAClE,QAAQ;MAAR,CAAQ,CAAC,CAACqC,MAAM;MAChDuB,QAAQ,EAAEE,SAAS,CAAC5B,MAAM,CAACgC,CAAC,IAAI;QAAA;QAAAnG,cAAA,GAAAa,CAAA;QAAAb,cAAA,GAAAO,CAAA;QAAA,OAAA4F,CAAC,CAACzE,MAAM,KAAK,UAAU;MAAV,CAAU,CAAC,CAAC4C,MAAM;MAC/D8B,OAAO,EAAEL,SAAS,CAAC5B,MAAM,CAACgC,CAAC,IAAI;QAAA;QAAAnG,cAAA,GAAAa,CAAA;QAAAb,cAAA,GAAAO,CAAA;QAAA,OAAA4F,CAAC,CAACzE,MAAM,KAAK,SAAS;MAAT,CAAS,CAAC,CAAC4C,MAAM;MAC7D+B,QAAQ;MAAE;MAAA,CAAArG,cAAA,GAAAwB,CAAA,WAAAuE,SAAS,CAACO,IAAI,CAAC,CAACC,CAAC,EAAE/E,CAAC,KAAK;QAAA;QAAAxB,cAAA,GAAAa,CAAA;QAAAb,cAAA,GAAAO,CAAA;QAAA,OAAAiB,CAAC,CAACgD,UAAU,GAAG+B,CAAC,CAAC/B,UAAU;MAAV,CAAU,CAAC,CAAC,CAAC,CAAC;MAAA;MAAA,CAAAxE,cAAA,GAAAwB,CAAA,WAAI,IAAI;KAC3E;IAAC;IAAAxB,cAAA,GAAAO,CAAA;IAEF,OAAOyF,KAAK;EACd;CACD;AAAA;AAAAhG,cAAA,GAAAO,CAAA;AAhVYD,uBAAuB,GAAAE,yBAAA,GAAAgG,UAAA,EADnCtG,UAAU,EAAE,E;;qCAI0BG,aAAa;AAAA;AAAA,CAAAL,cAAA,GAAAwB,CAAA,WAAbnB,aAAa;AAAA;AAAA,CAAAL,cAAA,GAAAwB,CAAA,WAAAiF,EAAA;AAAA;AAAA,CAAAzG,cAAA,GAAAwB,CAAA,WAAAyB,MAAA,I,EAHvC3C,uBAAuB,CAgVnC","ignoreList":[]}